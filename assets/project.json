{"targets":[{"isStage":true,"name":"Stage","variables":{"Wm,D`|7/truBo=]:$6KI":["caller_id","33309990111"]},"lists":{},"broadcasts":{"?=,:V*2H2{Cr,$DAuR3M":"set_call","[1w%a5JP7@-8Ulx$]#hO":"set_answer","[k|.2`GK_+SouW5(ZiKu":"set_decline","Q*g3|H(l#q)b:A,CreMp":"set_forceterminate"},"blocks":{},"comments":{},"currentCostume":0,"costumes":[{"name":"backdrop1","dataFormat":"svg","assetId":"cd21514d0531fdffb22204e0ec5ed84a","md5ext":"cd21514d0531fdffb22204e0ec5ed84a.svg","rotationCenterX":240,"rotationCenterY":180}],"sounds":[],"volume":100,"layerOrder":0,"tempo":60,"videoTransparency":50,"videoState":"on","textToSpeechLanguage":null},{"isStage":false,"name":"Processer","variables":{},"lists":{},"broadcasts":{},"blocks":{"i":{"opcode":"event_whenflagclicked","next":"a","parent":null,"inputs":{},"fields":{},"topLevel":true},"a":{"opcode":"roturCall_enableAudio","next":null,"parent":"i","inputs":{"mic":[1,"j"]},"fields":{}},"j":{"opcode":"roturCall_menu_mic","next":null,"parent":"a","inputs":{},"fields":{"mic":["enable",null]},"shadow":true},"b":{"opcode":"roturCall_callPeer","next":null,"parent":"k","inputs":{"NAME":[3,[12,"caller_id","Wm,D`|7/truBo=]:$6KI"],[10,"friend"]],"WAIT":[1,"l"]},"fields":{}},"l":{"opcode":"roturCall_menu_wait","next":null,"parent":"b","inputs":{},"fields":{"wait":["wait",null]},"shadow":true},"k":{"opcode":"event_whenbroadcastreceived","next":"b","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["set_call","?=,:V*2H2{Cr,$DAuR3M"]},"topLevel":true},"m":{"opcode":"event_whenbroadcastreceived","next":"n","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["set_answer","[1w%a5JP7@-8Ulx$]#hO"]},"topLevel":true},"n":{"opcode":"roturCall_answerCall","next":null,"parent":"m","inputs":{},"fields":{}},"o":{"opcode":"event_whenbroadcastreceived","next":"p","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["set_decline","[k|.2`GK_+SouW5(ZiKu"]},"topLevel":true},"q":{"opcode":"event_whenbroadcastreceived","next":"r","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["set_forceterminate","Q*g3|H(l#q)b:A,CreMp"]},"topLevel":true},"p":{"opcode":"roturCall_hangup","next":null,"parent":"o","inputs":{},"fields":{}},"r":{"opcode":"roturCall_disconnectPeer","next":null,"parent":"q","inputs":{},"fields":{}}},"comments":{},"currentCostume":0,"costumes":[{"name":"costume1","bitmapResolution":1,"dataFormat":"svg","assetId":"927d672925e7b99f7813735c484c6922","md5ext":"927d672925e7b99f7813735c484c6922.svg","rotationCenterX":30.74937882782359,"rotationCenterY":58.864768144346826}],"sounds":[],"volume":100,"layerOrder":1,"visible":false,"x":0,"y":0,"size":100,"direction":90,"draggable":false,"rotationStyle":"all around"},{"isStage":false,"name":"Sprite1","variables":{},"lists":{},"broadcasts":{},"blocks":{"s":{"opcode":"event_whenthisspriteclicked","next":"t","parent":null,"inputs":{},"fields":{},"topLevel":true},"t":{"opcode":"event_broadcast","next":null,"parent":"s","inputs":{"BROADCAST_INPUT":[1,[11,"set_answer","[1w%a5JP7@-8Ulx$]#hO"]]},"fields":{}}},"comments":{},"currentCostume":0,"costumes":[{"name":"Ball-d","bitmapResolution":1,"dataFormat":"svg","assetId":"db144b2a19f4f1ab31e30d58f00447dc","md5ext":"db144b2a19f4f1ab31e30d58f00447dc.svg","rotationCenterX":22,"rotationCenterY":22}],"sounds":[],"volume":100,"layerOrder":2,"visible":true,"x":-100,"y":-90,"size":100,"direction":90,"draggable":false,"rotationStyle":"all around"},{"isStage":false,"name":"Sprite2","variables":{},"lists":{},"broadcasts":{},"blocks":{"u":{"opcode":"event_whenthisspriteclicked","next":"v","parent":null,"inputs":{},"fields":{},"topLevel":true},"v":{"opcode":"event_broadcast","next":null,"parent":"u","inputs":{"BROADCAST_INPUT":[1,[11,"set_decline","[k|.2`GK_+SouW5(ZiKu"]]},"fields":{}}},"comments":{},"currentCostume":0,"costumes":[{"name":"Ball-a","bitmapResolution":1,"dataFormat":"svg","assetId":"a6f27028938044be5c3d635355fed492","md5ext":"a6f27028938044be5c3d635355fed492.svg","rotationCenterX":22,"rotationCenterY":22}],"sounds":[],"volume":100,"layerOrder":3,"visible":true,"x":100,"y":-90,"size":100,"direction":90,"draggable":false,"rotationStyle":"all around"},{"isStage":false,"name":"Sprite3","variables":{},"lists":{},"broadcasts":{},"blocks":{"w":{"opcode":"event_whenflagclicked","next":"c","parent":null,"inputs":{},"fields":{},"topLevel":true},"c":{"opcode":"data_setvariableto","next":null,"parent":"w","inputs":{"VALUE":[3,"x",[10,"0"]]},"fields":{"VARIABLE":["caller_id","Wm,D`|7/truBo=]:$6KI"]}},"x":{"opcode":"looks_costumenumbername","next":null,"parent":"c","inputs":{},"fields":{"NUMBER_NAME":["name",null]}},"y":{"opcode":"event_whenthisspriteclicked","next":"d","parent":null,"inputs":{},"fields":{},"topLevel":true},"e":{"opcode":"data_setvariableto","next":null,"parent":"d","inputs":{"VALUE":[3,"z",[10,"0"]]},"fields":{"VARIABLE":["caller_id","Wm,D`|7/truBo=]:$6KI"]}},"z":{"opcode":"looks_costumenumbername","next":null,"parent":"e","inputs":{},"fields":{"NUMBER_NAME":["name",null]}},"d":{"opcode":"looks_nextcostume","next":"e","parent":"y","inputs":{},"fields":{}}},"comments":{},"currentCostume":0,"costumes":[{"name":"33309990111","bitmapResolution":1,"dataFormat":"svg","assetId":"3c721d248e705f79435bc54897fffe4c","md5ext":"3c721d248e705f79435bc54897fffe4c.svg","rotationCenterX":81.50000000000003,"rotationCenterY":81.49999999999991},{"name":"88807770777","bitmapResolution":1,"dataFormat":"svg","assetId":"afe04641c40419086d7e2359c4140bbc","md5ext":"afe04641c40419086d7e2359c4140bbc.svg","rotationCenterX":81.50000000000003,"rotationCenterY":81.49999999999991},{"name":"66604440555","bitmapResolution":1,"dataFormat":"svg","assetId":"75a73d3e9dfbff6c8b1a6d8314ec4049","md5ext":"75a73d3e9dfbff6c8b1a6d8314ec4049.svg","rotationCenterX":81.50000000000003,"rotationCenterY":81.49999999999991}],"sounds":[],"volume":100,"layerOrder":4,"visible":true,"x":0,"y":0,"size":100,"direction":90,"draggable":false,"rotationStyle":"all around"},{"isStage":false,"name":"Sprite4","variables":{},"lists":{},"broadcasts":{},"blocks":{"A":{"opcode":"event_whenflagclicked","next":"f","parent":null,"inputs":{},"fields":{},"topLevel":true},"B":{"opcode":"event_whenthisspriteclicked","next":"g","parent":null,"inputs":{},"fields":{},"topLevel":true},"f":{"opcode":"roturCall_connect","next":null,"parent":"A","inputs":{"NAME":[3,"C",[10,"user241"]]},"fields":{}},"C":{"opcode":"looks_costumenumbername","next":null,"parent":"f","inputs":{},"fields":{"NUMBER_NAME":["name",null]}},"h":{"opcode":"roturCall_connect","next":null,"parent":"g","inputs":{"NAME":[3,"D",[10,"user241"]]},"fields":{}},"D":{"opcode":"looks_costumenumbername","next":null,"parent":"h","inputs":{},"fields":{"NUMBER_NAME":["name",null]}},"g":{"opcode":"looks_nextcostume","next":"h","parent":"B","inputs":{},"fields":{}}},"comments":{},"currentCostume":2,"costumes":[{"name":"33309990111","bitmapResolution":1,"dataFormat":"svg","assetId":"b5b5ed1862f26bbeeb0a78c06a60f2a5","md5ext":"b5b5ed1862f26bbeeb0a78c06a60f2a5.svg","rotationCenterX":84,"rotationCenterY":84},{"name":"88807770777","bitmapResolution":1,"dataFormat":"svg","assetId":"e19d454edb5c8656083d6ac794fa38c1","md5ext":"e19d454edb5c8656083d6ac794fa38c1.svg","rotationCenterX":84.00000000000003,"rotationCenterY":83.99999999999991},{"name":"66604440555","bitmapResolution":1,"dataFormat":"svg","assetId":"5decd29774b2170721c39e3dfab678fc","md5ext":"5decd29774b2170721c39e3dfab678fc.svg","rotationCenterX":84.00000000000003,"rotationCenterY":83.99999999999991}],"sounds":[],"volume":100,"layerOrder":5,"visible":true,"x":205.9832421384691,"y":142.104552971934,"size":25,"direction":90,"draggable":false,"rotationStyle":"all around"},{"isStage":false,"name":"Sprite5","variables":{},"lists":{},"broadcasts":{},"blocks":{"E":{"opcode":"event_whenthisspriteclicked","next":"F","parent":null,"inputs":{},"fields":{},"topLevel":true},"F":{"opcode":"event_broadcast","next":null,"parent":"E","inputs":{"BROADCAST_INPUT":[1,[11,"set_call","?=,:V*2H2{Cr,$DAuR3M"]]},"fields":{}}},"comments":{},"currentCostume":1,"costumes":[{"name":"costume1","bitmapResolution":1,"dataFormat":"svg","assetId":"3339a2953a3bf62bb80e54ff575dbced","md5ext":"3339a2953a3bf62bb80e54ff575dbced.svg","rotationCenterX":0,"rotationCenterY":0},{"name":"Ball-b","bitmapResolution":1,"dataFormat":"svg","assetId":"ad7dc51cafd73e8279073e33b0eab335","md5ext":"ad7dc51cafd73e8279073e33b0eab335.svg","rotationCenterX":22,"rotationCenterY":22}],"sounds":[],"volume":100,"layerOrder":6,"visible":true,"x":0,"y":130,"size":100,"direction":90,"draggable":false,"rotationStyle":"all around"}],"monitors":[{"id":"Wm,D`|7/truBo=]:$6KI","mode":"default","opcode":"data_variable","params":{"VARIABLE":"caller_id"},"spriteName":null,"value":0,"width":0,"height":0,"x":5,"y":5,"visible":true,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"roturCall_isConnected","mode":"default","opcode":"roturCall_isConnected","params":{},"spriteName":null,"value":0,"width":0,"height":0,"x":244,"y":316,"visible":true,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"roturCall_onCall","mode":"default","opcode":"roturCall_onCall","params":{},"spriteName":null,"value":0,"width":0,"height":0,"x":258,"y":339,"visible":true,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"roturCall_isCallIncoming","mode":"default","opcode":"roturCall_isCallIncoming","params":{},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":315,"visible":true,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"roturCall_hasAudio","mode":"default","opcode":"roturCall_hasAudio","params":{},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":340,"visible":true,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"roturCall_getStatus","mode":"large","opcode":"roturCall_getStatus","params":{},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":30,"visible":true,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"roturCall_getCallStatus","mode":"default","opcode":"roturCall_getCallStatus","params":{},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":59,"visible":true,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"roturCall_getName","mode":"large","opcode":"roturCall_getName","params":{},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":86,"visible":true,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"roturCall_getCallPartner","mode":"large","opcode":"roturCall_getCallPartner","params":{},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":113,"visible":true,"sliderMin":0,"sliderMax":100,"isDiscrete":true}],"extensions":["roturCall"],"extensionURLs":{"roturCall":"data:text/javascript;base64,KGZ1bmN0aW9uIChTY3JhdGNoKSB7CiAgLy8gUGVlckpTCiAgLy8gaHR0cHM6Ly91bnBrZy5jb20vcGVlcmpzQDEuNS40L2Rpc3QvcGVlcmpzLm1pbi5qcwogICgoKSA9PiB7CiAgICBmdW5jdGlvbiBlKGUsIHQsIG4sIHIpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIHQsIHsgZ2V0OiBuLCBzZXQ6IHIsIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwIH0pIH0gZnVuY3Rpb24gdChlKSB7IHJldHVybiBlICYmIGUuX19lc01vZHVsZSA/IGUuZGVmYXVsdCA6IGUgfSBjbGFzcyBuIHsgY29uc3RydWN0b3IoKSB7IHRoaXMuY2h1bmtlZE1UVSA9IDE2MzAwLCB0aGlzLl9kYXRhQ291bnQgPSAxLCB0aGlzLmNodW5rID0gZSA9PiB7IGxldCB0ID0gW10sIG4gPSBlLmJ5dGVMZW5ndGgsIHIgPSBNYXRoLmNlaWwobiAvIHRoaXMuY2h1bmtlZE1UVSksIGkgPSAwLCBvID0gMDsgZm9yICg7IG8gPCBuOykgeyBsZXQgcyA9IE1hdGgubWluKG4sIG8gKyB0aGlzLmNodW5rZWRNVFUpLCBhID0gZS5zbGljZShvLCBzKSwgYyA9IHsgX19wZWVyRGF0YTogdGhpcy5fZGF0YUNvdW50LCBuOiBpLCBkYXRhOiBhLCB0b3RhbDogciB9OyB0LnB1c2goYyksIG8gPSBzLCBpKysgfSByZXR1cm4gdGhpcy5fZGF0YUNvdW50KyssIHQgfSB9IH0gY2xhc3MgciB7IGFwcGVuZF9idWZmZXIoZSkgeyB0aGlzLmZsdXNoKCksIHRoaXMuX3BhcnRzLnB1c2goZSkgfSBhcHBlbmQoZSkgeyB0aGlzLl9waWVjZXMucHVzaChlKSB9IGZsdXNoKCkgeyBpZiAodGhpcy5fcGllY2VzLmxlbmd0aCA+IDApIHsgbGV0IGUgPSBuZXcgVWludDhBcnJheSh0aGlzLl9waWVjZXMpOyB0aGlzLl9wYXJ0cy5wdXNoKGUpLCB0aGlzLl9waWVjZXMgPSBbXSB9IH0gdG9BcnJheUJ1ZmZlcigpIHsgbGV0IGUgPSBbXTsgZm9yIChsZXQgdCBvZiB0aGlzLl9wYXJ0cykgZS5wdXNoKHQpOyByZXR1cm4gZnVuY3Rpb24gKGUpIHsgbGV0IHQgPSAwOyBmb3IgKGxldCBuIG9mIGUpIHQgKz0gbi5ieXRlTGVuZ3RoOyBsZXQgbiA9IG5ldyBVaW50OEFycmF5KHQpLCByID0gMDsgZm9yIChsZXQgdCBvZiBlKSB7IGxldCBlID0gbmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsIHQuYnl0ZU9mZnNldCwgdC5ieXRlTGVuZ3RoKTsgbi5zZXQoZSwgciksIHIgKz0gdC5ieXRlTGVuZ3RoIH0gcmV0dXJuIG4gfShlKS5idWZmZXIgfSBjb25zdHJ1Y3RvcigpIHsgdGhpcy5lbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyLCB0aGlzLl9waWVjZXMgPSBbXSwgdGhpcy5fcGFydHMgPSBbXSB9IH0gZnVuY3Rpb24gaShlKSB7IHJldHVybiBuZXcgcyhlKS51bnBhY2soKSB9IGZ1bmN0aW9uIG8oZSkgeyBsZXQgdCA9IG5ldyBhLCBuID0gdC5wYWNrKGUpOyByZXR1cm4gbiBpbnN0YW5jZW9mIFByb21pc2UgPyBuLnRoZW4oKCkgPT4gdC5nZXRCdWZmZXIoKSkgOiB0LmdldEJ1ZmZlcigpIH0gY2xhc3MgcyB7IHVucGFjaygpIHsgbGV0IGU7IGxldCB0ID0gdGhpcy51bnBhY2tfdWludDgoKTsgaWYgKHQgPCAxMjgpIHJldHVybiB0OyBpZiAoKDIyNCBeIHQpIDwgMzIpIHJldHVybiAoMjI0IF4gdCkgLSAzMjsgaWYgKChlID0gMTYwIF4gdCkgPD0gMTUpIHJldHVybiB0aGlzLnVucGFja19yYXcoZSk7IGlmICgoZSA9IDE3NiBeIHQpIDw9IDE1KSByZXR1cm4gdGhpcy51bnBhY2tfc3RyaW5nKGUpOyBpZiAoKGUgPSAxNDQgXiB0KSA8PSAxNSkgcmV0dXJuIHRoaXMudW5wYWNrX2FycmF5KGUpOyBpZiAoKGUgPSAxMjggXiB0KSA8PSAxNSkgcmV0dXJuIHRoaXMudW5wYWNrX21hcChlKTsgc3dpdGNoICh0KSB7IGNhc2UgMTkyOiByZXR1cm4gbnVsbDsgY2FzZSAxOTM6IGNhc2UgMjEyOiBjYXNlIDIxMzogY2FzZSAyMTQ6IGNhc2UgMjE1OiByZXR1cm47IGNhc2UgMTk0OiByZXR1cm4gITE7IGNhc2UgMTk1OiByZXR1cm4gITA7IGNhc2UgMjAyOiByZXR1cm4gdGhpcy51bnBhY2tfZmxvYXQoKTsgY2FzZSAyMDM6IHJldHVybiB0aGlzLnVucGFja19kb3VibGUoKTsgY2FzZSAyMDQ6IHJldHVybiB0aGlzLnVucGFja191aW50OCgpOyBjYXNlIDIwNTogcmV0dXJuIHRoaXMudW5wYWNrX3VpbnQxNigpOyBjYXNlIDIwNjogcmV0dXJuIHRoaXMudW5wYWNrX3VpbnQzMigpOyBjYXNlIDIwNzogcmV0dXJuIHRoaXMudW5wYWNrX3VpbnQ2NCgpOyBjYXNlIDIwODogcmV0dXJuIHRoaXMudW5wYWNrX2ludDgoKTsgY2FzZSAyMDk6IHJldHVybiB0aGlzLnVucGFja19pbnQxNigpOyBjYXNlIDIxMDogcmV0dXJuIHRoaXMudW5wYWNrX2ludDMyKCk7IGNhc2UgMjExOiByZXR1cm4gdGhpcy51bnBhY2tfaW50NjQoKTsgY2FzZSAyMTY6IHJldHVybiBlID0gdGhpcy51bnBhY2tfdWludDE2KCksIHRoaXMudW5wYWNrX3N0cmluZyhlKTsgY2FzZSAyMTc6IHJldHVybiBlID0gdGhpcy51bnBhY2tfdWludDMyKCksIHRoaXMudW5wYWNrX3N0cmluZyhlKTsgY2FzZSAyMTg6IHJldHVybiBlID0gdGhpcy51bnBhY2tfdWludDE2KCksIHRoaXMudW5wYWNrX3JhdyhlKTsgY2FzZSAyMTk6IHJldHVybiBlID0gdGhpcy51bnBhY2tfdWludDMyKCksIHRoaXMudW5wYWNrX3JhdyhlKTsgY2FzZSAyMjA6IHJldHVybiBlID0gdGhpcy51bnBhY2tfdWludDE2KCksIHRoaXMudW5wYWNrX2FycmF5KGUpOyBjYXNlIDIyMTogcmV0dXJuIGUgPSB0aGlzLnVucGFja191aW50MzIoKSwgdGhpcy51bnBhY2tfYXJyYXkoZSk7IGNhc2UgMjIyOiByZXR1cm4gZSA9IHRoaXMudW5wYWNrX3VpbnQxNigpLCB0aGlzLnVucGFja19tYXAoZSk7IGNhc2UgMjIzOiByZXR1cm4gZSA9IHRoaXMudW5wYWNrX3VpbnQzMigpLCB0aGlzLnVucGFja19tYXAoZSkgfSB9IHVucGFja191aW50OCgpIHsgbGV0IGUgPSAyNTUgJiB0aGlzLmRhdGFWaWV3W3RoaXMuaW5kZXhdOyByZXR1cm4gdGhpcy5pbmRleCsrLCBlIH0gdW5wYWNrX3VpbnQxNigpIHsgbGV0IGUgPSB0aGlzLnJlYWQoMiksIHQgPSAoMjU1ICYgZVswXSkgKiAyNTYgKyAoMjU1ICYgZVsxXSk7IHJldHVybiB0aGlzLmluZGV4ICs9IDIsIHQgfSB1bnBhY2tfdWludDMyKCkgeyBsZXQgZSA9IHRoaXMucmVhZCg0KSwgdCA9ICgoMjU2ICogZVswXSArIGVbMV0pICogMjU2ICsgZVsyXSkgKiAyNTYgKyBlWzNdOyByZXR1cm4gdGhpcy5pbmRleCArPSA0LCB0IH0gdW5wYWNrX3VpbnQ2NCgpIHsgbGV0IGUgPSB0aGlzLnJlYWQoOCksIHQgPSAoKCgoKCgyNTYgKiBlWzBdICsgZVsxXSkgKiAyNTYgKyBlWzJdKSAqIDI1NiArIGVbM10pICogMjU2ICsgZVs0XSkgKiAyNTYgKyBlWzVdKSAqIDI1NiArIGVbNl0pICogMjU2ICsgZVs3XTsgcmV0dXJuIHRoaXMuaW5kZXggKz0gOCwgdCB9IHVucGFja19pbnQ4KCkgeyBsZXQgZSA9IHRoaXMudW5wYWNrX3VpbnQ4KCk7IHJldHVybiBlIDwgMTI4ID8gZSA6IGUgLSAyNTYgfSB1bnBhY2tfaW50MTYoKSB7IGxldCBlID0gdGhpcy51bnBhY2tfdWludDE2KCk7IHJldHVybiBlIDwgMzI3NjggPyBlIDogZSAtIDY1NTM2IH0gdW5wYWNrX2ludDMyKCkgeyBsZXQgZSA9IHRoaXMudW5wYWNrX3VpbnQzMigpOyByZXR1cm4gZSA8IDIxNDc0ODM2NDggPyBlIDogZSAtIDQyOTQ5NjcyOTYgfSB1bnBhY2tfaW50NjQoKSB7IGxldCBlID0gdGhpcy51bnBhY2tfdWludDY0KCk7IHJldHVybiBlIDwgMHg3ZmZmZmZmZmZmZmZmZmZmID8gZSA6IGUgLSAxODQ0Njc0NDA3MzcwOTU1MmUzIH0gdW5wYWNrX3JhdyhlKSB7IGlmICh0aGlzLmxlbmd0aCA8IHRoaXMuaW5kZXggKyBlKSB0aHJvdyBFcnJvcihgQmluYXJ5UGFja0ZhaWx1cmU6IGluZGV4IGlzIG91dCBvZiByYW5nZSAke3RoaXMuaW5kZXh9ICR7ZX0gJHt0aGlzLmxlbmd0aH1gKTsgbGV0IHQgPSB0aGlzLmRhdGFCdWZmZXIuc2xpY2UodGhpcy5pbmRleCwgdGhpcy5pbmRleCArIGUpOyByZXR1cm4gdGhpcy5pbmRleCArPSBlLCB0IH0gdW5wYWNrX3N0cmluZyhlKSB7IGxldCB0LCBuOyBsZXQgciA9IHRoaXMucmVhZChlKSwgaSA9IDAsIG8gPSAiIjsgZm9yICg7IGkgPCBlOykodCA9IHJbaV0pIDwgMTYwID8gKG4gPSB0LCBpKyspIDogKDE5MiBeIHQpIDwgMzIgPyAobiA9ICgzMSAmIHQpIDw8IDYgfCA2MyAmIHJbaSArIDFdLCBpICs9IDIpIDogKDIyNCBeIHQpIDwgMTYgPyAobiA9ICgxNSAmIHQpIDw8IDEyIHwgKDYzICYgcltpICsgMV0pIDw8IDYgfCA2MyAmIHJbaSArIDJdLCBpICs9IDMpIDogKG4gPSAoNyAmIHQpIDw8IDE4IHwgKDYzICYgcltpICsgMV0pIDw8IDEyIHwgKDYzICYgcltpICsgMl0pIDw8IDYgfCA2MyAmIHJbaSArIDNdLCBpICs9IDQpLCBvICs9IFN0cmluZy5mcm9tQ29kZVBvaW50KG4pOyByZXR1cm4gdGhpcy5pbmRleCArPSBlLCBvIH0gdW5wYWNrX2FycmF5KGUpIHsgbGV0IHQgPSBBcnJheShlKTsgZm9yIChsZXQgbiA9IDA7IG4gPCBlOyBuKyspdFtuXSA9IHRoaXMudW5wYWNrKCk7IHJldHVybiB0IH0gdW5wYWNrX21hcChlKSB7IGxldCB0ID0ge307IGZvciAobGV0IG4gPSAwOyBuIDwgZTsgbisrKXRbdGhpcy51bnBhY2soKV0gPSB0aGlzLnVucGFjaygpOyByZXR1cm4gdCB9IHVucGFja19mbG9hdCgpIHsgbGV0IGUgPSB0aGlzLnVucGFja191aW50MzIoKTsgcmV0dXJuICgwID09IGUgPj4gMzEgPyAxIDogLTEpICogKDgzODg2MDcgJiBlIHwgODM4ODYwOCkgKiAyICoqICgoZSA+PiAyMyAmIDI1NSkgLSAxMjcgLSAyMykgfSB1bnBhY2tfZG91YmxlKCkgeyBsZXQgZSA9IHRoaXMudW5wYWNrX3VpbnQzMigpLCB0ID0gdGhpcy51bnBhY2tfdWludDMyKCksIG4gPSAoZSA+PiAyMCAmIDIwNDcpIC0gMTAyMzsgcmV0dXJuICgwID09IGUgPj4gMzEgPyAxIDogLTEpICogKCgxMDQ4NTc1ICYgZSB8IDEwNDg1NzYpICogMiAqKiAobiAtIDIwKSArIHQgKiAyICoqIChuIC0gNTIpKSB9IHJlYWQoZSkgeyBsZXQgdCA9IHRoaXMuaW5kZXg7IGlmICh0ICsgZSA8PSB0aGlzLmxlbmd0aCkgcmV0dXJuIHRoaXMuZGF0YVZpZXcuc3ViYXJyYXkodCwgdCArIGUpOyB0aHJvdyBFcnJvcigiQmluYXJ5UGFja0ZhaWx1cmU6IHJlYWQgaW5kZXggb3V0IG9mIHJhbmdlIikgfSBjb25zdHJ1Y3RvcihlKSB7IHRoaXMuaW5kZXggPSAwLCB0aGlzLmRhdGFCdWZmZXIgPSBlLCB0aGlzLmRhdGFWaWV3ID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5kYXRhQnVmZmVyKSwgdGhpcy5sZW5ndGggPSB0aGlzLmRhdGFCdWZmZXIuYnl0ZUxlbmd0aCB9IH0gY2xhc3MgYSB7IGdldEJ1ZmZlcigpIHsgcmV0dXJuIHRoaXMuX2J1ZmZlckJ1aWxkZXIudG9BcnJheUJ1ZmZlcigpIH0gcGFjayhlKSB7IGlmICgic3RyaW5nIiA9PSB0eXBlb2YgZSkgdGhpcy5wYWNrX3N0cmluZyhlKTsgZWxzZSBpZiAoIm51bWJlciIgPT0gdHlwZW9mIGUpIE1hdGguZmxvb3IoZSkgPT09IGUgPyB0aGlzLnBhY2tfaW50ZWdlcihlKSA6IHRoaXMucGFja19kb3VibGUoZSk7IGVsc2UgaWYgKCJib29sZWFuIiA9PSB0eXBlb2YgZSkgITAgPT09IGUgPyB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgxOTUpIDogITEgPT09IGUgJiYgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmQoMTk0KTsgZWxzZSBpZiAodm9pZCAwID09PSBlKSB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgxOTIpOyBlbHNlIGlmICgib2JqZWN0IiA9PSB0eXBlb2YgZSkgeyBpZiAobnVsbCA9PT0gZSkgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmQoMTkyKTsgZWxzZSB7IGxldCB0ID0gZS5jb25zdHJ1Y3RvcjsgaWYgKGUgaW5zdGFuY2VvZiBBcnJheSkgeyBsZXQgdCA9IHRoaXMucGFja19hcnJheShlKTsgaWYgKHQgaW5zdGFuY2VvZiBQcm9taXNlKSByZXR1cm4gdC50aGVuKCgpID0+IHRoaXMuX2J1ZmZlckJ1aWxkZXIuZmx1c2goKSkgfSBlbHNlIGlmIChlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpIHRoaXMucGFja19iaW4obmV3IFVpbnQ4QXJyYXkoZSkpOyBlbHNlIGlmICgiQllURVNfUEVSX0VMRU1FTlQiIGluIGUpIHRoaXMucGFja19iaW4obmV3IFVpbnQ4QXJyYXkoZS5idWZmZXIsIGUuYnl0ZU9mZnNldCwgZS5ieXRlTGVuZ3RoKSk7IGVsc2UgaWYgKGUgaW5zdGFuY2VvZiBEYXRlKSB0aGlzLnBhY2tfc3RyaW5nKGUudG9TdHJpbmcoKSk7IGVsc2UgaWYgKGUgaW5zdGFuY2VvZiBCbG9iKSByZXR1cm4gZS5hcnJheUJ1ZmZlcigpLnRoZW4oZSA9PiB7IHRoaXMucGFja19iaW4obmV3IFVpbnQ4QXJyYXkoZSkpLCB0aGlzLl9idWZmZXJCdWlsZGVyLmZsdXNoKCkgfSk7IGVsc2UgaWYgKHQgPT0gT2JqZWN0IHx8IHQudG9TdHJpbmcoKS5zdGFydHNXaXRoKCJjbGFzcyIpKSB7IGxldCB0ID0gdGhpcy5wYWNrX29iamVjdChlKTsgaWYgKHQgaW5zdGFuY2VvZiBQcm9taXNlKSByZXR1cm4gdC50aGVuKCgpID0+IHRoaXMuX2J1ZmZlckJ1aWxkZXIuZmx1c2goKSkgfSBlbHNlIHRocm93IEVycm9yKGBUeXBlICIke3QudG9TdHJpbmcoKX0iIG5vdCB5ZXQgc3VwcG9ydGVkYCkgfSB9IGVsc2UgdGhyb3cgRXJyb3IoYFR5cGUgIiR7dHlwZW9mIGV9IiBub3QgeWV0IHN1cHBvcnRlZGApOyB0aGlzLl9idWZmZXJCdWlsZGVyLmZsdXNoKCkgfSBwYWNrX2JpbihlKSB7IGxldCB0ID0gZS5sZW5ndGg7IGlmICh0IDw9IDE1KSB0aGlzLnBhY2tfdWludDgoMTYwICsgdCk7IGVsc2UgaWYgKHQgPD0gNjU1MzUpIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDIxOCksIHRoaXMucGFja191aW50MTYodCk7IGVsc2UgaWYgKHQgPD0gNDI5NDk2NzI5NSkgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmQoMjE5KSwgdGhpcy5wYWNrX3VpbnQzMih0KTsgZWxzZSB0aHJvdyBFcnJvcigiSW52YWxpZCBsZW5ndGgiKTsgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmRfYnVmZmVyKGUpIH0gcGFja19zdHJpbmcoZSkgeyBsZXQgdCA9IHRoaXMuX3RleHRFbmNvZGVyLmVuY29kZShlKSwgbiA9IHQubGVuZ3RoOyBpZiAobiA8PSAxNSkgdGhpcy5wYWNrX3VpbnQ4KDE3NiArIG4pOyBlbHNlIGlmIChuIDw9IDY1NTM1KSB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgyMTYpLCB0aGlzLnBhY2tfdWludDE2KG4pOyBlbHNlIGlmIChuIDw9IDQyOTQ5NjcyOTUpIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDIxNyksIHRoaXMucGFja191aW50MzIobik7IGVsc2UgdGhyb3cgRXJyb3IoIkludmFsaWQgbGVuZ3RoIik7IHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kX2J1ZmZlcih0KSB9IHBhY2tfYXJyYXkoZSkgeyBsZXQgdCA9IGUubGVuZ3RoOyBpZiAodCA8PSAxNSkgdGhpcy5wYWNrX3VpbnQ4KDE0NCArIHQpOyBlbHNlIGlmICh0IDw9IDY1NTM1KSB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgyMjApLCB0aGlzLnBhY2tfdWludDE2KHQpOyBlbHNlIGlmICh0IDw9IDQyOTQ5NjcyOTUpIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDIyMSksIHRoaXMucGFja191aW50MzIodCk7IGVsc2UgdGhyb3cgRXJyb3IoIkludmFsaWQgbGVuZ3RoIik7IGxldCBuID0gciA9PiB7IGlmIChyIDwgdCkgeyBsZXQgdCA9IHRoaXMucGFjayhlW3JdKTsgcmV0dXJuIHQgaW5zdGFuY2VvZiBQcm9taXNlID8gdC50aGVuKCgpID0+IG4ociArIDEpKSA6IG4ociArIDEpIH0gfTsgcmV0dXJuIG4oMCkgfSBwYWNrX2ludGVnZXIoZSkgeyBpZiAoZSA+PSAtMzIgJiYgZSA8PSAxMjcpIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDI1NSAmIGUpOyBlbHNlIGlmIChlID49IDAgJiYgZSA8PSAyNTUpIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDIwNCksIHRoaXMucGFja191aW50OChlKTsgZWxzZSBpZiAoZSA+PSAtMTI4ICYmIGUgPD0gMTI3KSB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgyMDgpLCB0aGlzLnBhY2tfaW50OChlKTsgZWxzZSBpZiAoZSA+PSAwICYmIGUgPD0gNjU1MzUpIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDIwNSksIHRoaXMucGFja191aW50MTYoZSk7IGVsc2UgaWYgKGUgPj0gLTMyNzY4ICYmIGUgPD0gMzI3NjcpIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDIwOSksIHRoaXMucGFja19pbnQxNihlKTsgZWxzZSBpZiAoZSA+PSAwICYmIGUgPD0gNDI5NDk2NzI5NSkgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmQoMjA2KSwgdGhpcy5wYWNrX3VpbnQzMihlKTsgZWxzZSBpZiAoZSA+PSAtMjE0NzQ4MzY0OCAmJiBlIDw9IDIxNDc0ODM2NDcpIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDIxMCksIHRoaXMucGFja19pbnQzMihlKTsgZWxzZSBpZiAoZSA+PSAtMHg4MDAwMDAwMDAwMDAwMDAwICYmIGUgPD0gMHg3ZmZmZmZmZmZmZmZmZmZmKSB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgyMTEpLCB0aGlzLnBhY2tfaW50NjQoZSk7IGVsc2UgaWYgKGUgPj0gMCAmJiBlIDw9IDE4NDQ2NzQ0MDczNzA5NTUyZTMpIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDIwNyksIHRoaXMucGFja191aW50NjQoZSk7IGVsc2UgdGhyb3cgRXJyb3IoIkludmFsaWQgaW50ZWdlciIpIH0gcGFja19kb3VibGUoZSkgeyBsZXQgdCA9IDA7IGUgPCAwICYmICh0ID0gMSwgZSA9IC1lKTsgbGV0IG4gPSBNYXRoLmZsb29yKE1hdGgubG9nKGUpIC8gTWF0aC5MTjIpLCByID0gTWF0aC5mbG9vcigoZSAvIDIgKiogbiAtIDEpICogNDUwMzU5OTYyNzM3MDQ5NiksIGkgPSB0IDw8IDMxIHwgbiArIDEwMjMgPDwgMjAgfCByIC8gNDI5NDk2NzI5NiAmIDEwNDg1NzU7IHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDIwMyksIHRoaXMucGFja19pbnQzMihpKSwgdGhpcy5wYWNrX2ludDMyKHIgJSA0Mjk0OTY3Mjk2KSB9IHBhY2tfb2JqZWN0KGUpIHsgbGV0IHQgPSBPYmplY3Qua2V5cyhlKSwgbiA9IHQubGVuZ3RoOyBpZiAobiA8PSAxNSkgdGhpcy5wYWNrX3VpbnQ4KDEyOCArIG4pOyBlbHNlIGlmIChuIDw9IDY1NTM1KSB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgyMjIpLCB0aGlzLnBhY2tfdWludDE2KG4pOyBlbHNlIGlmIChuIDw9IDQyOTQ5NjcyOTUpIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDIyMyksIHRoaXMucGFja191aW50MzIobik7IGVsc2UgdGhyb3cgRXJyb3IoIkludmFsaWQgbGVuZ3RoIik7IGxldCByID0gbiA9PiB7IGlmIChuIDwgdC5sZW5ndGgpIHsgbGV0IGkgPSB0W25dOyBpZiAoZS5oYXNPd25Qcm9wZXJ0eShpKSkgeyB0aGlzLnBhY2soaSk7IGxldCB0ID0gdGhpcy5wYWNrKGVbaV0pOyBpZiAodCBpbnN0YW5jZW9mIFByb21pc2UpIHJldHVybiB0LnRoZW4oKCkgPT4gcihuICsgMSkpIH0gcmV0dXJuIHIobiArIDEpIH0gfTsgcmV0dXJuIHIoMCkgfSBwYWNrX3VpbnQ4KGUpIHsgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmQoZSkgfSBwYWNrX3VpbnQxNihlKSB7IHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKGUgPj4gOCksIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDI1NSAmIGUpIH0gcGFja191aW50MzIoZSkgeyBsZXQgdCA9IDQyOTQ5NjcyOTUgJiBlOyB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgoNDI3ODE5MDA4MCAmIHQpID4+PiAyNCksIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKCgxNjcxMTY4MCAmIHQpID4+PiAxNiksIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKCg2NTI4MCAmIHQpID4+PiA4KSwgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmQoMjU1ICYgdCkgfSBwYWNrX3VpbnQ2NChlKSB7IGxldCB0ID0gZSAvIDQyOTQ5NjcyOTYsIG4gPSBlICUgNDI5NDk2NzI5NjsgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmQoKDQyNzgxOTAwODAgJiB0KSA+Pj4gMjQpLCB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgoMTY3MTE2ODAgJiB0KSA+Pj4gMTYpLCB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgoNjUyODAgJiB0KSA+Pj4gOCksIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDI1NSAmIHQpLCB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgoNDI3ODE5MDA4MCAmIG4pID4+PiAyNCksIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKCgxNjcxMTY4MCAmIG4pID4+PiAxNiksIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKCg2NTI4MCAmIG4pID4+PiA4KSwgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmQoMjU1ICYgbikgfSBwYWNrX2ludDgoZSkgeyB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgyNTUgJiBlKSB9IHBhY2tfaW50MTYoZSkgeyB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgoNjUyODAgJiBlKSA+PiA4KSwgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmQoMjU1ICYgZSkgfSBwYWNrX2ludDMyKGUpIHsgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmQoZSA+Pj4gMjQgJiAyNTUpLCB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgoMTY3MTE2ODAgJiBlKSA+Pj4gMTYpLCB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgoNjUyODAgJiBlKSA+Pj4gOCksIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDI1NSAmIGUpIH0gcGFja19pbnQ2NChlKSB7IGxldCB0ID0gTWF0aC5mbG9vcihlIC8gNDI5NDk2NzI5NiksIG4gPSBlICUgNDI5NDk2NzI5NjsgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmQoKDQyNzgxOTAwODAgJiB0KSA+Pj4gMjQpLCB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgoMTY3MTE2ODAgJiB0KSA+Pj4gMTYpLCB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgoNjUyODAgJiB0KSA+Pj4gOCksIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKDI1NSAmIHQpLCB0aGlzLl9idWZmZXJCdWlsZGVyLmFwcGVuZCgoNDI3ODE5MDA4MCAmIG4pID4+PiAyNCksIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKCgxNjcxMTY4MCAmIG4pID4+PiAxNiksIHRoaXMuX2J1ZmZlckJ1aWxkZXIuYXBwZW5kKCg2NTI4MCAmIG4pID4+PiA4KSwgdGhpcy5fYnVmZmVyQnVpbGRlci5hcHBlbmQoMjU1ICYgbikgfSBjb25zdHJ1Y3RvcigpIHsgdGhpcy5fYnVmZmVyQnVpbGRlciA9IG5ldyByLCB0aGlzLl90ZXh0RW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlciB9IH0gbGV0IGMgPSAhMCwgbCA9ICEwOyBmdW5jdGlvbiBwKGUsIHQsIG4pIHsgbGV0IHIgPSBlLm1hdGNoKHQpOyByZXR1cm4gciAmJiByLmxlbmd0aCA+PSBuICYmIHBhcnNlSW50KHJbbl0sIDEwKSB9IGZ1bmN0aW9uIGQoZSwgdCwgbikgeyBpZiAoIWUuUlRDUGVlckNvbm5lY3Rpb24pIHJldHVybjsgbGV0IHIgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSwgaSA9IHIuYWRkRXZlbnRMaXN0ZW5lcjsgci5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKGUsIHIpIHsgaWYgKGUgIT09IHQpIHJldHVybiBpLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IGxldCBvID0gZSA9PiB7IGxldCB0ID0gbihlKTsgdCAmJiAoci5oYW5kbGVFdmVudCA/IHIuaGFuZGxlRXZlbnQodCkgOiByKHQpKSB9OyByZXR1cm4gdGhpcy5fZXZlbnRNYXAgPSB0aGlzLl9ldmVudE1hcCB8fCB7fSwgdGhpcy5fZXZlbnRNYXBbdF0gfHwgKHRoaXMuX2V2ZW50TWFwW3RdID0gbmV3IE1hcCksIHRoaXMuX2V2ZW50TWFwW3RdLnNldChyLCBvKSwgaS5hcHBseSh0aGlzLCBbZSwgb10pIH07IGxldCBvID0gci5yZW1vdmVFdmVudExpc3RlbmVyOyByLnJlbW92ZUV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAoZSwgbikgeyBpZiAoZSAhPT0gdCB8fCAhdGhpcy5fZXZlbnRNYXAgfHwgIXRoaXMuX2V2ZW50TWFwW3RdIHx8ICF0aGlzLl9ldmVudE1hcFt0XS5oYXMobikpIHJldHVybiBvLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IGxldCByID0gdGhpcy5fZXZlbnRNYXBbdF0uZ2V0KG4pOyByZXR1cm4gdGhpcy5fZXZlbnRNYXBbdF0uZGVsZXRlKG4pLCAwID09PSB0aGlzLl9ldmVudE1hcFt0XS5zaXplICYmIGRlbGV0ZSB0aGlzLl9ldmVudE1hcFt0XSwgMCA9PT0gT2JqZWN0LmtleXModGhpcy5fZXZlbnRNYXApLmxlbmd0aCAmJiBkZWxldGUgdGhpcy5fZXZlbnRNYXAsIG8uYXBwbHkodGhpcywgW2UsIHJdKSB9LCBPYmplY3QuZGVmaW5lUHJvcGVydHkociwgIm9uIiArIHQsIHsgZ2V0KCkgeyByZXR1cm4gdGhpc1siX29uIiArIHRdIH0sIHNldChlKSB7IHRoaXNbIl9vbiIgKyB0XSAmJiAodGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKHQsIHRoaXNbIl9vbiIgKyB0XSksIGRlbGV0ZSB0aGlzWyJfb24iICsgdF0pLCBlICYmIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcih0LCB0aGlzWyJfb24iICsgdF0gPSBlKSB9LCBlbnVtZXJhYmxlOiAhMCwgY29uZmlndXJhYmxlOiAhMCB9KSB9IGZ1bmN0aW9uIGgoZSkgeyByZXR1cm4gImJvb2xlYW4iICE9IHR5cGVvZiBlID8gRXJyb3IoIkFyZ3VtZW50IHR5cGU6ICIgKyB0eXBlb2YgZSArICIuIFBsZWFzZSB1c2UgYSBib29sZWFuLiIpIDogKGMgPSBlLCBlID8gImFkYXB0ZXIuanMgbG9nZ2luZyBkaXNhYmxlZCIgOiAiYWRhcHRlci5qcyBsb2dnaW5nIGVuYWJsZWQiKSB9IGZ1bmN0aW9uIHUoZSkgeyByZXR1cm4gImJvb2xlYW4iICE9IHR5cGVvZiBlID8gRXJyb3IoIkFyZ3VtZW50IHR5cGU6ICIgKyB0eXBlb2YgZSArICIuIFBsZWFzZSB1c2UgYSBib29sZWFuLiIpIDogKGwgPSAhZSwgImFkYXB0ZXIuanMgZGVwcmVjYXRpb24gd2FybmluZ3MgIiArIChlID8gImRpc2FibGVkIiA6ICJlbmFibGVkIikpIH0gZnVuY3Rpb24gZigpIHsgIm9iamVjdCIgIT0gdHlwZW9mIHdpbmRvdyB8fCBjIHx8ICJ1bmRlZmluZWQiID09IHR5cGVvZiBjb25zb2xlIHx8ICJmdW5jdGlvbiIgIT0gdHlwZW9mIGNvbnNvbGUubG9nIHx8IGNvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cykgfSBmdW5jdGlvbiBtKGUsIHQpIHsgbCAmJiBjb25zb2xlLndhcm4oZSArICIgaXMgZGVwcmVjYXRlZCwgcGxlYXNlIHVzZSAiICsgdCArICIgaW5zdGVhZC4iKSB9IGZ1bmN0aW9uIGcoZSkgeyByZXR1cm4gIltvYmplY3QgT2JqZWN0XSIgPT09IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlKSB9IGZ1bmN0aW9uIHkoZSwgdCwgbikgeyBsZXQgciA9IG4gPyAib3V0Ym91bmQtcnRwIiA6ICJpbmJvdW5kLXJ0cCIsIGkgPSBuZXcgTWFwOyBpZiAobnVsbCA9PT0gdCkgcmV0dXJuIGk7IGxldCBvID0gW107IHJldHVybiBlLmZvckVhY2goZSA9PiB7ICJ0cmFjayIgPT09IGUudHlwZSAmJiBlLnRyYWNrSWRlbnRpZmllciA9PT0gdC5pZCAmJiBvLnB1c2goZSkgfSksIG8uZm9yRWFjaCh0ID0+IHsgZS5mb3JFYWNoKG4gPT4geyBuLnR5cGUgPT09IHIgJiYgbi50cmFja0lkID09PSB0LmlkICYmIGZ1bmN0aW9uIGUodCwgbiwgcikgeyAhbiB8fCByLmhhcyhuLmlkKSB8fCAoci5zZXQobi5pZCwgbiksIE9iamVjdC5rZXlzKG4pLmZvckVhY2goaSA9PiB7IGkuZW5kc1dpdGgoIklkIikgPyBlKHQsIHQuZ2V0KG5baV0pLCByKSA6IGkuZW5kc1dpdGgoIklkcyIpICYmIG5baV0uZm9yRWFjaChuID0+IHsgZSh0LCB0LmdldChuKSwgcikgfSkgfSkpIH0oZSwgbiwgaSkgfSkgfSksIGkgfSB2YXIgXywgQywgYiwgdiwgaywgVCwgUywgUiwgUCwgdywgRSwgRCwgeCwgSSwgTSwgTywgaiA9IHt9OyBmdW5jdGlvbiBMKGUsIHQpIHsgbGV0IG4gPSBlICYmIGUubmF2aWdhdG9yOyBpZiAoIW4ubWVkaWFEZXZpY2VzKSByZXR1cm47IGxldCByID0gZnVuY3Rpb24gKGUpIHsgaWYgKCJvYmplY3QiICE9IHR5cGVvZiBlIHx8IGUubWFuZGF0b3J5IHx8IGUub3B0aW9uYWwpIHJldHVybiBlOyBsZXQgdCA9IHt9OyByZXR1cm4gT2JqZWN0LmtleXMoZSkuZm9yRWFjaChuID0+IHsgaWYgKCJyZXF1aXJlIiA9PT0gbiB8fCAiYWR2YW5jZWQiID09PSBuIHx8ICJtZWRpYVNvdXJjZSIgPT09IG4pIHJldHVybjsgbGV0IHIgPSAib2JqZWN0IiA9PSB0eXBlb2YgZVtuXSA/IGVbbl0gOiB7IGlkZWFsOiBlW25dIH07IHZvaWQgMCAhPT0gci5leGFjdCAmJiAibnVtYmVyIiA9PSB0eXBlb2Ygci5leGFjdCAmJiAoci5taW4gPSByLm1heCA9IHIuZXhhY3QpOyBsZXQgaSA9IGZ1bmN0aW9uIChlLCB0KSB7IHJldHVybiBlID8gZSArIHQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0LnNsaWNlKDEpIDogImRldmljZUlkIiA9PT0gdCA/ICJzb3VyY2VJZCIgOiB0IH07IGlmICh2b2lkIDAgIT09IHIuaWRlYWwpIHsgdC5vcHRpb25hbCA9IHQub3B0aW9uYWwgfHwgW107IGxldCBlID0ge307ICJudW1iZXIiID09IHR5cGVvZiByLmlkZWFsID8gKGVbaSgibWluIiwgbildID0gci5pZGVhbCwgdC5vcHRpb25hbC5wdXNoKGUpLCAoZSA9IHt9KVtpKCJtYXgiLCBuKV0gPSByLmlkZWFsKSA6IGVbaSgiIiwgbildID0gci5pZGVhbCwgdC5vcHRpb25hbC5wdXNoKGUpIH0gdm9pZCAwICE9PSByLmV4YWN0ICYmICJudW1iZXIiICE9IHR5cGVvZiByLmV4YWN0ID8gKHQubWFuZGF0b3J5ID0gdC5tYW5kYXRvcnkgfHwge30sIHQubWFuZGF0b3J5W2koIiIsIG4pXSA9IHIuZXhhY3QpIDogWyJtaW4iLCAibWF4Il0uZm9yRWFjaChlID0+IHsgdm9pZCAwICE9PSByW2VdICYmICh0Lm1hbmRhdG9yeSA9IHQubWFuZGF0b3J5IHx8IHt9LCB0Lm1hbmRhdG9yeVtpKGUsIG4pXSA9IHJbZV0pIH0pIH0pLCBlLmFkdmFuY2VkICYmICh0Lm9wdGlvbmFsID0gKHQub3B0aW9uYWwgfHwgW10pLmNvbmNhdChlLmFkdmFuY2VkKSksIHQgfSwgaSA9IGZ1bmN0aW9uIChlLCBpKSB7IGlmICh0LnZlcnNpb24gPj0gNjEpIHJldHVybiBpKGUpOyBpZiAoKGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGUpKSkgJiYgIm9iamVjdCIgPT0gdHlwZW9mIGUuYXVkaW8pIHsgbGV0IHQgPSBmdW5jdGlvbiAoZSwgdCwgbikgeyB0IGluIGUgJiYgIShuIGluIGUpICYmIChlW25dID0gZVt0XSwgZGVsZXRlIGVbdF0pIH07IHQoKGUgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGUpKSkuYXVkaW8sICJhdXRvR2FpbkNvbnRyb2wiLCAiZ29vZ0F1dG9HYWluQ29udHJvbCIpLCB0KGUuYXVkaW8sICJub2lzZVN1cHByZXNzaW9uIiwgImdvb2dOb2lzZVN1cHByZXNzaW9uIiksIGUuYXVkaW8gPSByKGUuYXVkaW8pIH0gaWYgKGUgJiYgIm9iamVjdCIgPT0gdHlwZW9mIGUudmlkZW8pIHsgbGV0IG8gPSBlLnZpZGVvLmZhY2luZ01vZGU7IG8gPSBvICYmICgib2JqZWN0IiA9PSB0eXBlb2YgbyA/IG8gOiB7IGlkZWFsOiBvIH0pOyBsZXQgcyA9IHQudmVyc2lvbiA8IDY2OyBpZiAobyAmJiAoInVzZXIiID09PSBvLmV4YWN0IHx8ICJlbnZpcm9ubWVudCIgPT09IG8uZXhhY3QgfHwgInVzZXIiID09PSBvLmlkZWFsIHx8ICJlbnZpcm9ubWVudCIgPT09IG8uaWRlYWwpICYmICEobi5tZWRpYURldmljZXMuZ2V0U3VwcG9ydGVkQ29uc3RyYWludHMgJiYgbi5tZWRpYURldmljZXMuZ2V0U3VwcG9ydGVkQ29uc3RyYWludHMoKS5mYWNpbmdNb2RlICYmICFzKSkgeyBsZXQgdDsgaWYgKGRlbGV0ZSBlLnZpZGVvLmZhY2luZ01vZGUsICJlbnZpcm9ubWVudCIgPT09IG8uZXhhY3QgfHwgImVudmlyb25tZW50IiA9PT0gby5pZGVhbCA/IHQgPSBbImJhY2siLCAicmVhciJdIDogKCJ1c2VyIiA9PT0gby5leGFjdCB8fCAidXNlciIgPT09IG8uaWRlYWwpICYmICh0ID0gWyJmcm9udCJdKSwgdCkgcmV0dXJuIG4ubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMoKS50aGVuKG4gPT4geyBsZXQgcyA9IChuID0gbi5maWx0ZXIoZSA9PiAidmlkZW9pbnB1dCIgPT09IGUua2luZCkpLmZpbmQoZSA9PiB0LnNvbWUodCA9PiBlLmxhYmVsLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModCkpKTsgcmV0dXJuICFzICYmIG4ubGVuZ3RoICYmIHQuaW5jbHVkZXMoImJhY2siKSAmJiAocyA9IG5bbi5sZW5ndGggLSAxXSksIHMgJiYgKGUudmlkZW8uZGV2aWNlSWQgPSBvLmV4YWN0ID8geyBleGFjdDogcy5kZXZpY2VJZCB9IDogeyBpZGVhbDogcy5kZXZpY2VJZCB9KSwgZS52aWRlbyA9IHIoZS52aWRlbyksIGYoImNocm9tZTogIiArIEpTT04uc3RyaW5naWZ5KGUpKSwgaShlKSB9KSB9IGUudmlkZW8gPSByKGUudmlkZW8pIH0gcmV0dXJuIGYoImNocm9tZTogIiArIEpTT04uc3RyaW5naWZ5KGUpKSwgaShlKSB9LCBvID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHQudmVyc2lvbiA+PSA2NCA/IGUgOiB7IG5hbWU6ICh7IFBlcm1pc3Npb25EZW5pZWRFcnJvcjogIk5vdEFsbG93ZWRFcnJvciIsIFBlcm1pc3Npb25EaXNtaXNzZWRFcnJvcjogIk5vdEFsbG93ZWRFcnJvciIsIEludmFsaWRTdGF0ZUVycm9yOiAiTm90QWxsb3dlZEVycm9yIiwgRGV2aWNlc05vdEZvdW5kRXJyb3I6ICJOb3RGb3VuZEVycm9yIiwgQ29uc3RyYWludE5vdFNhdGlzZmllZEVycm9yOiAiT3ZlcmNvbnN0cmFpbmVkRXJyb3IiLCBUcmFja1N0YXJ0RXJyb3I6ICJOb3RSZWFkYWJsZUVycm9yIiwgTWVkaWFEZXZpY2VGYWlsZWREdWVUb1NodXRkb3duOiAiTm90QWxsb3dlZEVycm9yIiwgTWVkaWFEZXZpY2VLaWxsU3dpdGNoT246ICJOb3RBbGxvd2VkRXJyb3IiLCBUYWJDYXB0dXJlRXJyb3I6ICJBYm9ydEVycm9yIiwgU2NyZWVuQ2FwdHVyZUVycm9yOiAiQWJvcnRFcnJvciIsIERldmljZUNhcHR1cmVFcnJvcjogIkFib3J0RXJyb3IiIH0pW2UubmFtZV0gfHwgZS5uYW1lLCBtZXNzYWdlOiBlLm1lc3NhZ2UsIGNvbnN0cmFpbnQ6IGUuY29uc3RyYWludCB8fCBlLmNvbnN0cmFpbnROYW1lLCB0b1N0cmluZygpIHsgcmV0dXJuIHRoaXMubmFtZSArICh0aGlzLm1lc3NhZ2UgJiYgIjogIikgKyB0aGlzLm1lc3NhZ2UgfSB9IH07IGlmIChuLmdldFVzZXJNZWRpYSA9IChmdW5jdGlvbiAoZSwgdCwgcikgeyBpKGUsIGUgPT4geyBuLndlYmtpdEdldFVzZXJNZWRpYShlLCB0LCBlID0+IHsgciAmJiByKG8oZSkpIH0pIH0pIH0pLmJpbmQobiksIG4ubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSkgeyBsZXQgZSA9IG4ubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYS5iaW5kKG4ubWVkaWFEZXZpY2VzKTsgbi5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIGkodCwgdCA9PiBlKHQpLnRoZW4oZSA9PiB7IGlmICh0LmF1ZGlvICYmICFlLmdldEF1ZGlvVHJhY2tzKCkubGVuZ3RoIHx8IHQudmlkZW8gJiYgIWUuZ2V0VmlkZW9UcmFja3MoKS5sZW5ndGgpIHRocm93IGUuZ2V0VHJhY2tzKCkuZm9yRWFjaChlID0+IHsgZS5zdG9wKCkgfSksIG5ldyBET01FeGNlcHRpb24oIiIsICJOb3RGb3VuZEVycm9yIik7IHJldHVybiBlIH0sIGUgPT4gUHJvbWlzZS5yZWplY3QobyhlKSkpKSB9IH0gfSBmdW5jdGlvbiBBKGUpIHsgZS5NZWRpYVN0cmVhbSA9IGUuTWVkaWFTdHJlYW0gfHwgZS53ZWJraXRNZWRpYVN0cmVhbSB9IGZ1bmN0aW9uIEIoZSkgeyBpZiAoIm9iamVjdCIgIT0gdHlwZW9mIGUgfHwgIWUuUlRDUGVlckNvbm5lY3Rpb24gfHwgIm9udHJhY2siIGluIGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlKSBkKGUsICJ0cmFjayIsIGUgPT4gKGUudHJhbnNjZWl2ZXIgfHwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsICJ0cmFuc2NlaXZlciIsIHsgdmFsdWU6IHsgcmVjZWl2ZXI6IGUucmVjZWl2ZXIgfSB9KSwgZSkpOyBlbHNlIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLCAib250cmFjayIsIHsgZ2V0KCkgeyByZXR1cm4gdGhpcy5fb250cmFjayB9LCBzZXQoZSkgeyB0aGlzLl9vbnRyYWNrICYmIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigidHJhY2siLCB0aGlzLl9vbnRyYWNrKSwgdGhpcy5hZGRFdmVudExpc3RlbmVyKCJ0cmFjayIsIHRoaXMuX29udHJhY2sgPSBlKSB9LCBlbnVtZXJhYmxlOiAhMCwgY29uZmlndXJhYmxlOiAhMCB9KTsgbGV0IHQgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5zZXRSZW1vdGVEZXNjcmlwdGlvbjsgZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuc2V0UmVtb3RlRGVzY3JpcHRpb24gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9vbnRyYWNrcG9seSB8fCAodGhpcy5fb250cmFja3BvbHkgPSB0ID0+IHsgdC5zdHJlYW0uYWRkRXZlbnRMaXN0ZW5lcigiYWRkdHJhY2siLCBuID0+IHsgbGV0IHI7IHIgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRSZWNlaXZlcnMgPyB0aGlzLmdldFJlY2VpdmVycygpLmZpbmQoZSA9PiBlLnRyYWNrICYmIGUudHJhY2suaWQgPT09IG4udHJhY2suaWQpIDogeyB0cmFjazogbi50cmFjayB9OyBsZXQgaSA9IG5ldyBFdmVudCgidHJhY2siKTsgaS50cmFjayA9IG4udHJhY2ssIGkucmVjZWl2ZXIgPSByLCBpLnRyYW5zY2VpdmVyID0geyByZWNlaXZlcjogciB9LCBpLnN0cmVhbXMgPSBbdC5zdHJlYW1dLCB0aGlzLmRpc3BhdGNoRXZlbnQoaSkgfSksIHQuc3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2gobiA9PiB7IGxldCByOyByID0gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0UmVjZWl2ZXJzID8gdGhpcy5nZXRSZWNlaXZlcnMoKS5maW5kKGUgPT4gZS50cmFjayAmJiBlLnRyYWNrLmlkID09PSBuLmlkKSA6IHsgdHJhY2s6IG4gfTsgbGV0IGkgPSBuZXcgRXZlbnQoInRyYWNrIik7IGkudHJhY2sgPSBuLCBpLnJlY2VpdmVyID0gciwgaS50cmFuc2NlaXZlciA9IHsgcmVjZWl2ZXI6IHIgfSwgaS5zdHJlYW1zID0gW3Quc3RyZWFtXSwgdGhpcy5kaXNwYXRjaEV2ZW50KGkpIH0pIH0sIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcigiYWRkc3RyZWFtIiwgdGhpcy5fb250cmFja3BvbHkpKSwgdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH0gfSB9IGZ1bmN0aW9uIEYoZSkgeyBpZiAoIm9iamVjdCIgPT0gdHlwZW9mIGUgJiYgZS5SVENQZWVyQ29ubmVjdGlvbiAmJiAhKCJnZXRTZW5kZXJzIiBpbiBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSkgJiYgImNyZWF0ZURUTUZTZW5kZXIiIGluIGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlKSB7IGxldCB0ID0gZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIHsgdHJhY2s6IHQsIGdldCBkdG1mKCkgeyByZXR1cm4gdm9pZCAwID09PSB0aGlzLl9kdG1mICYmICgiYXVkaW8iID09PSB0LmtpbmQgPyB0aGlzLl9kdG1mID0gZS5jcmVhdGVEVE1GU2VuZGVyKHQpIDogdGhpcy5fZHRtZiA9IG51bGwpLCB0aGlzLl9kdG1mIH0sIF9wYzogZSB9IH07IGlmICghZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0U2VuZGVycykgeyBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTZW5kZXJzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fc2VuZGVycyA9IHRoaXMuX3NlbmRlcnMgfHwgW10sIHRoaXMuX3NlbmRlcnMuc2xpY2UoKSB9OyBsZXQgbiA9IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZFRyYWNrOyBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5hZGRUcmFjayA9IGZ1bmN0aW9uIChlLCByKSB7IGxldCBpID0gbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyByZXR1cm4gaSB8fCAoaSA9IHQodGhpcywgZSksIHRoaXMuX3NlbmRlcnMucHVzaChpKSksIGkgfTsgbGV0IHIgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVUcmFjazsgZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUucmVtb3ZlVHJhY2sgPSBmdW5jdGlvbiAoZSkgeyByLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IGxldCB0ID0gdGhpcy5fc2VuZGVycy5pbmRleE9mKGUpOyAtMSAhPT0gdCAmJiB0aGlzLl9zZW5kZXJzLnNwbGljZSh0LCAxKSB9IH0gbGV0IG4gPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5hZGRTdHJlYW07IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZFN0cmVhbSA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX3NlbmRlcnMgPSB0aGlzLl9zZW5kZXJzIHx8IFtdLCBuLmFwcGx5KHRoaXMsIFtlXSksIGUuZ2V0VHJhY2tzKCkuZm9yRWFjaChlID0+IHsgdGhpcy5fc2VuZGVycy5wdXNoKHQodGhpcywgZSkpIH0pIH07IGxldCByID0gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUucmVtb3ZlU3RyZWFtOyBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVTdHJlYW0gPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9zZW5kZXJzID0gdGhpcy5fc2VuZGVycyB8fCBbXSwgci5hcHBseSh0aGlzLCBbZV0pLCBlLmdldFRyYWNrcygpLmZvckVhY2goZSA9PiB7IGxldCB0ID0gdGhpcy5fc2VuZGVycy5maW5kKHQgPT4gdC50cmFjayA9PT0gZSk7IHQgJiYgdGhpcy5fc2VuZGVycy5zcGxpY2UodGhpcy5fc2VuZGVycy5pbmRleE9mKHQpLCAxKSB9KSB9IH0gZWxzZSBpZiAoIm9iamVjdCIgPT0gdHlwZW9mIGUgJiYgZS5SVENQZWVyQ29ubmVjdGlvbiAmJiAiZ2V0U2VuZGVycyIgaW4gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUgJiYgImNyZWF0ZURUTUZTZW5kZXIiIGluIGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlICYmIGUuUlRDUnRwU2VuZGVyICYmICEoImR0bWYiIGluIGUuUlRDUnRwU2VuZGVyLnByb3RvdHlwZSkpIHsgbGV0IHQgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTZW5kZXJzOyBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTZW5kZXJzID0gZnVuY3Rpb24gKCkgeyBsZXQgZSA9IHQuYXBwbHkodGhpcywgW10pOyByZXR1cm4gZS5mb3JFYWNoKGUgPT4gZS5fcGMgPSB0aGlzKSwgZSB9LCBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5SVENSdHBTZW5kZXIucHJvdG90eXBlLCAiZHRtZiIsIHsgZ2V0KCkgeyByZXR1cm4gdm9pZCAwID09PSB0aGlzLl9kdG1mICYmICgiYXVkaW8iID09PSB0aGlzLnRyYWNrLmtpbmQgPyB0aGlzLl9kdG1mID0gdGhpcy5fcGMuY3JlYXRlRFRNRlNlbmRlcih0aGlzLnRyYWNrKSA6IHRoaXMuX2R0bWYgPSBudWxsKSwgdGhpcy5fZHRtZiB9IH0pIH0gfSBmdW5jdGlvbiBVKGUpIHsgaWYgKCEoIm9iamVjdCIgPT0gdHlwZW9mIGUgJiYgZS5SVENQZWVyQ29ubmVjdGlvbiAmJiBlLlJUQ1J0cFNlbmRlciAmJiBlLlJUQ1J0cFJlY2VpdmVyKSkgcmV0dXJuOyBpZiAoISgiZ2V0U3RhdHMiIGluIGUuUlRDUnRwU2VuZGVyLnByb3RvdHlwZSkpIHsgbGV0IHQgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTZW5kZXJzOyB0ICYmIChlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTZW5kZXJzID0gZnVuY3Rpb24gKCkgeyBsZXQgZSA9IHQuYXBwbHkodGhpcywgW10pOyByZXR1cm4gZS5mb3JFYWNoKGUgPT4gZS5fcGMgPSB0aGlzKSwgZSB9KTsgbGV0IG4gPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5hZGRUcmFjazsgbiAmJiAoZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2sgPSBmdW5jdGlvbiAoKSB7IGxldCBlID0gbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyByZXR1cm4gZS5fcGMgPSB0aGlzLCBlIH0pLCBlLlJUQ1J0cFNlbmRlci5wcm90b3R5cGUuZ2V0U3RhdHMgPSBmdW5jdGlvbiAoKSB7IGxldCBlID0gdGhpczsgcmV0dXJuIHRoaXMuX3BjLmdldFN0YXRzKCkudGhlbih0ID0+IHkodCwgZS50cmFjaywgITApKSB9IH0gaWYgKCEoImdldFN0YXRzIiBpbiBlLlJUQ1J0cFJlY2VpdmVyLnByb3RvdHlwZSkpIHsgbGV0IHQgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRSZWNlaXZlcnM7IHQgJiYgKGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFJlY2VpdmVycyA9IGZ1bmN0aW9uICgpIHsgbGV0IGUgPSB0LmFwcGx5KHRoaXMsIFtdKTsgcmV0dXJuIGUuZm9yRWFjaChlID0+IGUuX3BjID0gdGhpcyksIGUgfSksIGQoZSwgInRyYWNrIiwgZSA9PiAoZS5yZWNlaXZlci5fcGMgPSBlLnNyY0VsZW1lbnQsIGUpKSwgZS5SVENSdHBSZWNlaXZlci5wcm90b3R5cGUuZ2V0U3RhdHMgPSBmdW5jdGlvbiAoKSB7IGxldCBlID0gdGhpczsgcmV0dXJuIHRoaXMuX3BjLmdldFN0YXRzKCkudGhlbih0ID0+IHkodCwgZS50cmFjaywgITEpKSB9IH0gaWYgKCEoImdldFN0YXRzIiBpbiBlLlJUQ1J0cFNlbmRlci5wcm90b3R5cGUgJiYgImdldFN0YXRzIiBpbiBlLlJUQ1J0cFJlY2VpdmVyLnByb3RvdHlwZSkpIHJldHVybjsgbGV0IHQgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTdGF0czsgZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0U3RhdHMgPSBmdW5jdGlvbiAoKSB7IGlmIChhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gaW5zdGFuY2VvZiBlLk1lZGlhU3RyZWFtVHJhY2spIHsgbGV0IGUsIHQsIG47IGxldCByID0gYXJndW1lbnRzWzBdOyByZXR1cm4gKHRoaXMuZ2V0U2VuZGVycygpLmZvckVhY2godCA9PiB7IHQudHJhY2sgPT09IHIgJiYgKGUgPyBuID0gITAgOiBlID0gdCkgfSksIHRoaXMuZ2V0UmVjZWl2ZXJzKCkuZm9yRWFjaChlID0+IChlLnRyYWNrID09PSByICYmICh0ID8gbiA9ICEwIDogdCA9IGUpLCBlLnRyYWNrID09PSByKSksIG4gfHwgZSAmJiB0KSA/IFByb21pc2UucmVqZWN0KG5ldyBET01FeGNlcHRpb24oIlRoZXJlIGFyZSBtb3JlIHRoYW4gb25lIHNlbmRlciBvciByZWNlaXZlciBmb3IgdGhlIHRyYWNrLiIsICJJbnZhbGlkQWNjZXNzRXJyb3IiKSkgOiBlID8gZS5nZXRTdGF0cygpIDogdCA/IHQuZ2V0U3RhdHMoKSA6IFByb21pc2UucmVqZWN0KG5ldyBET01FeGNlcHRpb24oIlRoZXJlIGlzIG5vIHNlbmRlciBvciByZWNlaXZlciBmb3IgdGhlIHRyYWNrLiIsICJJbnZhbGlkQWNjZXNzRXJyb3IiKSkgfSByZXR1cm4gdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH0gfSBmdW5jdGlvbiB6KGUpIHsgZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0TG9jYWxTdHJlYW1zID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fc2hpbW1lZExvY2FsU3RyZWFtcyA9IHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXMgfHwge30sIE9iamVjdC5rZXlzKHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXMpLm1hcChlID0+IHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXNbZV1bMF0pIH07IGxldCB0ID0gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2s7IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZFRyYWNrID0gZnVuY3Rpb24gKGUsIG4pIHsgaWYgKCFuKSByZXR1cm4gdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zID0gdGhpcy5fc2hpbW1lZExvY2FsU3RyZWFtcyB8fCB7fTsgbGV0IHIgPSB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IHJldHVybiB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zW24uaWRdID8gLTEgPT09IHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXNbbi5pZF0uaW5kZXhPZihyKSAmJiB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zW24uaWRdLnB1c2gocikgOiB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zW24uaWRdID0gW24sIHJdLCByIH07IGxldCBuID0gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkU3RyZWFtOyBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5hZGRTdHJlYW0gPSBmdW5jdGlvbiAoZSkgeyB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zID0gdGhpcy5fc2hpbW1lZExvY2FsU3RyZWFtcyB8fCB7fSwgZS5nZXRUcmFja3MoKS5mb3JFYWNoKGUgPT4geyBpZiAodGhpcy5nZXRTZW5kZXJzKCkuZmluZCh0ID0+IHQudHJhY2sgPT09IGUpKSB0aHJvdyBuZXcgRE9NRXhjZXB0aW9uKCJUcmFjayBhbHJlYWR5IGV4aXN0cy4iLCAiSW52YWxpZEFjY2Vzc0Vycm9yIikgfSk7IGxldCB0ID0gdGhpcy5nZXRTZW5kZXJzKCk7IG4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsgbGV0IHIgPSB0aGlzLmdldFNlbmRlcnMoKS5maWx0ZXIoZSA9PiAtMSA9PT0gdC5pbmRleE9mKGUpKTsgdGhpcy5fc2hpbW1lZExvY2FsU3RyZWFtc1tlLmlkXSA9IFtlXS5jb25jYXQocikgfTsgbGV0IHIgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVTdHJlYW07IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnJlbW92ZVN0cmVhbSA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zID0gdGhpcy5fc2hpbW1lZExvY2FsU3RyZWFtcyB8fCB7fSwgZGVsZXRlIHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXNbZS5pZF0sIHIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB9OyBsZXQgaSA9IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnJlbW92ZVRyYWNrOyBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVUcmFjayA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zID0gdGhpcy5fc2hpbW1lZExvY2FsU3RyZWFtcyB8fCB7fSwgZSAmJiBPYmplY3Qua2V5cyh0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zKS5mb3JFYWNoKHQgPT4geyBsZXQgbiA9IHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXNbdF0uaW5kZXhPZihlKTsgLTEgIT09IG4gJiYgdGhpcy5fc2hpbW1lZExvY2FsU3RyZWFtc1t0XS5zcGxpY2UobiwgMSksIDEgPT09IHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXNbdF0ubGVuZ3RoICYmIGRlbGV0ZSB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zW3RdIH0pLCBpLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfSB9IGZ1bmN0aW9uIE4oZSwgdCkgeyBpZiAoIWUuUlRDUGVlckNvbm5lY3Rpb24pIHJldHVybjsgaWYgKGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZFRyYWNrICYmIHQudmVyc2lvbiA+PSA2NSkgcmV0dXJuIHooZSk7IGxldCBuID0gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0TG9jYWxTdHJlYW1zOyBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRMb2NhbFN0cmVhbXMgPSBmdW5jdGlvbiAoKSB7IGxldCBlID0gbi5hcHBseSh0aGlzKTsgcmV0dXJuIHRoaXMuX3JldmVyc2VTdHJlYW1zID0gdGhpcy5fcmV2ZXJzZVN0cmVhbXMgfHwge30sIGUubWFwKGUgPT4gdGhpcy5fcmV2ZXJzZVN0cmVhbXNbZS5pZF0pIH07IGxldCByID0gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkU3RyZWFtOyBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5hZGRTdHJlYW0gPSBmdW5jdGlvbiAodCkgeyBpZiAodGhpcy5fc3RyZWFtcyA9IHRoaXMuX3N0cmVhbXMgfHwge30sIHRoaXMuX3JldmVyc2VTdHJlYW1zID0gdGhpcy5fcmV2ZXJzZVN0cmVhbXMgfHwge30sIHQuZ2V0VHJhY2tzKCkuZm9yRWFjaChlID0+IHsgaWYgKHRoaXMuZ2V0U2VuZGVycygpLmZpbmQodCA9PiB0LnRyYWNrID09PSBlKSkgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbigiVHJhY2sgYWxyZWFkeSBleGlzdHMuIiwgIkludmFsaWRBY2Nlc3NFcnJvciIpIH0pLCAhdGhpcy5fcmV2ZXJzZVN0cmVhbXNbdC5pZF0pIHsgbGV0IG4gPSBuZXcgZS5NZWRpYVN0cmVhbSh0LmdldFRyYWNrcygpKTsgdGhpcy5fc3RyZWFtc1t0LmlkXSA9IG4sIHRoaXMuX3JldmVyc2VTdHJlYW1zW24uaWRdID0gdCwgdCA9IG4gfSByLmFwcGx5KHRoaXMsIFt0XSkgfTsgbGV0IGkgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVTdHJlYW07IGZ1bmN0aW9uIG8oZSwgdCkgeyBsZXQgbiA9IHQuc2RwOyByZXR1cm4gT2JqZWN0LmtleXMoZS5fcmV2ZXJzZVN0cmVhbXMgfHwgW10pLmZvckVhY2godCA9PiB7IGxldCByID0gZS5fcmV2ZXJzZVN0cmVhbXNbdF0sIGkgPSBlLl9zdHJlYW1zW3IuaWRdOyBuID0gbi5yZXBsYWNlKFJlZ0V4cChpLmlkLCAiZyIpLCByLmlkKSB9KSwgbmV3IFJUQ1Nlc3Npb25EZXNjcmlwdGlvbih7IHR5cGU6IHQudHlwZSwgc2RwOiBuIH0pIH0gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUucmVtb3ZlU3RyZWFtID0gZnVuY3Rpb24gKGUpIHsgdGhpcy5fc3RyZWFtcyA9IHRoaXMuX3N0cmVhbXMgfHwge30sIHRoaXMuX3JldmVyc2VTdHJlYW1zID0gdGhpcy5fcmV2ZXJzZVN0cmVhbXMgfHwge30sIGkuYXBwbHkodGhpcywgW3RoaXMuX3N0cmVhbXNbZS5pZF0gfHwgZV0pLCBkZWxldGUgdGhpcy5fcmV2ZXJzZVN0cmVhbXNbdGhpcy5fc3RyZWFtc1tlLmlkXSA/IHRoaXMuX3N0cmVhbXNbZS5pZF0uaWQgOiBlLmlkXSwgZGVsZXRlIHRoaXMuX3N0cmVhbXNbZS5pZF0gfSwgZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2sgPSBmdW5jdGlvbiAodCwgbikgeyBpZiAoImNsb3NlZCIgPT09IHRoaXMuc2lnbmFsaW5nU3RhdGUpIHRocm93IG5ldyBET01FeGNlcHRpb24oIlRoZSBSVENQZWVyQ29ubmVjdGlvbidzIHNpZ25hbGluZ1N0YXRlIGlzICdjbG9zZWQnLiIsICJJbnZhbGlkU3RhdGVFcnJvciIpOyBsZXQgciA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsgaWYgKDEgIT09IHIubGVuZ3RoIHx8ICFyWzBdLmdldFRyYWNrcygpLmZpbmQoZSA9PiBlID09PSB0KSkgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbigiVGhlIGFkYXB0ZXIuanMgYWRkVHJhY2sgcG9seWZpbGwgb25seSBzdXBwb3J0cyBhIHNpbmdsZSAgc3RyZWFtIHdoaWNoIGlzIGFzc29jaWF0ZWQgd2l0aCB0aGUgc3BlY2lmaWVkIHRyYWNrLiIsICJOb3RTdXBwb3J0ZWRFcnJvciIpOyBpZiAodGhpcy5nZXRTZW5kZXJzKCkuZmluZChlID0+IGUudHJhY2sgPT09IHQpKSB0aHJvdyBuZXcgRE9NRXhjZXB0aW9uKCJUcmFjayBhbHJlYWR5IGV4aXN0cy4iLCAiSW52YWxpZEFjY2Vzc0Vycm9yIik7IHRoaXMuX3N0cmVhbXMgPSB0aGlzLl9zdHJlYW1zIHx8IHt9LCB0aGlzLl9yZXZlcnNlU3RyZWFtcyA9IHRoaXMuX3JldmVyc2VTdHJlYW1zIHx8IHt9OyBsZXQgaSA9IHRoaXMuX3N0cmVhbXNbbi5pZF07IGlmIChpKSBpLmFkZFRyYWNrKHQpLCBQcm9taXNlLnJlc29sdmUoKS50aGVuKCgpID0+IHsgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgibmVnb3RpYXRpb25uZWVkZWQiKSkgfSk7IGVsc2UgeyBsZXQgciA9IG5ldyBlLk1lZGlhU3RyZWFtKFt0XSk7IHRoaXMuX3N0cmVhbXNbbi5pZF0gPSByLCB0aGlzLl9yZXZlcnNlU3RyZWFtc1tyLmlkXSA9IG4sIHRoaXMuYWRkU3RyZWFtKHIpIH0gcmV0dXJuIHRoaXMuZ2V0U2VuZGVycygpLmZpbmQoZSA9PiBlLnRyYWNrID09PSB0KSB9LCBbImNyZWF0ZU9mZmVyIiwgImNyZWF0ZUFuc3dlciJdLmZvckVhY2goZnVuY3Rpb24gKHQpIHsgbGV0IG4gPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZVt0XTsgZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGVbdF0gPSAoeyBbdF0oKSB7IGxldCBlID0gYXJndW1lbnRzLCB0ID0gYXJndW1lbnRzLmxlbmd0aCAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBhcmd1bWVudHNbMF07IHJldHVybiB0ID8gbi5hcHBseSh0aGlzLCBbdCA9PiB7IGxldCBuID0gbyh0aGlzLCB0KTsgZVswXS5hcHBseShudWxsLCBbbl0pIH0sIHQgPT4geyBlWzFdICYmIGVbMV0uYXBwbHkobnVsbCwgdCkgfSwgYXJndW1lbnRzWzJdXSkgOiBuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykudGhlbihlID0+IG8odGhpcywgZSkpIH0gfSlbdF0gfSk7IGxldCBzID0gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuc2V0TG9jYWxEZXNjcmlwdGlvbjsgZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuc2V0TG9jYWxEZXNjcmlwdGlvbiA9IGZ1bmN0aW9uICgpIHsgdmFyIGUsIHQ7IGxldCBuOyByZXR1cm4gYXJndW1lbnRzLmxlbmd0aCAmJiBhcmd1bWVudHNbMF0udHlwZSAmJiAoYXJndW1lbnRzWzBdID0gKGUgPSB0aGlzLCB0ID0gYXJndW1lbnRzWzBdLCBuID0gdC5zZHAsIE9iamVjdC5rZXlzKGUuX3JldmVyc2VTdHJlYW1zIHx8IFtdKS5mb3JFYWNoKHQgPT4geyBsZXQgciA9IGUuX3JldmVyc2VTdHJlYW1zW3RdLCBpID0gZS5fc3RyZWFtc1tyLmlkXTsgbiA9IG4ucmVwbGFjZShSZWdFeHAoci5pZCwgImciKSwgaS5pZCkgfSksIG5ldyBSVENTZXNzaW9uRGVzY3JpcHRpb24oeyB0eXBlOiB0LnR5cGUsIHNkcDogbiB9KSkpLCBzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfTsgbGV0IGEgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLCAibG9jYWxEZXNjcmlwdGlvbiIpOyBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUsICJsb2NhbERlc2NyaXB0aW9uIiwgeyBnZXQoKSB7IGxldCBlID0gYS5nZXQuYXBwbHkodGhpcyk7IHJldHVybiAiIiA9PT0gZS50eXBlID8gZSA6IG8odGhpcywgZSkgfSB9KSwgZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUucmVtb3ZlVHJhY2sgPSBmdW5jdGlvbiAoZSkgeyBsZXQgdDsgaWYgKCJjbG9zZWQiID09PSB0aGlzLnNpZ25hbGluZ1N0YXRlKSB0aHJvdyBuZXcgRE9NRXhjZXB0aW9uKCJUaGUgUlRDUGVlckNvbm5lY3Rpb24ncyBzaWduYWxpbmdTdGF0ZSBpcyAnY2xvc2VkJy4iLCAiSW52YWxpZFN0YXRlRXJyb3IiKTsgaWYgKCFlLl9wYykgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbigiQXJndW1lbnQgMSBvZiBSVENQZWVyQ29ubmVjdGlvbi5yZW1vdmVUcmFjayBkb2VzIG5vdCBpbXBsZW1lbnQgaW50ZXJmYWNlIFJUQ1J0cFNlbmRlci4iLCAiVHlwZUVycm9yIik7IGlmIChlLl9wYyAhPT0gdGhpcykgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbigiU2VuZGVyIHdhcyBub3QgY3JlYXRlZCBieSB0aGlzIGNvbm5lY3Rpb24uIiwgIkludmFsaWRBY2Nlc3NFcnJvciIpOyB0aGlzLl9zdHJlYW1zID0gdGhpcy5fc3RyZWFtcyB8fCB7fSwgT2JqZWN0LmtleXModGhpcy5fc3RyZWFtcykuZm9yRWFjaChuID0+IHsgdGhpcy5fc3RyZWFtc1tuXS5nZXRUcmFja3MoKS5maW5kKHQgPT4gZS50cmFjayA9PT0gdCkgJiYgKHQgPSB0aGlzLl9zdHJlYW1zW25dKSB9KSwgdCAmJiAoMSA9PT0gdC5nZXRUcmFja3MoKS5sZW5ndGggPyB0aGlzLnJlbW92ZVN0cmVhbSh0aGlzLl9yZXZlcnNlU3RyZWFtc1t0LmlkXSkgOiB0LnJlbW92ZVRyYWNrKGUudHJhY2spLCB0aGlzLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJuZWdvdGlhdGlvbm5lZWRlZCIpKSkgfSB9IGZ1bmN0aW9uICQoZSwgdCkgeyAhZS5SVENQZWVyQ29ubmVjdGlvbiAmJiBlLndlYmtpdFJUQ1BlZXJDb25uZWN0aW9uICYmIChlLlJUQ1BlZXJDb25uZWN0aW9uID0gZS53ZWJraXRSVENQZWVyQ29ubmVjdGlvbiksIGUuUlRDUGVlckNvbm5lY3Rpb24gJiYgdC52ZXJzaW9uIDwgNTMgJiYgWyJzZXRMb2NhbERlc2NyaXB0aW9uIiwgInNldFJlbW90ZURlc2NyaXB0aW9uIiwgImFkZEljZUNhbmRpZGF0ZSJdLmZvckVhY2goZnVuY3Rpb24gKHQpIHsgbGV0IG4gPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZVt0XTsgZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGVbdF0gPSAoeyBbdF0oKSB7IHJldHVybiBhcmd1bWVudHNbMF0gPSBuZXcgKCJhZGRJY2VDYW5kaWRhdGUiID09PSB0ID8gZS5SVENJY2VDYW5kaWRhdGUgOiBlLlJUQ1Nlc3Npb25EZXNjcmlwdGlvbikoYXJndW1lbnRzWzBdKSwgbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH0gfSlbdF0gfSkgfSBmdW5jdGlvbiBKKGUsIHQpIHsgZChlLCAibmVnb3RpYXRpb25uZWVkZWQiLCBlID0+IHsgbGV0IG4gPSBlLnRhcmdldDsgaWYgKCEodC52ZXJzaW9uIDwgNzIpICYmICghbi5nZXRDb25maWd1cmF0aW9uIHx8ICJwbGFuLWIiICE9PSBuLmdldENvbmZpZ3VyYXRpb24oKS5zZHBTZW1hbnRpY3MpIHx8ICJzdGFibGUiID09PSBuLnNpZ25hbGluZ1N0YXRlKSByZXR1cm4gZSB9KSB9IGUoaiwgInNoaW1NZWRpYVN0cmVhbSIsICgpID0+IEEpLCBlKGosICJzaGltT25UcmFjayIsICgpID0+IEIpLCBlKGosICJzaGltR2V0U2VuZGVyc1dpdGhEdG1mIiwgKCkgPT4gRiksIGUoaiwgInNoaW1TZW5kZXJSZWNlaXZlckdldFN0YXRzIiwgKCkgPT4gVSksIGUoaiwgInNoaW1BZGRUcmFja1JlbW92ZVRyYWNrV2l0aE5hdGl2ZSIsICgpID0+IHopLCBlKGosICJzaGltQWRkVHJhY2tSZW1vdmVUcmFjayIsICgpID0+IE4pLCBlKGosICJzaGltUGVlckNvbm5lY3Rpb24iLCAoKSA9PiAkKSwgZShqLCAiZml4TmVnb3RpYXRpb25OZWVkZWQiLCAoKSA9PiBKKSwgZShqLCAic2hpbUdldFVzZXJNZWRpYSIsICgpID0+IEwpOyB2YXIgViA9IHt9OyBmdW5jdGlvbiBHKGUsIHQpIHsgbGV0IG4gPSBlICYmIGUubmF2aWdhdG9yLCByID0gZSAmJiBlLk1lZGlhU3RyZWFtVHJhY2s7IGlmIChuLmdldFVzZXJNZWRpYSA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7IG0oIm5hdmlnYXRvci5nZXRVc2VyTWVkaWEiLCAibmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEiKSwgbi5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKGUpLnRoZW4odCwgbikgfSwgISh0LnZlcnNpb24gPiA1NSAmJiAiYXV0b0dhaW5Db250cm9sIiBpbiBuLm1lZGlhRGV2aWNlcy5nZXRTdXBwb3J0ZWRDb25zdHJhaW50cygpKSkgeyBsZXQgZSA9IGZ1bmN0aW9uIChlLCB0LCBuKSB7IHQgaW4gZSAmJiAhKG4gaW4gZSkgJiYgKGVbbl0gPSBlW3RdLCBkZWxldGUgZVt0XSkgfSwgdCA9IG4ubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYS5iaW5kKG4ubWVkaWFEZXZpY2VzKTsgaWYgKG4ubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSA9IGZ1bmN0aW9uIChuKSB7IHJldHVybiAib2JqZWN0IiA9PSB0eXBlb2YgbiAmJiAib2JqZWN0IiA9PSB0eXBlb2Ygbi5hdWRpbyAmJiAoZSgobiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobikpKS5hdWRpbywgImF1dG9HYWluQ29udHJvbCIsICJtb3pBdXRvR2FpbkNvbnRyb2wiKSwgZShuLmF1ZGlvLCAibm9pc2VTdXBwcmVzc2lvbiIsICJtb3pOb2lzZVN1cHByZXNzaW9uIikpLCB0KG4pIH0sIHIgJiYgci5wcm90b3R5cGUuZ2V0U2V0dGluZ3MpIHsgbGV0IHQgPSByLnByb3RvdHlwZS5nZXRTZXR0aW5nczsgci5wcm90b3R5cGUuZ2V0U2V0dGluZ3MgPSBmdW5jdGlvbiAoKSB7IGxldCBuID0gdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyByZXR1cm4gZShuLCAibW96QXV0b0dhaW5Db250cm9sIiwgImF1dG9HYWluQ29udHJvbCIpLCBlKG4sICJtb3pOb2lzZVN1cHByZXNzaW9uIiwgIm5vaXNlU3VwcHJlc3Npb24iKSwgbiB9IH0gaWYgKHIgJiYgci5wcm90b3R5cGUuYXBwbHlDb25zdHJhaW50cykgeyBsZXQgdCA9IHIucHJvdG90eXBlLmFwcGx5Q29uc3RyYWludHM7IHIucHJvdG90eXBlLmFwcGx5Q29uc3RyYWludHMgPSBmdW5jdGlvbiAobikgeyByZXR1cm4gImF1ZGlvIiA9PT0gdGhpcy5raW5kICYmICJvYmplY3QiID09IHR5cGVvZiBuICYmIChlKG4gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG4pKSwgImF1dG9HYWluQ29udHJvbCIsICJtb3pBdXRvR2FpbkNvbnRyb2wiKSwgZShuLCAibm9pc2VTdXBwcmVzc2lvbiIsICJtb3pOb2lzZVN1cHByZXNzaW9uIikpLCB0LmFwcGx5KHRoaXMsIFtuXSkgfSB9IH0gfSBmdW5jdGlvbiBXKGUsIHQpIHsgZS5uYXZpZ2F0b3IubWVkaWFEZXZpY2VzICYmICJnZXREaXNwbGF5TWVkaWEiIGluIGUubmF2aWdhdG9yLm1lZGlhRGV2aWNlcyB8fCAhZS5uYXZpZ2F0b3IubWVkaWFEZXZpY2VzIHx8IChlLm5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0RGlzcGxheU1lZGlhID0gZnVuY3Rpb24gKG4pIHsgaWYgKCEobiAmJiBuLnZpZGVvKSkgeyBsZXQgZSA9IG5ldyBET01FeGNlcHRpb24oImdldERpc3BsYXlNZWRpYSB3aXRob3V0IHZpZGVvIGNvbnN0cmFpbnRzIGlzIHVuZGVmaW5lZCIpOyByZXR1cm4gZS5uYW1lID0gIk5vdEZvdW5kRXJyb3IiLCBlLmNvZGUgPSA4LCBQcm9taXNlLnJlamVjdChlKSB9IHJldHVybiAhMCA9PT0gbi52aWRlbyA/IG4udmlkZW8gPSB7IG1lZGlhU291cmNlOiB0IH0gOiBuLnZpZGVvLm1lZGlhU291cmNlID0gdCwgZS5uYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShuKSB9KSB9IGZ1bmN0aW9uIEgoZSkgeyAib2JqZWN0IiA9PSB0eXBlb2YgZSAmJiBlLlJUQ1RyYWNrRXZlbnQgJiYgInJlY2VpdmVyIiBpbiBlLlJUQ1RyYWNrRXZlbnQucHJvdG90eXBlICYmICEoInRyYW5zY2VpdmVyIiBpbiBlLlJUQ1RyYWNrRXZlbnQucHJvdG90eXBlKSAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5SVENUcmFja0V2ZW50LnByb3RvdHlwZSwgInRyYW5zY2VpdmVyIiwgeyBnZXQoKSB7IHJldHVybiB7IHJlY2VpdmVyOiB0aGlzLnJlY2VpdmVyIH0gfSB9KSB9IGZ1bmN0aW9uIFkoZSwgdCkgeyBpZiAoIm9iamVjdCIgIT0gdHlwZW9mIGUgfHwgIShlLlJUQ1BlZXJDb25uZWN0aW9uIHx8IGUubW96UlRDUGVlckNvbm5lY3Rpb24pKSByZXR1cm47ICFlLlJUQ1BlZXJDb25uZWN0aW9uICYmIGUubW96UlRDUGVlckNvbm5lY3Rpb24gJiYgKGUuUlRDUGVlckNvbm5lY3Rpb24gPSBlLm1velJUQ1BlZXJDb25uZWN0aW9uKSwgdC52ZXJzaW9uIDwgNTMgJiYgWyJzZXRMb2NhbERlc2NyaXB0aW9uIiwgInNldFJlbW90ZURlc2NyaXB0aW9uIiwgImFkZEljZUNhbmRpZGF0ZSJdLmZvckVhY2goZnVuY3Rpb24gKHQpIHsgbGV0IG4gPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZVt0XTsgZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGVbdF0gPSAoeyBbdF0oKSB7IHJldHVybiBhcmd1bWVudHNbMF0gPSBuZXcgKCJhZGRJY2VDYW5kaWRhdGUiID09PSB0ID8gZS5SVENJY2VDYW5kaWRhdGUgOiBlLlJUQ1Nlc3Npb25EZXNjcmlwdGlvbikoYXJndW1lbnRzWzBdKSwgbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH0gfSlbdF0gfSk7IGxldCBuID0geyBpbmJvdW5kcnRwOiAiaW5ib3VuZC1ydHAiLCBvdXRib3VuZHJ0cDogIm91dGJvdW5kLXJ0cCIsIGNhbmRpZGF0ZXBhaXI6ICJjYW5kaWRhdGUtcGFpciIsIGxvY2FsY2FuZGlkYXRlOiAibG9jYWwtY2FuZGlkYXRlIiwgcmVtb3RlY2FuZGlkYXRlOiAicmVtb3RlLWNhbmRpZGF0ZSIgfSwgciA9IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFN0YXRzOyBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTdGF0cyA9IGZ1bmN0aW9uICgpIHsgbGV0IFtlLCBpLCBvXSA9IGFyZ3VtZW50czsgcmV0dXJuIHIuYXBwbHkodGhpcywgW2UgfHwgbnVsbF0pLnRoZW4oZSA9PiB7IGlmICh0LnZlcnNpb24gPCA1MyAmJiAhaSkgdHJ5IHsgZS5mb3JFYWNoKGUgPT4geyBlLnR5cGUgPSBuW2UudHlwZV0gfHwgZS50eXBlIH0pIH0gY2F0Y2ggKHQpIHsgaWYgKCJUeXBlRXJyb3IiICE9PSB0Lm5hbWUpIHRocm93IHQ7IGUuZm9yRWFjaCgodCwgcikgPT4geyBlLnNldChyLCBPYmplY3QuYXNzaWduKHt9LCB0LCB7IHR5cGU6IG5bdC50eXBlXSB8fCB0LnR5cGUgfSkpIH0pIH0gcmV0dXJuIGUgfSkudGhlbihpLCBvKSB9IH0gZnVuY3Rpb24gSyhlKSB7IGlmICghKCJvYmplY3QiID09IHR5cGVvZiBlICYmIGUuUlRDUGVlckNvbm5lY3Rpb24gJiYgZS5SVENSdHBTZW5kZXIpKSByZXR1cm47IGxldCB0ID0gZS5SVENSdHBTZW5kZXIucHJvdG90eXBlLmdldFBhcmFtZXRlcnM7IHQgJiYgKGUuUlRDUnRwU2VuZGVyLnByb3RvdHlwZS5nZXRQYXJhbWV0ZXJzID0gZnVuY3Rpb24gKCkgeyBsZXQgZSA9IHQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgcmV0dXJuICJlbmNvZGluZ3MiIGluIGUgfHwgKGUuZW5jb2RpbmdzID0gW10uY29uY2F0KHRoaXMuc2VuZEVuY29kaW5ncyB8fCBbe31dKSksIGUgfSkgfSBmdW5jdGlvbiBYKGUpIHsgaWYgKCEoIm9iamVjdCIgPT0gdHlwZW9mIGUgJiYgZS5SVENQZWVyQ29ubmVjdGlvbiAmJiBlLlJUQ1J0cFNlbmRlcikpIHJldHVybjsgbGV0IHQgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRSZWNlaXZlcnM7IHQgJiYgKGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFJlY2VpdmVycyA9IGZ1bmN0aW9uICgpIHsgbGV0IGUgPSB0LmFwcGx5KHRoaXMsIFtdKTsgcmV0dXJuIGUuZm9yRWFjaChlID0+IGUuX3BjID0gdGhpcyksIGUgfSksIGQoZSwgInRyYWNrIiwgZSA9PiAoZS5yZWNlaXZlci5fcGMgPSBlLnNyY0VsZW1lbnQsIGUpKSwgZS5SVENSdHBSZWNlaXZlci5wcm90b3R5cGUuZ2V0U3RhdHMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9wYy5nZXRTdGF0cyh0aGlzLnRyYWNrKSB9IH0gZnVuY3Rpb24gcShlKSB7ICFlLlJUQ1BlZXJDb25uZWN0aW9uIHx8ICJyZW1vdmVTdHJlYW0iIGluIGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlIHx8IChlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVTdHJlYW0gPSBmdW5jdGlvbiAoZSkgeyBtKCJyZW1vdmVTdHJlYW0iLCAicmVtb3ZlVHJhY2siKSwgdGhpcy5nZXRTZW5kZXJzKCkuZm9yRWFjaCh0ID0+IHsgdC50cmFjayAmJiBlLmdldFRyYWNrcygpLmluY2x1ZGVzKHQudHJhY2spICYmIHRoaXMucmVtb3ZlVHJhY2sodCkgfSkgfSkgfSBmdW5jdGlvbiBRKGUpIHsgZS5EYXRhQ2hhbm5lbCAmJiAhZS5SVENEYXRhQ2hhbm5lbCAmJiAoZS5SVENEYXRhQ2hhbm5lbCA9IGUuRGF0YUNoYW5uZWwpIH0gZnVuY3Rpb24gWihlKSB7IGlmICghKCJvYmplY3QiID09IHR5cGVvZiBlICYmIGUuUlRDUGVlckNvbm5lY3Rpb24pKSByZXR1cm47IGxldCB0ID0gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhbnNjZWl2ZXI7IHQgJiYgKGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZFRyYW5zY2VpdmVyID0gZnVuY3Rpb24gKCkgeyB0aGlzLnNldFBhcmFtZXRlcnNQcm9taXNlcyA9IFtdOyBsZXQgZSA9IGFyZ3VtZW50c1sxXSAmJiBhcmd1bWVudHNbMV0uc2VuZEVuY29kaW5nczsgdm9pZCAwID09PSBlICYmIChlID0gW10pOyBsZXQgbiA9IChlID0gWy4uLmVdKS5sZW5ndGggPiAwOyBuICYmIGUuZm9yRWFjaChlID0+IHsgaWYgKCJyaWQiIGluIGUgJiYgIS9eW2EtejAtOV17MCwxNn0kL2kudGVzdChlLnJpZCkpIHRocm93IFR5cGVFcnJvcigiSW52YWxpZCBSSUQgdmFsdWUgcHJvdmlkZWQuIik7IGlmICgic2NhbGVSZXNvbHV0aW9uRG93bkJ5IiBpbiBlICYmICEocGFyc2VGbG9hdChlLnNjYWxlUmVzb2x1dGlvbkRvd25CeSkgPj0gMSkpIHRocm93IFJhbmdlRXJyb3IoInNjYWxlX3Jlc29sdXRpb25fZG93bl9ieSBtdXN0IGJlID49IDEuMCIpOyBpZiAoIm1heEZyYW1lcmF0ZSIgaW4gZSAmJiAhKHBhcnNlRmxvYXQoZS5tYXhGcmFtZXJhdGUpID49IDApKSB0aHJvdyBSYW5nZUVycm9yKCJtYXhfZnJhbWVyYXRlIG11c3QgYmUgPj0gMC4wIikgfSk7IGxldCByID0gdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyBpZiAobikgeyBsZXQgeyBzZW5kZXI6IHQgfSA9IHIsIG4gPSB0LmdldFBhcmFtZXRlcnMoKTsgImVuY29kaW5ncyIgaW4gbiAmJiAoMSAhPT0gbi5lbmNvZGluZ3MubGVuZ3RoIHx8IDAgIT09IE9iamVjdC5rZXlzKG4uZW5jb2RpbmdzWzBdKS5sZW5ndGgpIHx8IChuLmVuY29kaW5ncyA9IGUsIHQuc2VuZEVuY29kaW5ncyA9IGUsIHRoaXMuc2V0UGFyYW1ldGVyc1Byb21pc2VzLnB1c2godC5zZXRQYXJhbWV0ZXJzKG4pLnRoZW4oKCkgPT4geyBkZWxldGUgdC5zZW5kRW5jb2RpbmdzIH0pLmNhdGNoKCgpID0+IHsgZGVsZXRlIHQuc2VuZEVuY29kaW5ncyB9KSkpIH0gcmV0dXJuIHIgfSkgfSBmdW5jdGlvbiBlZShlKSB7IGlmICghKCJvYmplY3QiID09IHR5cGVvZiBlICYmIGUuUlRDUnRwU2VuZGVyKSkgcmV0dXJuOyBsZXQgdCA9IGUuUlRDUnRwU2VuZGVyLnByb3RvdHlwZS5nZXRQYXJhbWV0ZXJzOyB0ICYmIChlLlJUQ1J0cFNlbmRlci5wcm90b3R5cGUuZ2V0UGFyYW1ldGVycyA9IGZ1bmN0aW9uICgpIHsgbGV0IGUgPSB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IHJldHVybiAiZW5jb2RpbmdzIiBpbiBlIHx8IChlLmVuY29kaW5ncyA9IFtdLmNvbmNhdCh0aGlzLnNlbmRFbmNvZGluZ3MgfHwgW3t9XSkpLCBlIH0pIH0gZnVuY3Rpb24gZXQoZSkgeyBpZiAoISgib2JqZWN0IiA9PSB0eXBlb2YgZSAmJiBlLlJUQ1BlZXJDb25uZWN0aW9uKSkgcmV0dXJuOyBsZXQgdCA9IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmNyZWF0ZU9mZmVyOyBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5jcmVhdGVPZmZlciA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuc2V0UGFyYW1ldGVyc1Byb21pc2VzICYmIHRoaXMuc2V0UGFyYW1ldGVyc1Byb21pc2VzLmxlbmd0aCA/IFByb21pc2UuYWxsKHRoaXMuc2V0UGFyYW1ldGVyc1Byb21pc2VzKS50aGVuKCgpID0+IHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSkuZmluYWxseSgoKSA9PiB7IHRoaXMuc2V0UGFyYW1ldGVyc1Byb21pc2VzID0gW10gfSkgOiB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfSB9IGZ1bmN0aW9uIGVuKGUpIHsgaWYgKCEoIm9iamVjdCIgPT0gdHlwZW9mIGUgJiYgZS5SVENQZWVyQ29ubmVjdGlvbikpIHJldHVybjsgbGV0IHQgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5jcmVhdGVBbnN3ZXI7IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmNyZWF0ZUFuc3dlciA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuc2V0UGFyYW1ldGVyc1Byb21pc2VzICYmIHRoaXMuc2V0UGFyYW1ldGVyc1Byb21pc2VzLmxlbmd0aCA/IFByb21pc2UuYWxsKHRoaXMuc2V0UGFyYW1ldGVyc1Byb21pc2VzKS50aGVuKCgpID0+IHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSkuZmluYWxseSgoKSA9PiB7IHRoaXMuc2V0UGFyYW1ldGVyc1Byb21pc2VzID0gW10gfSkgOiB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfSB9IGUoViwgInNoaW1PblRyYWNrIiwgKCkgPT4gSCksIGUoViwgInNoaW1QZWVyQ29ubmVjdGlvbiIsICgpID0+IFkpLCBlKFYsICJzaGltU2VuZGVyR2V0U3RhdHMiLCAoKSA9PiBLKSwgZShWLCAic2hpbVJlY2VpdmVyR2V0U3RhdHMiLCAoKSA9PiBYKSwgZShWLCAic2hpbVJlbW92ZVN0cmVhbSIsICgpID0+IHEpLCBlKFYsICJzaGltUlRDRGF0YUNoYW5uZWwiLCAoKSA9PiBRKSwgZShWLCAic2hpbUFkZFRyYW5zY2VpdmVyIiwgKCkgPT4gWiksIGUoViwgInNoaW1HZXRQYXJhbWV0ZXJzIiwgKCkgPT4gZWUpLCBlKFYsICJzaGltQ3JlYXRlT2ZmZXIiLCAoKSA9PiBldCksIGUoViwgInNoaW1DcmVhdGVBbnN3ZXIiLCAoKSA9PiBlbiksIGUoViwgInNoaW1HZXRVc2VyTWVkaWEiLCAoKSA9PiBHKSwgZShWLCAic2hpbUdldERpc3BsYXlNZWRpYSIsICgpID0+IFcpOyB2YXIgZXIgPSB7fTsgZnVuY3Rpb24gZWkoZSkgeyBpZiAoIm9iamVjdCIgPT0gdHlwZW9mIGUgJiYgZS5SVENQZWVyQ29ubmVjdGlvbikgeyBpZiAoImdldExvY2FsU3RyZWFtcyIgaW4gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUgfHwgKGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldExvY2FsU3RyZWFtcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2xvY2FsU3RyZWFtcyB8fCAodGhpcy5fbG9jYWxTdHJlYW1zID0gW10pLCB0aGlzLl9sb2NhbFN0cmVhbXMgfSksICEoImFkZFN0cmVhbSIgaW4gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUpKSB7IGxldCB0ID0gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2s7IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZFN0cmVhbSA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX2xvY2FsU3RyZWFtcyB8fCAodGhpcy5fbG9jYWxTdHJlYW1zID0gW10pLCB0aGlzLl9sb2NhbFN0cmVhbXMuaW5jbHVkZXMoZSkgfHwgdGhpcy5fbG9jYWxTdHJlYW1zLnB1c2goZSksIGUuZ2V0QXVkaW9UcmFja3MoKS5mb3JFYWNoKG4gPT4gdC5jYWxsKHRoaXMsIG4sIGUpKSwgZS5nZXRWaWRlb1RyYWNrcygpLmZvckVhY2gobiA9PiB0LmNhbGwodGhpcywgbiwgZSkpIH0sIGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZFRyYWNrID0gZnVuY3Rpb24gKGUsIC4uLm4pIHsgcmV0dXJuIG4gJiYgbi5mb3JFYWNoKGUgPT4geyB0aGlzLl9sb2NhbFN0cmVhbXMgPyB0aGlzLl9sb2NhbFN0cmVhbXMuaW5jbHVkZXMoZSkgfHwgdGhpcy5fbG9jYWxTdHJlYW1zLnB1c2goZSkgOiB0aGlzLl9sb2NhbFN0cmVhbXMgPSBbZV0gfSksIHQuYXBwbHkodGhpcywgYXJndW1lbnRzKSB9IH0gInJlbW92ZVN0cmVhbSIgaW4gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUgfHwgKGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnJlbW92ZVN0cmVhbSA9IGZ1bmN0aW9uIChlKSB7IHRoaXMuX2xvY2FsU3RyZWFtcyB8fCAodGhpcy5fbG9jYWxTdHJlYW1zID0gW10pOyBsZXQgdCA9IHRoaXMuX2xvY2FsU3RyZWFtcy5pbmRleE9mKGUpOyBpZiAoLTEgPT09IHQpIHJldHVybjsgdGhpcy5fbG9jYWxTdHJlYW1zLnNwbGljZSh0LCAxKTsgbGV0IG4gPSBlLmdldFRyYWNrcygpOyB0aGlzLmdldFNlbmRlcnMoKS5mb3JFYWNoKGUgPT4geyBuLmluY2x1ZGVzKGUudHJhY2spICYmIHRoaXMucmVtb3ZlVHJhY2soZSkgfSkgfSkgfSB9IGZ1bmN0aW9uIGVvKGUpIHsgaWYgKCJvYmplY3QiID09IHR5cGVvZiBlICYmIGUuUlRDUGVlckNvbm5lY3Rpb24gJiYgKCJnZXRSZW1vdGVTdHJlYW1zIiBpbiBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSB8fCAoZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0UmVtb3RlU3RyZWFtcyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX3JlbW90ZVN0cmVhbXMgPyB0aGlzLl9yZW1vdGVTdHJlYW1zIDogW10gfSksICEoIm9uYWRkc3RyZWFtIiBpbiBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSkpKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSwgIm9uYWRkc3RyZWFtIiwgeyBnZXQoKSB7IHJldHVybiB0aGlzLl9vbmFkZHN0cmVhbSB9LCBzZXQoZSkgeyB0aGlzLl9vbmFkZHN0cmVhbSAmJiAodGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKCJhZGRzdHJlYW0iLCB0aGlzLl9vbmFkZHN0cmVhbSksIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigidHJhY2siLCB0aGlzLl9vbmFkZHN0cmVhbXBvbHkpKSwgdGhpcy5hZGRFdmVudExpc3RlbmVyKCJhZGRzdHJlYW0iLCB0aGlzLl9vbmFkZHN0cmVhbSA9IGUpLCB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoInRyYWNrIiwgdGhpcy5fb25hZGRzdHJlYW1wb2x5ID0gZSA9PiB7IGUuc3RyZWFtcy5mb3JFYWNoKGUgPT4geyBpZiAodGhpcy5fcmVtb3RlU3RyZWFtcyB8fCAodGhpcy5fcmVtb3RlU3RyZWFtcyA9IFtdKSwgdGhpcy5fcmVtb3RlU3RyZWFtcy5pbmNsdWRlcyhlKSkgcmV0dXJuOyB0aGlzLl9yZW1vdGVTdHJlYW1zLnB1c2goZSk7IGxldCB0ID0gbmV3IEV2ZW50KCJhZGRzdHJlYW0iKTsgdC5zdHJlYW0gPSBlLCB0aGlzLmRpc3BhdGNoRXZlbnQodCkgfSkgfSkgfSB9KTsgbGV0IHQgPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5zZXRSZW1vdGVEZXNjcmlwdGlvbjsgZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuc2V0UmVtb3RlRGVzY3JpcHRpb24gPSBmdW5jdGlvbiAoKSB7IGxldCBlID0gdGhpczsgcmV0dXJuIHRoaXMuX29uYWRkc3RyZWFtcG9seSB8fCB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoInRyYWNrIiwgdGhpcy5fb25hZGRzdHJlYW1wb2x5ID0gZnVuY3Rpb24gKHQpIHsgdC5zdHJlYW1zLmZvckVhY2godCA9PiB7IGlmIChlLl9yZW1vdGVTdHJlYW1zIHx8IChlLl9yZW1vdGVTdHJlYW1zID0gW10pLCBlLl9yZW1vdGVTdHJlYW1zLmluZGV4T2YodCkgPj0gMCkgcmV0dXJuOyBlLl9yZW1vdGVTdHJlYW1zLnB1c2godCk7IGxldCBuID0gbmV3IEV2ZW50KCJhZGRzdHJlYW0iKTsgbi5zdHJlYW0gPSB0LCBlLmRpc3BhdGNoRXZlbnQobikgfSkgfSksIHQuYXBwbHkoZSwgYXJndW1lbnRzKSB9IH0gfSBmdW5jdGlvbiBlcyhlKSB7IGlmICgib2JqZWN0IiAhPSB0eXBlb2YgZSB8fCAhZS5SVENQZWVyQ29ubmVjdGlvbikgcmV0dXJuOyBsZXQgdCA9IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLCBuID0gdC5jcmVhdGVPZmZlciwgciA9IHQuY3JlYXRlQW5zd2VyLCBpID0gdC5zZXRMb2NhbERlc2NyaXB0aW9uLCBvID0gdC5zZXRSZW1vdGVEZXNjcmlwdGlvbiwgcyA9IHQuYWRkSWNlQ2FuZGlkYXRlOyB0LmNyZWF0ZU9mZmVyID0gZnVuY3Rpb24gKGUsIHQpIHsgbGV0IHIgPSBhcmd1bWVudHMubGVuZ3RoID49IDIgPyBhcmd1bWVudHNbMl0gOiBhcmd1bWVudHNbMF0sIGkgPSBuLmFwcGx5KHRoaXMsIFtyXSk7IHJldHVybiB0ID8gKGkudGhlbihlLCB0KSwgUHJvbWlzZS5yZXNvbHZlKCkpIDogaSB9LCB0LmNyZWF0ZUFuc3dlciA9IGZ1bmN0aW9uIChlLCB0KSB7IGxldCBuID0gYXJndW1lbnRzLmxlbmd0aCA+PSAyID8gYXJndW1lbnRzWzJdIDogYXJndW1lbnRzWzBdLCBpID0gci5hcHBseSh0aGlzLCBbbl0pOyByZXR1cm4gdCA/IChpLnRoZW4oZSwgdCksIFByb21pc2UucmVzb2x2ZSgpKSA6IGkgfTsgbGV0IGEgPSBmdW5jdGlvbiAoZSwgdCwgbikgeyBsZXQgciA9IGkuYXBwbHkodGhpcywgW2VdKTsgcmV0dXJuIG4gPyAoci50aGVuKHQsIG4pLCBQcm9taXNlLnJlc29sdmUoKSkgOiByIH07IHQuc2V0TG9jYWxEZXNjcmlwdGlvbiA9IGEsIGEgPSBmdW5jdGlvbiAoZSwgdCwgbikgeyBsZXQgciA9IG8uYXBwbHkodGhpcywgW2VdKTsgcmV0dXJuIG4gPyAoci50aGVuKHQsIG4pLCBQcm9taXNlLnJlc29sdmUoKSkgOiByIH0sIHQuc2V0UmVtb3RlRGVzY3JpcHRpb24gPSBhLCBhID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsgbGV0IHIgPSBzLmFwcGx5KHRoaXMsIFtlXSk7IHJldHVybiBuID8gKHIudGhlbih0LCBuKSwgUHJvbWlzZS5yZXNvbHZlKCkpIDogciB9LCB0LmFkZEljZUNhbmRpZGF0ZSA9IGEgfSBmdW5jdGlvbiBlYShlKSB7IGxldCB0ID0gZSAmJiBlLm5hdmlnYXRvcjsgaWYgKHQubWVkaWFEZXZpY2VzICYmIHQubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSkgeyBsZXQgZSA9IHQubWVkaWFEZXZpY2VzLCBuID0gZS5nZXRVc2VyTWVkaWEuYmluZChlKTsgdC5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhID0gZSA9PiBuKGVjKGUpKSB9ICF0LmdldFVzZXJNZWRpYSAmJiB0Lm1lZGlhRGV2aWNlcyAmJiB0Lm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEgJiYgKHQuZ2V0VXNlck1lZGlhID0gKGZ1bmN0aW9uIChlLCBuLCByKSB7IHQubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShlKS50aGVuKG4sIHIpIH0pLmJpbmQodCkpIH0gZnVuY3Rpb24gZWMoZSkgeyByZXR1cm4gZSAmJiB2b2lkIDAgIT09IGUudmlkZW8gPyBPYmplY3QuYXNzaWduKHt9LCBlLCB7IHZpZGVvOiBmdW5jdGlvbiBlKHQpIHsgcmV0dXJuIGcodCkgPyBPYmplY3Qua2V5cyh0KS5yZWR1Y2UoZnVuY3Rpb24gKG4sIHIpIHsgbGV0IGkgPSBnKHRbcl0pLCBvID0gaSA/IGUodFtyXSkgOiB0W3JdLCBzID0gaSAmJiAhT2JqZWN0LmtleXMobykubGVuZ3RoOyByZXR1cm4gdm9pZCAwID09PSBvIHx8IHMgPyBuIDogT2JqZWN0LmFzc2lnbihuLCB7IFtyXTogbyB9KSB9LCB7fSkgOiB0IH0oZS52aWRlbykgfSkgOiBlIH0gZnVuY3Rpb24gZWwoZSkgeyBpZiAoIWUuUlRDUGVlckNvbm5lY3Rpb24pIHJldHVybjsgbGV0IHQgPSBlLlJUQ1BlZXJDb25uZWN0aW9uOyBlLlJUQ1BlZXJDb25uZWN0aW9uID0gZnVuY3Rpb24gKGUsIG4pIHsgaWYgKGUgJiYgZS5pY2VTZXJ2ZXJzKSB7IGxldCB0ID0gW107IGZvciAobGV0IG4gPSAwOyBuIDwgZS5pY2VTZXJ2ZXJzLmxlbmd0aDsgbisrKSB7IGxldCByID0gZS5pY2VTZXJ2ZXJzW25dOyB2b2lkIDAgPT09IHIudXJscyAmJiByLnVybCA/IChtKCJSVENJY2VTZXJ2ZXIudXJsIiwgIlJUQ0ljZVNlcnZlci51cmxzIiksIChyID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyKSkpLnVybHMgPSByLnVybCwgZGVsZXRlIHIudXJsLCB0LnB1c2gocikpIDogdC5wdXNoKGUuaWNlU2VydmVyc1tuXSkgfSBlLmljZVNlcnZlcnMgPSB0IH0gcmV0dXJuIG5ldyB0KGUsIG4pIH0sIGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlID0gdC5wcm90b3R5cGUsICJnZW5lcmF0ZUNlcnRpZmljYXRlIiBpbiB0ICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLlJUQ1BlZXJDb25uZWN0aW9uLCAiZ2VuZXJhdGVDZXJ0aWZpY2F0ZSIsIHsgZ2V0OiAoKSA9PiB0LmdlbmVyYXRlQ2VydGlmaWNhdGUgfSkgfSBmdW5jdGlvbiBlcChlKSB7ICJvYmplY3QiID09IHR5cGVvZiBlICYmIGUuUlRDVHJhY2tFdmVudCAmJiAicmVjZWl2ZXIiIGluIGUuUlRDVHJhY2tFdmVudC5wcm90b3R5cGUgJiYgISgidHJhbnNjZWl2ZXIiIGluIGUuUlRDVHJhY2tFdmVudC5wcm90b3R5cGUpICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLlJUQ1RyYWNrRXZlbnQucHJvdG90eXBlLCAidHJhbnNjZWl2ZXIiLCB7IGdldCgpIHsgcmV0dXJuIHsgcmVjZWl2ZXI6IHRoaXMucmVjZWl2ZXIgfSB9IH0pIH0gZnVuY3Rpb24gZWQoZSkgeyBsZXQgdCA9IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmNyZWF0ZU9mZmVyOyBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5jcmVhdGVPZmZlciA9IGZ1bmN0aW9uIChlKSB7IGlmIChlKSB7IHZvaWQgMCAhPT0gZS5vZmZlclRvUmVjZWl2ZUF1ZGlvICYmIChlLm9mZmVyVG9SZWNlaXZlQXVkaW8gPSAhIWUub2ZmZXJUb1JlY2VpdmVBdWRpbyk7IGxldCB0ID0gdGhpcy5nZXRUcmFuc2NlaXZlcnMoKS5maW5kKGUgPT4gImF1ZGlvIiA9PT0gZS5yZWNlaXZlci50cmFjay5raW5kKTsgITEgPT09IGUub2ZmZXJUb1JlY2VpdmVBdWRpbyAmJiB0ID8gInNlbmRyZWN2IiA9PT0gdC5kaXJlY3Rpb24gPyB0LnNldERpcmVjdGlvbiA/IHQuc2V0RGlyZWN0aW9uKCJzZW5kb25seSIpIDogdC5kaXJlY3Rpb24gPSAic2VuZG9ubHkiIDogInJlY3Zvbmx5IiA9PT0gdC5kaXJlY3Rpb24gJiYgKHQuc2V0RGlyZWN0aW9uID8gdC5zZXREaXJlY3Rpb24oImluYWN0aXZlIikgOiB0LmRpcmVjdGlvbiA9ICJpbmFjdGl2ZSIpIDogITAgIT09IGUub2ZmZXJUb1JlY2VpdmVBdWRpbyB8fCB0IHx8IHRoaXMuYWRkVHJhbnNjZWl2ZXIoImF1ZGlvIiwgeyBkaXJlY3Rpb246ICJyZWN2b25seSIgfSksIHZvaWQgMCAhPT0gZS5vZmZlclRvUmVjZWl2ZVZpZGVvICYmIChlLm9mZmVyVG9SZWNlaXZlVmlkZW8gPSAhIWUub2ZmZXJUb1JlY2VpdmVWaWRlbyk7IGxldCBuID0gdGhpcy5nZXRUcmFuc2NlaXZlcnMoKS5maW5kKGUgPT4gInZpZGVvIiA9PT0gZS5yZWNlaXZlci50cmFjay5raW5kKTsgITEgPT09IGUub2ZmZXJUb1JlY2VpdmVWaWRlbyAmJiBuID8gInNlbmRyZWN2IiA9PT0gbi5kaXJlY3Rpb24gPyBuLnNldERpcmVjdGlvbiA/IG4uc2V0RGlyZWN0aW9uKCJzZW5kb25seSIpIDogbi5kaXJlY3Rpb24gPSAic2VuZG9ubHkiIDogInJlY3Zvbmx5IiA9PT0gbi5kaXJlY3Rpb24gJiYgKG4uc2V0RGlyZWN0aW9uID8gbi5zZXREaXJlY3Rpb24oImluYWN0aXZlIikgOiBuLmRpcmVjdGlvbiA9ICJpbmFjdGl2ZSIpIDogITAgIT09IGUub2ZmZXJUb1JlY2VpdmVWaWRlbyB8fCBuIHx8IHRoaXMuYWRkVHJhbnNjZWl2ZXIoInZpZGVvIiwgeyBkaXJlY3Rpb246ICJyZWN2b25seSIgfSkgfSByZXR1cm4gdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH0gfSBmdW5jdGlvbiBlaChlKSB7ICJvYmplY3QiICE9IHR5cGVvZiBlIHx8IGUuQXVkaW9Db250ZXh0IHx8IChlLkF1ZGlvQ29udGV4dCA9IGUud2Via2l0QXVkaW9Db250ZXh0KSB9IGUoZXIsICJzaGltTG9jYWxTdHJlYW1zQVBJIiwgKCkgPT4gZWkpLCBlKGVyLCAic2hpbVJlbW90ZVN0cmVhbXNBUEkiLCAoKSA9PiBlbyksIGUoZXIsICJzaGltQ2FsbGJhY2tzQVBJIiwgKCkgPT4gZXMpLCBlKGVyLCAic2hpbUdldFVzZXJNZWRpYSIsICgpID0+IGVhKSwgZShlciwgInNoaW1Db25zdHJhaW50cyIsICgpID0+IGVjKSwgZShlciwgInNoaW1SVENJY2VTZXJ2ZXJVcmxzIiwgKCkgPT4gZWwpLCBlKGVyLCAic2hpbVRyYWNrRXZlbnRUcmFuc2NlaXZlciIsICgpID0+IGVwKSwgZShlciwgInNoaW1DcmVhdGVPZmZlckxlZ2FjeSIsICgpID0+IGVkKSwgZShlciwgInNoaW1BdWRpb0NvbnRleHQiLCAoKSA9PiBlaCk7IHZhciBldSA9IHt9OyBlKGV1LCAic2hpbVJUQ0ljZUNhbmRpZGF0ZSIsICgpID0+IGVnKSwgZShldSwgInNoaW1SVENJY2VDYW5kaWRhdGVSZWxheVByb3RvY29sIiwgKCkgPT4gZXkpLCBlKGV1LCAic2hpbU1heE1lc3NhZ2VTaXplIiwgKCkgPT4gZV8pLCBlKGV1LCAic2hpbVNlbmRUaHJvd1R5cGVFcnJvciIsICgpID0+IGVDKSwgZShldSwgInNoaW1Db25uZWN0aW9uU3RhdGUiLCAoKSA9PiBlYiksIGUoZXUsICJyZW1vdmVFeHRtYXBBbGxvd01peGVkIiwgKCkgPT4gZXYpLCBlKGV1LCAic2hpbUFkZEljZUNhbmRpZGF0ZU51bGxPckVtcHR5IiwgKCkgPT4gZWspLCBlKGV1LCAic2hpbVBhcmFtZXRlcmxlc3NTZXRMb2NhbERlc2NyaXB0aW9uIiwgKCkgPT4gZVQpOyB2YXIgZWYgPSB7fTsgbGV0IGVtID0ge307IGZ1bmN0aW9uIGVnKGUpIHsgaWYgKCFlLlJUQ0ljZUNhbmRpZGF0ZSB8fCBlLlJUQ0ljZUNhbmRpZGF0ZSAmJiAiZm91bmRhdGlvbiIgaW4gZS5SVENJY2VDYW5kaWRhdGUucHJvdG90eXBlKSByZXR1cm47IGxldCBuID0gZS5SVENJY2VDYW5kaWRhdGU7IGUuUlRDSWNlQ2FuZGlkYXRlID0gZnVuY3Rpb24gKGUpIHsgaWYgKCJvYmplY3QiID09IHR5cGVvZiBlICYmIGUuY2FuZGlkYXRlICYmIDAgPT09IGUuY2FuZGlkYXRlLmluZGV4T2YoImE9IikgJiYgKChlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShlKSkpLmNhbmRpZGF0ZSA9IGUuY2FuZGlkYXRlLnN1YnN0cmluZygyKSksIGUuY2FuZGlkYXRlICYmIGUuY2FuZGlkYXRlLmxlbmd0aCkgeyBsZXQgciA9IG5ldyBuKGUpLCBpID0gdChlZikucGFyc2VDYW5kaWRhdGUoZS5jYW5kaWRhdGUpOyBmb3IgKGxldCBlIGluIGkpIGUgaW4gciB8fCBPYmplY3QuZGVmaW5lUHJvcGVydHkociwgZSwgeyB2YWx1ZTogaVtlXSB9KTsgcmV0dXJuIHIudG9KU09OID0gZnVuY3Rpb24gKCkgeyByZXR1cm4geyBjYW5kaWRhdGU6IHIuY2FuZGlkYXRlLCBzZHBNaWQ6IHIuc2RwTWlkLCBzZHBNTGluZUluZGV4OiByLnNkcE1MaW5lSW5kZXgsIHVzZXJuYW1lRnJhZ21lbnQ6IHIudXNlcm5hbWVGcmFnbWVudCB9IH0sIHIgfSByZXR1cm4gbmV3IG4oZSkgfSwgZS5SVENJY2VDYW5kaWRhdGUucHJvdG90eXBlID0gbi5wcm90b3R5cGUsIGQoZSwgImljZWNhbmRpZGF0ZSIsIHQgPT4gKHQuY2FuZGlkYXRlICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCAiY2FuZGlkYXRlIiwgeyB2YWx1ZTogbmV3IGUuUlRDSWNlQ2FuZGlkYXRlKHQuY2FuZGlkYXRlKSwgd3JpdGFibGU6ICJmYWxzZSIgfSksIHQpKSB9IGZ1bmN0aW9uIGV5KGUpIHsgIWUuUlRDSWNlQ2FuZGlkYXRlIHx8IGUuUlRDSWNlQ2FuZGlkYXRlICYmICJyZWxheVByb3RvY29sIiBpbiBlLlJUQ0ljZUNhbmRpZGF0ZS5wcm90b3R5cGUgfHwgZChlLCAiaWNlY2FuZGlkYXRlIiwgZSA9PiB7IGlmIChlLmNhbmRpZGF0ZSkgeyBsZXQgbiA9IHQoZWYpLnBhcnNlQ2FuZGlkYXRlKGUuY2FuZGlkYXRlLmNhbmRpZGF0ZSk7ICJyZWxheSIgPT09IG4udHlwZSAmJiAoZS5jYW5kaWRhdGUucmVsYXlQcm90b2NvbCA9ICh7IDA6ICJ0bHMiLCAxOiAidGNwIiwgMjogInVkcCIgfSlbbi5wcmlvcml0eSA+PiAyNF0pIH0gcmV0dXJuIGUgfSkgfSBmdW5jdGlvbiBlXyhlLCBuKSB7IGlmICghZS5SVENQZWVyQ29ubmVjdGlvbikgcmV0dXJuOyAic2N0cCIgaW4gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUgfHwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLCAic2N0cCIsIHsgZ2V0KCkgeyByZXR1cm4gdm9pZCAwID09PSB0aGlzLl9zY3RwID8gbnVsbCA6IHRoaXMuX3NjdHAgfSB9KTsgbGV0IHIgPSBmdW5jdGlvbiAoZSkgeyBpZiAoIWUgfHwgIWUuc2RwKSByZXR1cm4gITE7IGxldCBuID0gdChlZikuc3BsaXRTZWN0aW9ucyhlLnNkcCk7IHJldHVybiBuLnNoaWZ0KCksIG4uc29tZShlID0+IHsgbGV0IG4gPSB0KGVmKS5wYXJzZU1MaW5lKGUpOyByZXR1cm4gbiAmJiAiYXBwbGljYXRpb24iID09PSBuLmtpbmQgJiYgLTEgIT09IG4ucHJvdG9jb2wuaW5kZXhPZigiU0NUUCIpIH0pIH0sIGkgPSBmdW5jdGlvbiAoZSkgeyBsZXQgdCA9IGUuc2RwLm1hdGNoKC9tb3ppbGxhLi4uVEhJU19JU19TRFBBUlRBLShcZCspLyk7IGlmIChudWxsID09PSB0IHx8IHQubGVuZ3RoIDwgMikgcmV0dXJuIC0xOyBsZXQgbiA9IHBhcnNlSW50KHRbMV0sIDEwKTsgcmV0dXJuIG4gIT0gbiA/IC0xIDogbiB9LCBvID0gZnVuY3Rpb24gKGUpIHsgbGV0IHQgPSA2NTUzNjsgcmV0dXJuICJmaXJlZm94IiA9PT0gbi5icm93c2VyICYmICh0ID0gbi52ZXJzaW9uIDwgNTcgPyAtMSA9PT0gZSA/IDE2Mzg0IDogMjE0NzQ4MzYzNyA6IG4udmVyc2lvbiA8IDYwID8gNTcgPT09IG4udmVyc2lvbiA/IDY1NTM1IDogNjU1MzYgOiAyMTQ3NDgzNjM3KSwgdCB9LCBzID0gZnVuY3Rpb24gKGUsIHIpIHsgbGV0IGkgPSA2NTUzNjsgImZpcmVmb3giID09PSBuLmJyb3dzZXIgJiYgNTcgPT09IG4udmVyc2lvbiAmJiAoaSA9IDY1NTM1KTsgbGV0IG8gPSB0KGVmKS5tYXRjaFByZWZpeChlLnNkcCwgImE9bWF4LW1lc3NhZ2Utc2l6ZToiKTsgcmV0dXJuIG8ubGVuZ3RoID4gMCA/IGkgPSBwYXJzZUludChvWzBdLnN1YnN0cmluZygxOSksIDEwKSA6ICJmaXJlZm94IiA9PT0gbi5icm93c2VyICYmIC0xICE9PSByICYmIChpID0gMjE0NzQ4MzYzNyksIGkgfSwgYSA9IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnNldFJlbW90ZURlc2NyaXB0aW9uOyBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5zZXRSZW1vdGVEZXNjcmlwdGlvbiA9IGZ1bmN0aW9uICgpIHsgaWYgKHRoaXMuX3NjdHAgPSBudWxsLCAiY2hyb21lIiA9PT0gbi5icm93c2VyICYmIG4udmVyc2lvbiA+PSA3NikgeyBsZXQgeyBzZHBTZW1hbnRpY3M6IGUgfSA9IHRoaXMuZ2V0Q29uZmlndXJhdGlvbigpOyAicGxhbi1iIiA9PT0gZSAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgInNjdHAiLCB7IGdldCgpIHsgcmV0dXJuIHZvaWQgMCA9PT0gdGhpcy5fc2N0cCA/IG51bGwgOiB0aGlzLl9zY3RwIH0sIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwIH0pIH0gaWYgKHIoYXJndW1lbnRzWzBdKSkgeyBsZXQgZTsgbGV0IHQgPSBpKGFyZ3VtZW50c1swXSksIG4gPSBvKHQpLCByID0gcyhhcmd1bWVudHNbMF0sIHQpOyBlID0gMCA9PT0gbiAmJiAwID09PSByID8gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIDogMCA9PT0gbiB8fCAwID09PSByID8gTWF0aC5tYXgobiwgcikgOiBNYXRoLm1pbihuLCByKTsgbGV0IGEgPSB7fTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGEsICJtYXhNZXNzYWdlU2l6ZSIsIHsgZ2V0OiAoKSA9PiBlIH0pLCB0aGlzLl9zY3RwID0gYSB9IHJldHVybiBhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfSB9IGZ1bmN0aW9uIGVDKGUpIHsgaWYgKCEoZS5SVENQZWVyQ29ubmVjdGlvbiAmJiAiY3JlYXRlRGF0YUNoYW5uZWwiIGluIGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlKSkgcmV0dXJuOyBmdW5jdGlvbiB0KGUsIHQpIHsgbGV0IG4gPSBlLnNlbmQ7IGUuc2VuZCA9IGZ1bmN0aW9uICgpIHsgbGV0IHIgPSBhcmd1bWVudHNbMF0sIGkgPSByLmxlbmd0aCB8fCByLnNpemUgfHwgci5ieXRlTGVuZ3RoOyBpZiAoIm9wZW4iID09PSBlLnJlYWR5U3RhdGUgJiYgdC5zY3RwICYmIGkgPiB0LnNjdHAubWF4TWVzc2FnZVNpemUpIHRocm93IFR5cGVFcnJvcigiTWVzc2FnZSB0b28gbGFyZ2UgKGNhbiBzZW5kIGEgbWF4aW11bSBvZiAiICsgdC5zY3RwLm1heE1lc3NhZ2VTaXplICsgIiBieXRlcykiKTsgcmV0dXJuIG4uYXBwbHkoZSwgYXJndW1lbnRzKSB9IH0gbGV0IG4gPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5jcmVhdGVEYXRhQ2hhbm5lbDsgZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuY3JlYXRlRGF0YUNoYW5uZWwgPSBmdW5jdGlvbiAoKSB7IGxldCBlID0gbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyByZXR1cm4gdChlLCB0aGlzKSwgZSB9LCBkKGUsICJkYXRhY2hhbm5lbCIsIGUgPT4gKHQoZS5jaGFubmVsLCBlLnRhcmdldCksIGUpKSB9IGZ1bmN0aW9uIGViKGUpIHsgaWYgKCFlLlJUQ1BlZXJDb25uZWN0aW9uIHx8ICJjb25uZWN0aW9uU3RhdGUiIGluIGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlKSByZXR1cm47IGxldCB0ID0gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCAiY29ubmVjdGlvblN0YXRlIiwgeyBnZXQoKSB7IHJldHVybiAoeyBjb21wbGV0ZWQ6ICJjb25uZWN0ZWQiLCBjaGVja2luZzogImNvbm5lY3RpbmciIH0pW3RoaXMuaWNlQ29ubmVjdGlvblN0YXRlXSB8fCB0aGlzLmljZUNvbm5lY3Rpb25TdGF0ZSB9LCBlbnVtZXJhYmxlOiAhMCwgY29uZmlndXJhYmxlOiAhMCB9KSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsICJvbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZSIsIHsgZ2V0KCkgeyByZXR1cm4gdGhpcy5fb25jb25uZWN0aW9uc3RhdGVjaGFuZ2UgfHwgbnVsbCB9LCBzZXQoZSkgeyB0aGlzLl9vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZSAmJiAodGhpcy5yZW1vdmVFdmVudExpc3RlbmVyKCJjb25uZWN0aW9uc3RhdGVjaGFuZ2UiLCB0aGlzLl9vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZSksIGRlbGV0ZSB0aGlzLl9vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZSksIGUgJiYgdGhpcy5hZGRFdmVudExpc3RlbmVyKCJjb25uZWN0aW9uc3RhdGVjaGFuZ2UiLCB0aGlzLl9vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZSA9IGUpIH0sIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwIH0pLCBbInNldExvY2FsRGVzY3JpcHRpb24iLCAic2V0UmVtb3RlRGVzY3JpcHRpb24iXS5mb3JFYWNoKGUgPT4geyBsZXQgbiA9IHRbZV07IHRbZV0gPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jb25uZWN0aW9uc3RhdGVjaGFuZ2Vwb2x5IHx8ICh0aGlzLl9jb25uZWN0aW9uc3RhdGVjaGFuZ2Vwb2x5ID0gZSA9PiB7IGxldCB0ID0gZS50YXJnZXQ7IGlmICh0Ll9sYXN0Q29ubmVjdGlvblN0YXRlICE9PSB0LmNvbm5lY3Rpb25TdGF0ZSkgeyB0Ll9sYXN0Q29ubmVjdGlvblN0YXRlID0gdC5jb25uZWN0aW9uU3RhdGU7IGxldCBuID0gbmV3IEV2ZW50KCJjb25uZWN0aW9uc3RhdGVjaGFuZ2UiLCBlKTsgdC5kaXNwYXRjaEV2ZW50KG4pIH0gcmV0dXJuIGUgfSwgdGhpcy5hZGRFdmVudExpc3RlbmVyKCJpY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2UiLCB0aGlzLl9jb25uZWN0aW9uc3RhdGVjaGFuZ2Vwb2x5KSksIG4uYXBwbHkodGhpcywgYXJndW1lbnRzKSB9IH0pIH0gZnVuY3Rpb24gZXYoZSwgdCkgeyBpZiAoIWUuUlRDUGVlckNvbm5lY3Rpb24gfHwgImNocm9tZSIgPT09IHQuYnJvd3NlciAmJiB0LnZlcnNpb24gPj0gNzEgfHwgInNhZmFyaSIgPT09IHQuYnJvd3NlciAmJiB0LnZlcnNpb24gPj0gNjA1KSByZXR1cm47IGxldCBuID0gZS5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuc2V0UmVtb3RlRGVzY3JpcHRpb247IGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnNldFJlbW90ZURlc2NyaXB0aW9uID0gZnVuY3Rpb24gKHQpIHsgaWYgKHQgJiYgdC5zZHAgJiYgLTEgIT09IHQuc2RwLmluZGV4T2YoIlxuYT1leHRtYXAtYWxsb3ctbWl4ZWQiKSkgeyBsZXQgbiA9IHQuc2RwLnNwbGl0KCJcbiIpLmZpbHRlcihlID0+ICJhPWV4dG1hcC1hbGxvdy1taXhlZCIgIT09IGUudHJpbSgpKS5qb2luKCJcbiIpOyBlLlJUQ1Nlc3Npb25EZXNjcmlwdGlvbiAmJiB0IGluc3RhbmNlb2YgZS5SVENTZXNzaW9uRGVzY3JpcHRpb24gPyBhcmd1bWVudHNbMF0gPSBuZXcgZS5SVENTZXNzaW9uRGVzY3JpcHRpb24oeyB0eXBlOiB0LnR5cGUsIHNkcDogbiB9KSA6IHQuc2RwID0gbiB9IHJldHVybiBuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfSB9IGZ1bmN0aW9uIGVrKGUsIHQpIHsgaWYgKCEoZS5SVENQZWVyQ29ubmVjdGlvbiAmJiBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSkpIHJldHVybjsgbGV0IG4gPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5hZGRJY2VDYW5kaWRhdGU7IG4gJiYgMCAhPT0gbi5sZW5ndGggJiYgKGUuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZEljZUNhbmRpZGF0ZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGFyZ3VtZW50c1swXSA/ICgiY2hyb21lIiA9PT0gdC5icm93c2VyICYmIHQudmVyc2lvbiA8IDc4IHx8ICJmaXJlZm94IiA9PT0gdC5icm93c2VyICYmIHQudmVyc2lvbiA8IDY4IHx8ICJzYWZhcmkiID09PSB0LmJyb3dzZXIpICYmIGFyZ3VtZW50c1swXSAmJiAiIiA9PT0gYXJndW1lbnRzWzBdLmNhbmRpZGF0ZSA/IFByb21pc2UucmVzb2x2ZSgpIDogbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpIDogKGFyZ3VtZW50c1sxXSAmJiBhcmd1bWVudHNbMV0uYXBwbHkobnVsbCksIFByb21pc2UucmVzb2x2ZSgpKSB9KSB9IGZ1bmN0aW9uIGVUKGUsIHQpIHsgaWYgKCEoZS5SVENQZWVyQ29ubmVjdGlvbiAmJiBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSkpIHJldHVybjsgbGV0IG4gPSBlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5zZXRMb2NhbERlc2NyaXB0aW9uOyBuICYmIDAgIT09IG4ubGVuZ3RoICYmIChlLlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5zZXRMb2NhbERlc2NyaXB0aW9uID0gZnVuY3Rpb24gKCkgeyBsZXQgZSA9IGFyZ3VtZW50c1swXSB8fCB7fTsgaWYgKCJvYmplY3QiICE9IHR5cGVvZiBlIHx8IGUudHlwZSAmJiBlLnNkcCkgcmV0dXJuIG4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsgaWYgKCEoZSA9IHsgdHlwZTogZS50eXBlLCBzZHA6IGUuc2RwIH0pLnR5cGUpIHN3aXRjaCAodGhpcy5zaWduYWxpbmdTdGF0ZSkgeyBjYXNlICJzdGFibGUiOiBjYXNlICJoYXZlLWxvY2FsLW9mZmVyIjogY2FzZSAiaGF2ZS1yZW1vdGUtcHJhbnN3ZXIiOiBlLnR5cGUgPSAib2ZmZXIiOyBicmVhazsgZGVmYXVsdDogZS50eXBlID0gImFuc3dlciIgfXJldHVybiBlLnNkcCB8fCAib2ZmZXIiICE9PSBlLnR5cGUgJiYgImFuc3dlciIgIT09IGUudHlwZSA/IG4uYXBwbHkodGhpcywgW2VdKSA6ICgib2ZmZXIiID09PSBlLnR5cGUgPyB0aGlzLmNyZWF0ZU9mZmVyIDogdGhpcy5jcmVhdGVBbnN3ZXIpLmFwcGx5KHRoaXMpLnRoZW4oZSA9PiBuLmFwcGx5KHRoaXMsIFtlXSkpIH0pIH0gZW0uZ2VuZXJhdGVJZGVudGlmaWVyID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDEyKSB9LCBlbS5sb2NhbENOYW1lID0gZW0uZ2VuZXJhdGVJZGVudGlmaWVyKCksIGVtLnNwbGl0TGluZXMgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS50cmltKCkuc3BsaXQoIlxuIikubWFwKGUgPT4gZS50cmltKCkpIH0sIGVtLnNwbGl0U2VjdGlvbnMgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5zcGxpdCgiXG5tPSIpLm1hcCgoZSwgdCkgPT4gKHQgPiAwID8gIm09IiArIGUgOiBlKS50cmltKCkgKyAiXHJcbiIpIH0sIGVtLmdldERlc2NyaXB0aW9uID0gZnVuY3Rpb24gKGUpIHsgbGV0IHQgPSBlbS5zcGxpdFNlY3Rpb25zKGUpOyByZXR1cm4gdCAmJiB0WzBdIH0sIGVtLmdldE1lZGlhU2VjdGlvbnMgPSBmdW5jdGlvbiAoZSkgeyBsZXQgdCA9IGVtLnNwbGl0U2VjdGlvbnMoZSk7IHJldHVybiB0LnNoaWZ0KCksIHQgfSwgZW0ubWF0Y2hQcmVmaXggPSBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4gZW0uc3BsaXRMaW5lcyhlKS5maWx0ZXIoZSA9PiAwID09PSBlLmluZGV4T2YodCkpIH0sIGVtLnBhcnNlQ2FuZGlkYXRlID0gZnVuY3Rpb24gKGUpIHsgbGV0IHQ7IGxldCBuID0geyBmb3VuZGF0aW9uOiAodCA9IDAgPT09IGUuaW5kZXhPZigiYT1jYW5kaWRhdGU6IikgPyBlLnN1YnN0cmluZygxMikuc3BsaXQoIiAiKSA6IGUuc3Vic3RyaW5nKDEwKS5zcGxpdCgiICIpKVswXSwgY29tcG9uZW50OiB7IDE6ICJydHAiLCAyOiAicnRjcCIgfVt0WzFdXSB8fCB0WzFdLCBwcm90b2NvbDogdFsyXS50b0xvd2VyQ2FzZSgpLCBwcmlvcml0eTogcGFyc2VJbnQodFszXSwgMTApLCBpcDogdFs0XSwgYWRkcmVzczogdFs0XSwgcG9ydDogcGFyc2VJbnQodFs1XSwgMTApLCB0eXBlOiB0WzddIH07IGZvciAobGV0IGUgPSA4OyBlIDwgdC5sZW5ndGg7IGUgKz0gMilzd2l0Y2ggKHRbZV0pIHsgY2FzZSAicmFkZHIiOiBuLnJlbGF0ZWRBZGRyZXNzID0gdFtlICsgMV07IGJyZWFrOyBjYXNlICJycG9ydCI6IG4ucmVsYXRlZFBvcnQgPSBwYXJzZUludCh0W2UgKyAxXSwgMTApOyBicmVhazsgY2FzZSAidGNwdHlwZSI6IG4udGNwVHlwZSA9IHRbZSArIDFdOyBicmVhazsgY2FzZSAidWZyYWciOiBuLnVmcmFnID0gdFtlICsgMV0sIG4udXNlcm5hbWVGcmFnbWVudCA9IHRbZSArIDFdOyBicmVhazsgZGVmYXVsdDogdm9pZCAwID09PSBuW3RbZV1dICYmIChuW3RbZV1dID0gdFtlICsgMV0pIH1yZXR1cm4gbiB9LCBlbS53cml0ZUNhbmRpZGF0ZSA9IGZ1bmN0aW9uIChlKSB7IGxldCB0ID0gW107IHQucHVzaChlLmZvdW5kYXRpb24pOyBsZXQgbiA9IGUuY29tcG9uZW50OyAicnRwIiA9PT0gbiA/IHQucHVzaCgxKSA6ICJydGNwIiA9PT0gbiA/IHQucHVzaCgyKSA6IHQucHVzaChuKSwgdC5wdXNoKGUucHJvdG9jb2wudG9VcHBlckNhc2UoKSksIHQucHVzaChlLnByaW9yaXR5KSwgdC5wdXNoKGUuYWRkcmVzcyB8fCBlLmlwKSwgdC5wdXNoKGUucG9ydCk7IGxldCByID0gZS50eXBlOyByZXR1cm4gdC5wdXNoKCJ0eXAiKSwgdC5wdXNoKHIpLCAiaG9zdCIgIT09IHIgJiYgZS5yZWxhdGVkQWRkcmVzcyAmJiBlLnJlbGF0ZWRQb3J0ICYmICh0LnB1c2goInJhZGRyIiksIHQucHVzaChlLnJlbGF0ZWRBZGRyZXNzKSwgdC5wdXNoKCJycG9ydCIpLCB0LnB1c2goZS5yZWxhdGVkUG9ydCkpLCBlLnRjcFR5cGUgJiYgInRjcCIgPT09IGUucHJvdG9jb2wudG9Mb3dlckNhc2UoKSAmJiAodC5wdXNoKCJ0Y3B0eXBlIiksIHQucHVzaChlLnRjcFR5cGUpKSwgKGUudXNlcm5hbWVGcmFnbWVudCB8fCBlLnVmcmFnKSAmJiAodC5wdXNoKCJ1ZnJhZyIpLCB0LnB1c2goZS51c2VybmFtZUZyYWdtZW50IHx8IGUudWZyYWcpKSwgImNhbmRpZGF0ZToiICsgdC5qb2luKCIgIikgfSwgZW0ucGFyc2VJY2VPcHRpb25zID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUuc3Vic3RyaW5nKDE0KS5zcGxpdCgiICIpIH0sIGVtLnBhcnNlUnRwTWFwID0gZnVuY3Rpb24gKGUpIHsgbGV0IHQgPSBlLnN1YnN0cmluZyg5KS5zcGxpdCgiICIpLCBuID0geyBwYXlsb2FkVHlwZTogcGFyc2VJbnQodC5zaGlmdCgpLCAxMCkgfTsgcmV0dXJuIHQgPSB0WzBdLnNwbGl0KCIvIiksIG4ubmFtZSA9IHRbMF0sIG4uY2xvY2tSYXRlID0gcGFyc2VJbnQodFsxXSwgMTApLCBuLmNoYW5uZWxzID0gMyA9PT0gdC5sZW5ndGggPyBwYXJzZUludCh0WzJdLCAxMCkgOiAxLCBuLm51bUNoYW5uZWxzID0gbi5jaGFubmVscywgbiB9LCBlbS53cml0ZVJ0cE1hcCA9IGZ1bmN0aW9uIChlKSB7IGxldCB0ID0gZS5wYXlsb2FkVHlwZTsgdm9pZCAwICE9PSBlLnByZWZlcnJlZFBheWxvYWRUeXBlICYmICh0ID0gZS5wcmVmZXJyZWRQYXlsb2FkVHlwZSk7IGxldCBuID0gZS5jaGFubmVscyB8fCBlLm51bUNoYW5uZWxzIHx8IDE7IHJldHVybiAiYT1ydHBtYXA6IiArIHQgKyAiICIgKyBlLm5hbWUgKyAiLyIgKyBlLmNsb2NrUmF0ZSArICgxICE9PSBuID8gIi8iICsgbiA6ICIiKSArICJcclxuIiB9LCBlbS5wYXJzZUV4dG1hcCA9IGZ1bmN0aW9uIChlKSB7IGxldCB0ID0gZS5zdWJzdHJpbmcoOSkuc3BsaXQoIiAiKTsgcmV0dXJuIHsgaWQ6IHBhcnNlSW50KHRbMF0sIDEwKSwgZGlyZWN0aW9uOiB0WzBdLmluZGV4T2YoIi8iKSA+IDAgPyB0WzBdLnNwbGl0KCIvIilbMV0gOiAic2VuZHJlY3YiLCB1cmk6IHRbMV0sIGF0dHJpYnV0ZXM6IHQuc2xpY2UoMikuam9pbigiICIpIH0gfSwgZW0ud3JpdGVFeHRtYXAgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gImE9ZXh0bWFwOiIgKyAoZS5pZCB8fCBlLnByZWZlcnJlZElkKSArIChlLmRpcmVjdGlvbiAmJiAic2VuZHJlY3YiICE9PSBlLmRpcmVjdGlvbiA/ICIvIiArIGUuZGlyZWN0aW9uIDogIiIpICsgIiAiICsgZS51cmkgKyAoZS5hdHRyaWJ1dGVzID8gIiAiICsgZS5hdHRyaWJ1dGVzIDogIiIpICsgIlxyXG4iIH0sIGVtLnBhcnNlRm10cCA9IGZ1bmN0aW9uIChlKSB7IGxldCB0OyBsZXQgbiA9IHt9LCByID0gZS5zdWJzdHJpbmcoZS5pbmRleE9mKCIgIikgKyAxKS5zcGxpdCgiOyIpOyBmb3IgKGxldCBlID0gMDsgZSA8IHIubGVuZ3RoOyBlKyspblsodCA9IHJbZV0udHJpbSgpLnNwbGl0KCI9IikpWzBdLnRyaW0oKV0gPSB0WzFdOyByZXR1cm4gbiB9LCBlbS53cml0ZUZtdHAgPSBmdW5jdGlvbiAoZSkgeyBsZXQgdCA9ICIiLCBuID0gZS5wYXlsb2FkVHlwZTsgaWYgKHZvaWQgMCAhPT0gZS5wcmVmZXJyZWRQYXlsb2FkVHlwZSAmJiAobiA9IGUucHJlZmVycmVkUGF5bG9hZFR5cGUpLCBlLnBhcmFtZXRlcnMgJiYgT2JqZWN0LmtleXMoZS5wYXJhbWV0ZXJzKS5sZW5ndGgpIHsgbGV0IHIgPSBbXTsgT2JqZWN0LmtleXMoZS5wYXJhbWV0ZXJzKS5mb3JFYWNoKHQgPT4geyB2b2lkIDAgIT09IGUucGFyYW1ldGVyc1t0XSA/IHIucHVzaCh0ICsgIj0iICsgZS5wYXJhbWV0ZXJzW3RdKSA6IHIucHVzaCh0KSB9KSwgdCArPSAiYT1mbXRwOiIgKyBuICsgIiAiICsgci5qb2luKCI7IikgKyAiXHJcbiIgfSByZXR1cm4gdCB9LCBlbS5wYXJzZVJ0Y3BGYiA9IGZ1bmN0aW9uIChlKSB7IGxldCB0ID0gZS5zdWJzdHJpbmcoZS5pbmRleE9mKCIgIikgKyAxKS5zcGxpdCgiICIpOyByZXR1cm4geyB0eXBlOiB0LnNoaWZ0KCksIHBhcmFtZXRlcjogdC5qb2luKCIgIikgfSB9LCBlbS53cml0ZVJ0Y3BGYiA9IGZ1bmN0aW9uIChlKSB7IGxldCB0ID0gIiIsIG4gPSBlLnBheWxvYWRUeXBlOyByZXR1cm4gdm9pZCAwICE9PSBlLnByZWZlcnJlZFBheWxvYWRUeXBlICYmIChuID0gZS5wcmVmZXJyZWRQYXlsb2FkVHlwZSksIGUucnRjcEZlZWRiYWNrICYmIGUucnRjcEZlZWRiYWNrLmxlbmd0aCAmJiBlLnJ0Y3BGZWVkYmFjay5mb3JFYWNoKGUgPT4geyB0ICs9ICJhPXJ0Y3AtZmI6IiArIG4gKyAiICIgKyBlLnR5cGUgKyAoZS5wYXJhbWV0ZXIgJiYgZS5wYXJhbWV0ZXIubGVuZ3RoID8gIiAiICsgZS5wYXJhbWV0ZXIgOiAiIikgKyAiXHJcbiIgfSksIHQgfSwgZW0ucGFyc2VTc3JjTWVkaWEgPSBmdW5jdGlvbiAoZSkgeyBsZXQgdCA9IGUuaW5kZXhPZigiICIpLCBuID0geyBzc3JjOiBwYXJzZUludChlLnN1YnN0cmluZyg3LCB0KSwgMTApIH0sIHIgPSBlLmluZGV4T2YoIjoiLCB0KTsgcmV0dXJuIHIgPiAtMSA/IChuLmF0dHJpYnV0ZSA9IGUuc3Vic3RyaW5nKHQgKyAxLCByKSwgbi52YWx1ZSA9IGUuc3Vic3RyaW5nKHIgKyAxKSkgOiBuLmF0dHJpYnV0ZSA9IGUuc3Vic3RyaW5nKHQgKyAxKSwgbiB9LCBlbS5wYXJzZVNzcmNHcm91cCA9IGZ1bmN0aW9uIChlKSB7IGxldCB0ID0gZS5zdWJzdHJpbmcoMTMpLnNwbGl0KCIgIik7IHJldHVybiB7IHNlbWFudGljczogdC5zaGlmdCgpLCBzc3JjczogdC5tYXAoZSA9PiBwYXJzZUludChlLCAxMCkpIH0gfSwgZW0uZ2V0TWlkID0gZnVuY3Rpb24gKGUpIHsgbGV0IHQgPSBlbS5tYXRjaFByZWZpeChlLCAiYT1taWQ6IilbMF07IGlmICh0KSByZXR1cm4gdC5zdWJzdHJpbmcoNikgfSwgZW0ucGFyc2VGaW5nZXJwcmludCA9IGZ1bmN0aW9uIChlKSB7IGxldCB0ID0gZS5zdWJzdHJpbmcoMTQpLnNwbGl0KCIgIik7IHJldHVybiB7IGFsZ29yaXRobTogdFswXS50b0xvd2VyQ2FzZSgpLCB2YWx1ZTogdFsxXS50b1VwcGVyQ2FzZSgpIH0gfSwgZW0uZ2V0RHRsc1BhcmFtZXRlcnMgPSBmdW5jdGlvbiAoZSwgdCkgeyByZXR1cm4geyByb2xlOiAiYXV0byIsIGZpbmdlcnByaW50czogZW0ubWF0Y2hQcmVmaXgoZSArIHQsICJhPWZpbmdlcnByaW50OiIpLm1hcChlbS5wYXJzZUZpbmdlcnByaW50KSB9IH0sIGVtLndyaXRlRHRsc1BhcmFtZXRlcnMgPSBmdW5jdGlvbiAoZSwgdCkgeyBsZXQgbiA9ICJhPXNldHVwOiIgKyB0ICsgIlxyXG4iOyByZXR1cm4gZS5maW5nZXJwcmludHMuZm9yRWFjaChlID0+IHsgbiArPSAiYT1maW5nZXJwcmludDoiICsgZS5hbGdvcml0aG0gKyAiICIgKyBlLnZhbHVlICsgIlxyXG4iIH0pLCBuIH0sIGVtLnBhcnNlQ3J5cHRvTGluZSA9IGZ1bmN0aW9uIChlKSB7IGxldCB0ID0gZS5zdWJzdHJpbmcoOSkuc3BsaXQoIiAiKTsgcmV0dXJuIHsgdGFnOiBwYXJzZUludCh0WzBdLCAxMCksIGNyeXB0b1N1aXRlOiB0WzFdLCBrZXlQYXJhbXM6IHRbMl0sIHNlc3Npb25QYXJhbXM6IHQuc2xpY2UoMykgfSB9LCBlbS53cml0ZUNyeXB0b0xpbmUgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gImE9Y3J5cHRvOiIgKyBlLnRhZyArICIgIiArIGUuY3J5cHRvU3VpdGUgKyAiICIgKyAoIm9iamVjdCIgPT0gdHlwZW9mIGUua2V5UGFyYW1zID8gZW0ud3JpdGVDcnlwdG9LZXlQYXJhbXMoZS5rZXlQYXJhbXMpIDogZS5rZXlQYXJhbXMpICsgKGUuc2Vzc2lvblBhcmFtcyA/ICIgIiArIGUuc2Vzc2lvblBhcmFtcy5qb2luKCIgIikgOiAiIikgKyAiXHJcbiIgfSwgZW0ucGFyc2VDcnlwdG9LZXlQYXJhbXMgPSBmdW5jdGlvbiAoZSkgeyBpZiAoMCAhPT0gZS5pbmRleE9mKCJpbmxpbmU6IikpIHJldHVybiBudWxsOyBsZXQgdCA9IGUuc3Vic3RyaW5nKDcpLnNwbGl0KCJ8Iik7IHJldHVybiB7IGtleU1ldGhvZDogImlubGluZSIsIGtleVNhbHQ6IHRbMF0sIGxpZmVUaW1lOiB0WzFdLCBta2lWYWx1ZTogdFsyXSA/IHRbMl0uc3BsaXQoIjoiKVswXSA6IHZvaWQgMCwgbWtpTGVuZ3RoOiB0WzJdID8gdFsyXS5zcGxpdCgiOiIpWzFdIDogdm9pZCAwIH0gfSwgZW0ud3JpdGVDcnlwdG9LZXlQYXJhbXMgPSBmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5rZXlNZXRob2QgKyAiOiIgKyBlLmtleVNhbHQgKyAoZS5saWZlVGltZSA/ICJ8IiArIGUubGlmZVRpbWUgOiAiIikgKyAoZS5ta2lWYWx1ZSAmJiBlLm1raUxlbmd0aCA/ICJ8IiArIGUubWtpVmFsdWUgKyAiOiIgKyBlLm1raUxlbmd0aCA6ICIiKSB9LCBlbS5nZXRDcnlwdG9QYXJhbWV0ZXJzID0gZnVuY3Rpb24gKGUsIHQpIHsgcmV0dXJuIGVtLm1hdGNoUHJlZml4KGUgKyB0LCAiYT1jcnlwdG86IikubWFwKGVtLnBhcnNlQ3J5cHRvTGluZSkgfSwgZW0uZ2V0SWNlUGFyYW1ldGVycyA9IGZ1bmN0aW9uIChlLCB0KSB7IGxldCBuID0gZW0ubWF0Y2hQcmVmaXgoZSArIHQsICJhPWljZS11ZnJhZzoiKVswXSwgciA9IGVtLm1hdGNoUHJlZml4KGUgKyB0LCAiYT1pY2UtcHdkOiIpWzBdOyByZXR1cm4gbiAmJiByID8geyB1c2VybmFtZUZyYWdtZW50OiBuLnN1YnN0cmluZygxMiksIHBhc3N3b3JkOiByLnN1YnN0cmluZygxMCkgfSA6IG51bGwgfSwgZW0ud3JpdGVJY2VQYXJhbWV0ZXJzID0gZnVuY3Rpb24gKGUpIHsgbGV0IHQgPSAiYT1pY2UtdWZyYWc6IiArIGUudXNlcm5hbWVGcmFnbWVudCArICJcclxuYT1pY2UtcHdkOiIgKyBlLnBhc3N3b3JkICsgIlxyXG4iOyByZXR1cm4gZS5pY2VMaXRlICYmICh0ICs9ICJhPWljZS1saXRlXHJcbiIpLCB0IH0sIGVtLnBhcnNlUnRwUGFyYW1ldGVycyA9IGZ1bmN0aW9uIChlKSB7IGxldCB0ID0geyBjb2RlY3M6IFtdLCBoZWFkZXJFeHRlbnNpb25zOiBbXSwgZmVjTWVjaGFuaXNtczogW10sIHJ0Y3A6IFtdIH0sIG4gPSBlbS5zcGxpdExpbmVzKGUpWzBdLnNwbGl0KCIgIik7IHQucHJvZmlsZSA9IG5bMl07IGZvciAobGV0IHIgPSAzOyByIDwgbi5sZW5ndGg7IHIrKykgeyBsZXQgaSA9IG5bcl0sIG8gPSBlbS5tYXRjaFByZWZpeChlLCAiYT1ydHBtYXA6IiArIGkgKyAiICIpWzBdOyBpZiAobykgeyBsZXQgbiA9IGVtLnBhcnNlUnRwTWFwKG8pLCByID0gZW0ubWF0Y2hQcmVmaXgoZSwgImE9Zm10cDoiICsgaSArICIgIik7IHN3aXRjaCAobi5wYXJhbWV0ZXJzID0gci5sZW5ndGggPyBlbS5wYXJzZUZtdHAoclswXSkgOiB7fSwgbi5ydGNwRmVlZGJhY2sgPSBlbS5tYXRjaFByZWZpeChlLCAiYT1ydGNwLWZiOiIgKyBpICsgIiAiKS5tYXAoZW0ucGFyc2VSdGNwRmIpLCB0LmNvZGVjcy5wdXNoKG4pLCBuLm5hbWUudG9VcHBlckNhc2UoKSkgeyBjYXNlICJSRUQiOiBjYXNlICJVTFBGRUMiOiB0LmZlY01lY2hhbmlzbXMucHVzaChuLm5hbWUudG9VcHBlckNhc2UoKSkgfSB9IH0gZW0ubWF0Y2hQcmVmaXgoZSwgImE9ZXh0bWFwOiIpLmZvckVhY2goZSA9PiB7IHQuaGVhZGVyRXh0ZW5zaW9ucy5wdXNoKGVtLnBhcnNlRXh0bWFwKGUpKSB9KTsgbGV0IHIgPSBlbS5tYXRjaFByZWZpeChlLCAiYT1ydGNwLWZiOiogIikubWFwKGVtLnBhcnNlUnRjcEZiKTsgcmV0dXJuIHQuY29kZWNzLmZvckVhY2goZSA9PiB7IHIuZm9yRWFjaCh0ID0+IHsgZS5ydGNwRmVlZGJhY2suZmluZChlID0+IGUudHlwZSA9PT0gdC50eXBlICYmIGUucGFyYW1ldGVyID09PSB0LnBhcmFtZXRlcikgfHwgZS5ydGNwRmVlZGJhY2sucHVzaCh0KSB9KSB9KSwgdCB9LCBlbS53cml0ZVJ0cERlc2NyaXB0aW9uID0gZnVuY3Rpb24gKGUsIHQpIHsgbGV0IG4gPSAiIjsgbiArPSAibT0iICsgZSArICIgIiArICh0LmNvZGVjcy5sZW5ndGggPiAwID8gIjkiIDogIjAiKSArICIgIiArICh0LnByb2ZpbGUgfHwgIlVEUC9UTFMvUlRQL1NBVlBGIikgKyAiICIgKyB0LmNvZGVjcy5tYXAoZSA9PiB2b2lkIDAgIT09IGUucHJlZmVycmVkUGF5bG9hZFR5cGUgPyBlLnByZWZlcnJlZFBheWxvYWRUeXBlIDogZS5wYXlsb2FkVHlwZSkuam9pbigiICIpICsgIlxyXG5jPUlOIElQNCAwLjAuMC4wXHJcbmE9cnRjcDo5IElOIElQNCAwLjAuMC4wXHJcbiIsIHQuY29kZWNzLmZvckVhY2goZSA9PiB7IG4gKz0gZW0ud3JpdGVSdHBNYXAoZSkgKyBlbS53cml0ZUZtdHAoZSkgKyBlbS53cml0ZVJ0Y3BGYihlKSB9KTsgbGV0IHIgPSAwOyByZXR1cm4gdC5jb2RlY3MuZm9yRWFjaChlID0+IHsgZS5tYXhwdGltZSA+IHIgJiYgKHIgPSBlLm1heHB0aW1lKSB9KSwgciA+IDAgJiYgKG4gKz0gImE9bWF4cHRpbWU6IiArIHIgKyAiXHJcbiIpLCB0LmhlYWRlckV4dGVuc2lvbnMgJiYgdC5oZWFkZXJFeHRlbnNpb25zLmZvckVhY2goZSA9PiB7IG4gKz0gZW0ud3JpdGVFeHRtYXAoZSkgfSksIG4gfSwgZW0ucGFyc2VSdHBFbmNvZGluZ1BhcmFtZXRlcnMgPSBmdW5jdGlvbiAoZSkgeyBsZXQgdDsgbGV0IG4gPSBbXSwgciA9IGVtLnBhcnNlUnRwUGFyYW1ldGVycyhlKSwgaSA9IC0xICE9PSByLmZlY01lY2hhbmlzbXMuaW5kZXhPZigiUkVEIiksIG8gPSAtMSAhPT0gci5mZWNNZWNoYW5pc21zLmluZGV4T2YoIlVMUEZFQyIpLCBzID0gZW0ubWF0Y2hQcmVmaXgoZSwgImE9c3NyYzoiKS5tYXAoZSA9PiBlbS5wYXJzZVNzcmNNZWRpYShlKSkuZmlsdGVyKGUgPT4gImNuYW1lIiA9PT0gZS5hdHRyaWJ1dGUpLCBhID0gcy5sZW5ndGggPiAwICYmIHNbMF0uc3NyYywgYyA9IGVtLm1hdGNoUHJlZml4KGUsICJhPXNzcmMtZ3JvdXA6RklEIikubWFwKGUgPT4gZS5zdWJzdHJpbmcoMTcpLnNwbGl0KCIgIikubWFwKGUgPT4gcGFyc2VJbnQoZSwgMTApKSk7IGMubGVuZ3RoID4gMCAmJiBjWzBdLmxlbmd0aCA+IDEgJiYgY1swXVswXSA9PT0gYSAmJiAodCA9IGNbMF1bMV0pLCByLmNvZGVjcy5mb3JFYWNoKGUgPT4geyBpZiAoIlJUWCIgPT09IGUubmFtZS50b1VwcGVyQ2FzZSgpICYmIGUucGFyYW1ldGVycy5hcHQpIHsgbGV0IHIgPSB7IHNzcmM6IGEsIGNvZGVjUGF5bG9hZFR5cGU6IHBhcnNlSW50KGUucGFyYW1ldGVycy5hcHQsIDEwKSB9OyBhICYmIHQgJiYgKHIucnR4ID0geyBzc3JjOiB0IH0pLCBuLnB1c2gociksIGkgJiYgKChyID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShyKSkpLmZlYyA9IHsgc3NyYzogYSwgbWVjaGFuaXNtOiBvID8gInJlZCt1bHBmZWMiIDogInJlZCIgfSwgbi5wdXNoKHIpKSB9IH0pLCAwID09PSBuLmxlbmd0aCAmJiBhICYmIG4ucHVzaCh7IHNzcmM6IGEgfSk7IGxldCBsID0gZW0ubWF0Y2hQcmVmaXgoZSwgImI9Iik7IHJldHVybiBsLmxlbmd0aCAmJiAobCA9IDAgPT09IGxbMF0uaW5kZXhPZigiYj1USUFTOiIpID8gcGFyc2VJbnQobFswXS5zdWJzdHJpbmcoNyksIDEwKSA6IDAgPT09IGxbMF0uaW5kZXhPZigiYj1BUzoiKSA/IDk1MCAqIHBhcnNlSW50KGxbMF0uc3Vic3RyaW5nKDUpLCAxMCkgLSAxNmUzIDogdm9pZCAwLCBuLmZvckVhY2goZSA9PiB7IGUubWF4Qml0cmF0ZSA9IGwgfSkpLCBuIH0sIGVtLnBhcnNlUnRjcFBhcmFtZXRlcnMgPSBmdW5jdGlvbiAoZSkgeyBsZXQgdCA9IHt9LCBuID0gZW0ubWF0Y2hQcmVmaXgoZSwgImE9c3NyYzoiKS5tYXAoZSA9PiBlbS5wYXJzZVNzcmNNZWRpYShlKSkuZmlsdGVyKGUgPT4gImNuYW1lIiA9PT0gZS5hdHRyaWJ1dGUpWzBdOyBuICYmICh0LmNuYW1lID0gbi52YWx1ZSwgdC5zc3JjID0gbi5zc3JjKTsgbGV0IHIgPSBlbS5tYXRjaFByZWZpeChlLCAiYT1ydGNwLXJzaXplIik7IHQucmVkdWNlZFNpemUgPSByLmxlbmd0aCA+IDAsIHQuY29tcG91bmQgPSAwID09PSByLmxlbmd0aDsgbGV0IGkgPSBlbS5tYXRjaFByZWZpeChlLCAiYT1ydGNwLW11eCIpOyByZXR1cm4gdC5tdXggPSBpLmxlbmd0aCA+IDAsIHQgfSwgZW0ud3JpdGVSdGNwUGFyYW1ldGVycyA9IGZ1bmN0aW9uIChlKSB7IGxldCB0ID0gIiI7IHJldHVybiBlLnJlZHVjZWRTaXplICYmICh0ICs9ICJhPXJ0Y3AtcnNpemVcclxuIiksIGUubXV4ICYmICh0ICs9ICJhPXJ0Y3AtbXV4XHJcbiIpLCB2b2lkIDAgIT09IGUuc3NyYyAmJiBlLmNuYW1lICYmICh0ICs9ICJhPXNzcmM6IiArIGUuc3NyYyArICIgY25hbWU6IiArIGUuY25hbWUgKyAiXHJcbiIpLCB0IH0sIGVtLnBhcnNlTXNpZCA9IGZ1bmN0aW9uIChlKSB7IGxldCB0OyBsZXQgbiA9IGVtLm1hdGNoUHJlZml4KGUsICJhPW1zaWQ6Iik7IGlmICgxID09PSBuLmxlbmd0aCkgcmV0dXJuIHsgc3RyZWFtOiAodCA9IG5bMF0uc3Vic3RyaW5nKDcpLnNwbGl0KCIgIikpWzBdLCB0cmFjazogdFsxXSB9OyBsZXQgciA9IGVtLm1hdGNoUHJlZml4KGUsICJhPXNzcmM6IikubWFwKGUgPT4gZW0ucGFyc2VTc3JjTWVkaWEoZSkpLmZpbHRlcihlID0+ICJtc2lkIiA9PT0gZS5hdHRyaWJ1dGUpOyBpZiAoci5sZW5ndGggPiAwKSByZXR1cm4geyBzdHJlYW06ICh0ID0gclswXS52YWx1ZS5zcGxpdCgiICIpKVswXSwgdHJhY2s6IHRbMV0gfSB9LCBlbS5wYXJzZVNjdHBEZXNjcmlwdGlvbiA9IGZ1bmN0aW9uIChlKSB7IGxldCB0OyBsZXQgbiA9IGVtLnBhcnNlTUxpbmUoZSksIHIgPSBlbS5tYXRjaFByZWZpeChlLCAiYT1tYXgtbWVzc2FnZS1zaXplOiIpOyByLmxlbmd0aCA+IDAgJiYgKHQgPSBwYXJzZUludChyWzBdLnN1YnN0cmluZygxOSksIDEwKSksIGlzTmFOKHQpICYmICh0ID0gNjU1MzYpOyBsZXQgaSA9IGVtLm1hdGNoUHJlZml4KGUsICJhPXNjdHAtcG9ydDoiKTsgaWYgKGkubGVuZ3RoID4gMCkgcmV0dXJuIHsgcG9ydDogcGFyc2VJbnQoaVswXS5zdWJzdHJpbmcoMTIpLCAxMCksIHByb3RvY29sOiBuLmZtdCwgbWF4TWVzc2FnZVNpemU6IHQgfTsgbGV0IG8gPSBlbS5tYXRjaFByZWZpeChlLCAiYT1zY3RwbWFwOiIpOyBpZiAoby5sZW5ndGggPiAwKSB7IGxldCBlID0gb1swXS5zdWJzdHJpbmcoMTApLnNwbGl0KCIgIik7IHJldHVybiB7IHBvcnQ6IHBhcnNlSW50KGVbMF0sIDEwKSwgcHJvdG9jb2w6IGVbMV0sIG1heE1lc3NhZ2VTaXplOiB0IH0gfSB9LCBlbS53cml0ZVNjdHBEZXNjcmlwdGlvbiA9IGZ1bmN0aW9uIChlLCB0KSB7IGxldCBuID0gW107IHJldHVybiBuID0gIkRUTFMvU0NUUCIgIT09IGUucHJvdG9jb2wgPyBbIm09IiArIGUua2luZCArICIgOSAiICsgZS5wcm90b2NvbCArICIgIiArIHQucHJvdG9jb2wgKyAiXHJcbiIsICJjPUlOIElQNCAwLjAuMC4wXHJcbiIsICJhPXNjdHAtcG9ydDoiICsgdC5wb3J0ICsgIlxyXG4iXSA6IFsibT0iICsgZS5raW5kICsgIiA5ICIgKyBlLnByb3RvY29sICsgIiAiICsgdC5wb3J0ICsgIlxyXG4iLCAiYz1JTiBJUDQgMC4wLjAuMFxyXG4iLCAiYT1zY3RwbWFwOiIgKyB0LnBvcnQgKyAiICIgKyB0LnByb3RvY29sICsgIiA2NTUzNVxyXG4iXSwgdm9pZCAwICE9PSB0Lm1heE1lc3NhZ2VTaXplICYmIG4ucHVzaCgiYT1tYXgtbWVzc2FnZS1zaXplOiIgKyB0Lm1heE1lc3NhZ2VTaXplICsgIlxyXG4iKSwgbi5qb2luKCIiKSB9LCBlbS5nZW5lcmF0ZVNlc3Npb25JZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKS5zdWJzdHIoMiwgMjIpIH0sIGVtLndyaXRlU2Vzc2lvbkJvaWxlcnBsYXRlID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsgcmV0dXJuICJ2PTBcclxubz0iICsgKG4gfHwgInRoaXNpc2FkYXB0ZXJvcnRjIikgKyAiICIgKyAoZSB8fCBlbS5nZW5lcmF0ZVNlc3Npb25JZCgpKSArICIgIiArICh2b2lkIDAgIT09IHQgPyB0IDogMikgKyAiIElOIElQNCAxMjcuMC4wLjFcclxucz0tXHJcbnQ9MCAwXHJcbiIgfSwgZW0uZ2V0RGlyZWN0aW9uID0gZnVuY3Rpb24gKGUsIHQpIHsgbGV0IG4gPSBlbS5zcGxpdExpbmVzKGUpOyBmb3IgKGxldCBlID0gMDsgZSA8IG4ubGVuZ3RoOyBlKyspc3dpdGNoIChuW2VdKSB7IGNhc2UgImE9c2VuZHJlY3YiOiBjYXNlICJhPXNlbmRvbmx5IjogY2FzZSAiYT1yZWN2b25seSI6IGNhc2UgImE9aW5hY3RpdmUiOiByZXR1cm4gbltlXS5zdWJzdHJpbmcoMikgfXJldHVybiB0ID8gZW0uZ2V0RGlyZWN0aW9uKHQpIDogInNlbmRyZWN2IiB9LCBlbS5nZXRLaW5kID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGVtLnNwbGl0TGluZXMoZSlbMF0uc3BsaXQoIiAiKVswXS5zdWJzdHJpbmcoMikgfSwgZW0uaXNSZWplY3RlZCA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiAiMCIgPT09IGUuc3BsaXQoIiAiLCAyKVsxXSB9LCBlbS5wYXJzZU1MaW5lID0gZnVuY3Rpb24gKGUpIHsgbGV0IHQgPSBlbS5zcGxpdExpbmVzKGUpWzBdLnN1YnN0cmluZygyKS5zcGxpdCgiICIpOyByZXR1cm4geyBraW5kOiB0WzBdLCBwb3J0OiBwYXJzZUludCh0WzFdLCAxMCksIHByb3RvY29sOiB0WzJdLCBmbXQ6IHQuc2xpY2UoMykuam9pbigiICIpIH0gfSwgZW0ucGFyc2VPTGluZSA9IGZ1bmN0aW9uIChlKSB7IGxldCB0ID0gZW0ubWF0Y2hQcmVmaXgoZSwgIm89IilbMF0uc3Vic3RyaW5nKDIpLnNwbGl0KCIgIik7IHJldHVybiB7IHVzZXJuYW1lOiB0WzBdLCBzZXNzaW9uSWQ6IHRbMV0sIHNlc3Npb25WZXJzaW9uOiBwYXJzZUludCh0WzJdLCAxMCksIG5ldFR5cGU6IHRbM10sIGFkZHJlc3NUeXBlOiB0WzRdLCBhZGRyZXNzOiB0WzVdIH0gfSwgZW0uaXNWYWxpZFNEUCA9IGZ1bmN0aW9uIChlKSB7IGlmICgic3RyaW5nIiAhPSB0eXBlb2YgZSB8fCAwID09PSBlLmxlbmd0aCkgcmV0dXJuICExOyBsZXQgdCA9IGVtLnNwbGl0TGluZXMoZSk7IGZvciAobGV0IGUgPSAwOyBlIDwgdC5sZW5ndGg7IGUrKylpZiAodFtlXS5sZW5ndGggPCAyIHx8ICI9IiAhPT0gdFtlXS5jaGFyQXQoMSkpIHJldHVybiAhMTsgcmV0dXJuICEwIH0sIGVmID0gZW07IGxldCBlUyA9IGZ1bmN0aW9uICh7IHdpbmRvdzogZSB9ID0ge30sIHQgPSB7IHNoaW1DaHJvbWU6ICEwLCBzaGltRmlyZWZveDogITAsIHNoaW1TYWZhcmk6ICEwIH0pIHsgbGV0IG4gPSBmdW5jdGlvbiAoZSkgeyBsZXQgdCA9IHsgYnJvd3NlcjogbnVsbCwgdmVyc2lvbjogbnVsbCB9OyBpZiAodm9pZCAwID09PSBlIHx8ICFlLm5hdmlnYXRvciB8fCAhZS5uYXZpZ2F0b3IudXNlckFnZW50KSByZXR1cm4gdC5icm93c2VyID0gIk5vdCBhIGJyb3dzZXIuIiwgdDsgbGV0IHsgbmF2aWdhdG9yOiBuIH0gPSBlOyBpZiAobi51c2VyQWdlbnREYXRhICYmIG4udXNlckFnZW50RGF0YS5icmFuZHMpIHsgbGV0IGUgPSBuLnVzZXJBZ2VudERhdGEuYnJhbmRzLmZpbmQoZSA9PiAiQ2hyb21pdW0iID09PSBlLmJyYW5kKTsgaWYgKGUpIHJldHVybiB7IGJyb3dzZXI6ICJjaHJvbWUiLCB2ZXJzaW9uOiBwYXJzZUludChlLnZlcnNpb24sIDEwKSB9IH0gcmV0dXJuIG4ubW96R2V0VXNlck1lZGlhID8gKHQuYnJvd3NlciA9ICJmaXJlZm94IiwgdC52ZXJzaW9uID0gcChuLnVzZXJBZ2VudCwgL0ZpcmVmb3hcLyhcZCspXC4vLCAxKSkgOiBuLndlYmtpdEdldFVzZXJNZWRpYSB8fCAhMSA9PT0gZS5pc1NlY3VyZUNvbnRleHQgJiYgZS53ZWJraXRSVENQZWVyQ29ubmVjdGlvbiA/ICh0LmJyb3dzZXIgPSAiY2hyb21lIiwgdC52ZXJzaW9uID0gcChuLnVzZXJBZ2VudCwgL0Nocm9tKGV8aXVtKVwvKFxkKylcLi8sIDIpKSA6IGUuUlRDUGVlckNvbm5lY3Rpb24gJiYgbi51c2VyQWdlbnQubWF0Y2goL0FwcGxlV2ViS2l0XC8oXGQrKVwuLykgPyAodC5icm93c2VyID0gInNhZmFyaSIsIHQudmVyc2lvbiA9IHAobi51c2VyQWdlbnQsIC9BcHBsZVdlYktpdFwvKFxkKylcLi8sIDEpLCB0LnN1cHBvcnRzVW5pZmllZFBsYW4gPSBlLlJUQ1J0cFRyYW5zY2VpdmVyICYmICJjdXJyZW50RGlyZWN0aW9uIiBpbiBlLlJUQ1J0cFRyYW5zY2VpdmVyLnByb3RvdHlwZSkgOiB0LmJyb3dzZXIgPSAiTm90IGEgc3VwcG9ydGVkIGJyb3dzZXIuIiwgdCB9KGUpLCByID0geyBicm93c2VyRGV0YWlsczogbiwgY29tbW9uU2hpbTogZXUsIGV4dHJhY3RWZXJzaW9uOiBwLCBkaXNhYmxlTG9nOiBoLCBkaXNhYmxlV2FybmluZ3M6IHUsIHNkcDogZWYgfTsgc3dpdGNoIChuLmJyb3dzZXIpIHsgY2FzZSAiY2hyb21lIjogaWYgKCFqIHx8ICFqLnNoaW1QZWVyQ29ubmVjdGlvbiB8fCAhdC5zaGltQ2hyb21lKSB7IGYoIkNocm9tZSBzaGltIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGlzIGFkYXB0ZXIgcmVsZWFzZS4iKTsgYnJlYWsgfSBpZiAobnVsbCA9PT0gbi52ZXJzaW9uKSB7IGYoIkNocm9tZSBzaGltIGNhbiBub3QgZGV0ZXJtaW5lIHZlcnNpb24sIG5vdCBzaGltbWluZy4iKTsgYnJlYWsgfSBmKCJhZGFwdGVyLmpzIHNoaW1taW5nIGNocm9tZS4iKSwgci5icm93c2VyU2hpbSA9IGosIGVrKGUsIG4pLCBlVChlLCBuKSwgai5zaGltR2V0VXNlck1lZGlhKGUsIG4pLCBqLnNoaW1NZWRpYVN0cmVhbShlLCBuKSwgai5zaGltUGVlckNvbm5lY3Rpb24oZSwgbiksIGouc2hpbU9uVHJhY2soZSwgbiksIGouc2hpbUFkZFRyYWNrUmVtb3ZlVHJhY2soZSwgbiksIGouc2hpbUdldFNlbmRlcnNXaXRoRHRtZihlLCBuKSwgai5zaGltU2VuZGVyUmVjZWl2ZXJHZXRTdGF0cyhlLCBuKSwgai5maXhOZWdvdGlhdGlvbk5lZWRlZChlLCBuKSwgZWcoZSwgbiksIGV5KGUsIG4pLCBlYihlLCBuKSwgZV8oZSwgbiksIGVDKGUsIG4pLCBldihlLCBuKTsgYnJlYWs7IGNhc2UgImZpcmVmb3giOiBpZiAoIVYgfHwgIVYuc2hpbVBlZXJDb25uZWN0aW9uIHx8ICF0LnNoaW1GaXJlZm94KSB7IGYoIkZpcmVmb3ggc2hpbSBpcyBub3QgaW5jbHVkZWQgaW4gdGhpcyBhZGFwdGVyIHJlbGVhc2UuIik7IGJyZWFrIH0gZigiYWRhcHRlci5qcyBzaGltbWluZyBmaXJlZm94LiIpLCByLmJyb3dzZXJTaGltID0gViwgZWsoZSwgbiksIGVUKGUsIG4pLCBWLnNoaW1HZXRVc2VyTWVkaWEoZSwgbiksIFYuc2hpbVBlZXJDb25uZWN0aW9uKGUsIG4pLCBWLnNoaW1PblRyYWNrKGUsIG4pLCBWLnNoaW1SZW1vdmVTdHJlYW0oZSwgbiksIFYuc2hpbVNlbmRlckdldFN0YXRzKGUsIG4pLCBWLnNoaW1SZWNlaXZlckdldFN0YXRzKGUsIG4pLCBWLnNoaW1SVENEYXRhQ2hhbm5lbChlLCBuKSwgVi5zaGltQWRkVHJhbnNjZWl2ZXIoZSwgbiksIFYuc2hpbUdldFBhcmFtZXRlcnMoZSwgbiksIFYuc2hpbUNyZWF0ZU9mZmVyKGUsIG4pLCBWLnNoaW1DcmVhdGVBbnN3ZXIoZSwgbiksIGVnKGUsIG4pLCBlYihlLCBuKSwgZV8oZSwgbiksIGVDKGUsIG4pOyBicmVhazsgY2FzZSAic2FmYXJpIjogaWYgKCFlciB8fCAhdC5zaGltU2FmYXJpKSB7IGYoIlNhZmFyaSBzaGltIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGlzIGFkYXB0ZXIgcmVsZWFzZS4iKTsgYnJlYWsgfSBmKCJhZGFwdGVyLmpzIHNoaW1taW5nIHNhZmFyaS4iKSwgci5icm93c2VyU2hpbSA9IGVyLCBlayhlLCBuKSwgZVQoZSwgbiksIGVyLnNoaW1SVENJY2VTZXJ2ZXJVcmxzKGUsIG4pLCBlci5zaGltQ3JlYXRlT2ZmZXJMZWdhY3koZSwgbiksIGVyLnNoaW1DYWxsYmFja3NBUEkoZSwgbiksIGVyLnNoaW1Mb2NhbFN0cmVhbXNBUEkoZSwgbiksIGVyLnNoaW1SZW1vdGVTdHJlYW1zQVBJKGUsIG4pLCBlci5zaGltVHJhY2tFdmVudFRyYW5zY2VpdmVyKGUsIG4pLCBlci5zaGltR2V0VXNlck1lZGlhKGUsIG4pLCBlci5zaGltQXVkaW9Db250ZXh0KGUsIG4pLCBlZyhlLCBuKSwgZXkoZSwgbiksIGVfKGUsIG4pLCBlQyhlLCBuKSwgZXYoZSwgbik7IGJyZWFrOyBkZWZhdWx0OiBmKCJVbnN1cHBvcnRlZCBicm93c2VyISIpIH1yZXR1cm4gciB9KHsgd2luZG93OiAidW5kZWZpbmVkIiA9PSB0eXBlb2Ygd2luZG93ID8gdm9pZCAwIDogd2luZG93IH0pLCBlUiA9IGVTLmRlZmF1bHQgfHwgZVMsIGVQID0gbmV3IGNsYXNzIHsKICAgICAgaXNXZWJSVENTdXBwb3J0ZWQoKSB7IHJldHVybiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgUlRDUGVlckNvbm5lY3Rpb24gfSBpc0Jyb3dzZXJTdXBwb3J0ZWQoKSB7IGxldCBlID0gdGhpcy5nZXRCcm93c2VyKCksIHQgPSB0aGlzLmdldFZlcnNpb24oKTsgcmV0dXJuICEhdGhpcy5zdXBwb3J0ZWRCcm93c2Vycy5pbmNsdWRlcyhlKSAmJiAoImNocm9tZSIgPT09IGUgPyB0ID49IHRoaXMubWluQ2hyb21lVmVyc2lvbiA6ICJmaXJlZm94IiA9PT0gZSA/IHQgPj0gdGhpcy5taW5GaXJlZm94VmVyc2lvbiA6ICJzYWZhcmkiID09PSBlICYmICF0aGlzLmlzSU9TICYmIHQgPj0gdGhpcy5taW5TYWZhcmlWZXJzaW9uKSB9IGdldEJyb3dzZXIoKSB7IHJldHVybiBlUi5icm93c2VyRGV0YWlscy5icm93c2VyIH0gZ2V0VmVyc2lvbigpIHsgcmV0dXJuIGVSLmJyb3dzZXJEZXRhaWxzLnZlcnNpb24gfHwgMCB9IGlzVW5pZmllZFBsYW5TdXBwb3J0ZWQoKSB7IGxldCBlOyBsZXQgdCA9IHRoaXMuZ2V0QnJvd3NlcigpLCBuID0gZVIuYnJvd3NlckRldGFpbHMudmVyc2lvbiB8fCAwOyBpZiAoImNocm9tZSIgPT09IHQgJiYgbiA8IHRoaXMubWluQ2hyb21lVmVyc2lvbikgcmV0dXJuICExOyBpZiAoImZpcmVmb3giID09PSB0ICYmIG4gPj0gdGhpcy5taW5GaXJlZm94VmVyc2lvbikgcmV0dXJuICEwOyBpZiAoIXdpbmRvdy5SVENSdHBUcmFuc2NlaXZlciB8fCAhKCJjdXJyZW50RGlyZWN0aW9uIiBpbiBSVENSdHBUcmFuc2NlaXZlci5wcm90b3R5cGUpKSByZXR1cm4gITE7IGxldCByID0gITE7IHRyeSB7IChlID0gbmV3IFJUQ1BlZXJDb25uZWN0aW9uKS5hZGRUcmFuc2NlaXZlcigiYXVkaW8iKSwgciA9ICEwIH0gY2F0Y2ggKGUpIHsgfSBmaW5hbGx5IHsgZSAmJiBlLmNsb3NlKCkgfSByZXR1cm4gciB9IHRvU3RyaW5nKCkgewogICAgICAgIHJldHVybiBgU3VwcG9ydHM6CiAgICBicm93c2VyOiR7dGhpcy5nZXRCcm93c2VyKCl9CiAgICB2ZXJzaW9uOiR7dGhpcy5nZXRWZXJzaW9uKCl9CiAgICBpc0lPUzoke3RoaXMuaXNJT1N9CiAgICBpc1dlYlJUQ1N1cHBvcnRlZDoke3RoaXMuaXNXZWJSVENTdXBwb3J0ZWQoKX0KICAgIGlzQnJvd3NlclN1cHBvcnRlZDoke3RoaXMuaXNCcm93c2VyU3VwcG9ydGVkKCl9CiAgICBpc1VuaWZpZWRQbGFuU3VwcG9ydGVkOiR7dGhpcy5pc1VuaWZpZWRQbGFuU3VwcG9ydGVkKCl9YAogICAgICB9IGNvbnN0cnVjdG9yKCkgeyB0aGlzLmlzSU9TID0gInVuZGVmaW5lZCIgIT0gdHlwZW9mIG5hdmlnYXRvciAmJiBbImlQYWQiLCAiaVBob25lIiwgImlQb2QiXS5pbmNsdWRlcyhuYXZpZ2F0b3IucGxhdGZvcm0pLCB0aGlzLnN1cHBvcnRlZEJyb3dzZXJzID0gWyJmaXJlZm94IiwgImNocm9tZSIsICJzYWZhcmkiXSwgdGhpcy5taW5GaXJlZm94VmVyc2lvbiA9IDU5LCB0aGlzLm1pbkNocm9tZVZlcnNpb24gPSA3MiwgdGhpcy5taW5TYWZhcmlWZXJzaW9uID0gNjA1IH0KICAgIH0sIGV3ID0gZSA9PiAhZSB8fCAvXltBLVphLXowLTldKyg/OlsgXy1dW0EtWmEtejAtOV0rKSokLy50ZXN0KGUpLCBlRSA9ICgpID0+IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIpLCBlRCA9IHsgaWNlU2VydmVyczogW3sgdXJsczogInN0dW46c3R1bi5sLmdvb2dsZS5jb206MTkzMDIiIH0sIHsgdXJsczogWyJ0dXJuOmV1LTAudHVybi5wZWVyanMuY29tOjM0NzgiLCAidHVybjp1cy0wLnR1cm4ucGVlcmpzLmNvbTozNDc4Il0sIHVzZXJuYW1lOiAicGVlcmpzIiwgY3JlZGVudGlhbDogInBlZXJqc3AiIH1dLCBzZHBTZW1hbnRpY3M6ICJ1bmlmaWVkLXBsYW4iIH0sIGV4ID0gbmV3IGNsYXNzIGV4dGVuZHMgbiB7IG5vb3AoKSB7IH0gYmxvYlRvQXJyYXlCdWZmZXIoZSwgdCkgeyBsZXQgbiA9IG5ldyBGaWxlUmVhZGVyOyByZXR1cm4gbi5vbmxvYWQgPSBmdW5jdGlvbiAoZSkgeyBlLnRhcmdldCAmJiB0KGUudGFyZ2V0LnJlc3VsdCkgfSwgbi5yZWFkQXNBcnJheUJ1ZmZlcihlKSwgbiB9IGJpbmFyeVN0cmluZ1RvQXJyYXlCdWZmZXIoZSkgeyBsZXQgdCA9IG5ldyBVaW50OEFycmF5KGUubGVuZ3RoKTsgZm9yIChsZXQgbiA9IDA7IG4gPCBlLmxlbmd0aDsgbisrKXRbbl0gPSAyNTUgJiBlLmNoYXJDb2RlQXQobik7IHJldHVybiB0LmJ1ZmZlciB9IGlzU2VjdXJlKCkgeyByZXR1cm4gImh0dHBzOiIgPT09IGxvY2F0aW9uLnByb3RvY29sIH0gY29uc3RydWN0b3IoLi4uZSkgeyBzdXBlciguLi5lKSwgdGhpcy5DTE9VRF9IT1NUID0gIjAucGVlcmpzLmNvbSIsIHRoaXMuQ0xPVURfUE9SVCA9IDQ0MywgdGhpcy5jaHVua2VkQnJvd3NlcnMgPSB7IENocm9tZTogMSwgY2hyb21lOiAxIH0sIHRoaXMuZGVmYXVsdENvbmZpZyA9IGVELCB0aGlzLmJyb3dzZXIgPSBlUC5nZXRCcm93c2VyKCksIHRoaXMuYnJvd3NlclZlcnNpb24gPSBlUC5nZXRWZXJzaW9uKCksIHRoaXMucGFjayA9IG8sIHRoaXMudW5wYWNrID0gaSwgdGhpcy5zdXBwb3J0cyA9IGZ1bmN0aW9uICgpIHsgbGV0IGU7IGxldCB0ID0geyBicm93c2VyOiBlUC5pc0Jyb3dzZXJTdXBwb3J0ZWQoKSwgd2ViUlRDOiBlUC5pc1dlYlJUQ1N1cHBvcnRlZCgpLCBhdWRpb1ZpZGVvOiAhMSwgZGF0YTogITEsIGJpbmFyeUJsb2I6ICExLCByZWxpYWJsZTogITEgfTsgaWYgKCF0LndlYlJUQykgcmV0dXJuIHQ7IHRyeSB7IGxldCBuOyBlID0gbmV3IFJUQ1BlZXJDb25uZWN0aW9uKGVEKSwgdC5hdWRpb1ZpZGVvID0gITA7IHRyeSB7IG4gPSBlLmNyZWF0ZURhdGFDaGFubmVsKCJfUEVFUkpTVEVTVCIsIHsgb3JkZXJlZDogITAgfSksIHQuZGF0YSA9ICEwLCB0LnJlbGlhYmxlID0gISFuLm9yZGVyZWQ7IHRyeSB7IG4uYmluYXJ5VHlwZSA9ICJibG9iIiwgdC5iaW5hcnlCbG9iID0gIWVQLmlzSU9TIH0gY2F0Y2ggKGUpIHsgfSB9IGNhdGNoIChlKSB7IH0gZmluYWxseSB7IG4gJiYgbi5jbG9zZSgpIH0gfSBjYXRjaCAoZSkgeyB9IGZpbmFsbHkgeyBlICYmIGUuY2xvc2UoKSB9IHJldHVybiB0IH0oKSwgdGhpcy52YWxpZGF0ZUlkID0gZXcsIHRoaXMucmFuZG9tVG9rZW4gPSBlRSB9IH07IChfID0gUCB8fCAoUCA9IHt9KSlbXy5EaXNhYmxlZCA9IDBdID0gIkRpc2FibGVkIiwgX1tfLkVycm9ycyA9IDFdID0gIkVycm9ycyIsIF9bXy5XYXJuaW5ncyA9IDJdID0gIldhcm5pbmdzIiwgX1tfLkFsbCA9IDNdID0gIkFsbCI7IHZhciBlSSA9IG5ldyBjbGFzcyB7IGdldCBsb2dMZXZlbCgpIHsgcmV0dXJuIHRoaXMuX2xvZ0xldmVsIH0gc2V0IGxvZ0xldmVsKGUpIHsgdGhpcy5fbG9nTGV2ZWwgPSBlIH0gbG9nKC4uLmUpIHsgdGhpcy5fbG9nTGV2ZWwgPj0gMyAmJiB0aGlzLl9wcmludCgzLCAuLi5lKSB9IHdhcm4oLi4uZSkgeyB0aGlzLl9sb2dMZXZlbCA+PSAyICYmIHRoaXMuX3ByaW50KDIsIC4uLmUpIH0gZXJyb3IoLi4uZSkgeyB0aGlzLl9sb2dMZXZlbCA+PSAxICYmIHRoaXMuX3ByaW50KDEsIC4uLmUpIH0gc2V0TG9nRnVuY3Rpb24oZSkgeyB0aGlzLl9wcmludCA9IGUgfSBfcHJpbnQoZSwgLi4udCkgeyBsZXQgbiA9IFsiUGVlckpTOiAiLCAuLi50XTsgZm9yIChsZXQgZSBpbiBuKSBuW2VdIGluc3RhbmNlb2YgRXJyb3IgJiYgKG5bZV0gPSAiKCIgKyBuW2VdLm5hbWUgKyAiKSAiICsgbltlXS5tZXNzYWdlKTsgZSA+PSAzID8gY29uc29sZS5sb2coLi4ubikgOiBlID49IDIgPyBjb25zb2xlLndhcm4oIldBUk5JTkciLCAuLi5uKSA6IGUgPj0gMSAmJiBjb25zb2xlLmVycm9yKCJFUlJPUiIsIC4uLm4pIH0gY29uc3RydWN0b3IoKSB7IHRoaXMuX2xvZ0xldmVsID0gMCB9IH0sIGVNID0ge30sIGVPID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSwgZWogPSAifiI7IGZ1bmN0aW9uIGVMKCkgeyB9IGZ1bmN0aW9uIGVBKGUsIHQsIG4pIHsgdGhpcy5mbiA9IGUsIHRoaXMuY29udGV4dCA9IHQsIHRoaXMub25jZSA9IG4gfHwgITEgfSBmdW5jdGlvbiBlQihlLCB0LCBuLCByLCBpKSB7IGlmICgiZnVuY3Rpb24iICE9IHR5cGVvZiBuKSB0aHJvdyBUeXBlRXJyb3IoIlRoZSBsaXN0ZW5lciBtdXN0IGJlIGEgZnVuY3Rpb24iKTsgdmFyIG8gPSBuZXcgZUEobiwgciB8fCBlLCBpKSwgcyA9IGVqID8gZWogKyB0IDogdDsgcmV0dXJuIGUuX2V2ZW50c1tzXSA/IGUuX2V2ZW50c1tzXS5mbiA/IGUuX2V2ZW50c1tzXSA9IFtlLl9ldmVudHNbc10sIG9dIDogZS5fZXZlbnRzW3NdLnB1c2gobykgOiAoZS5fZXZlbnRzW3NdID0gbywgZS5fZXZlbnRzQ291bnQrKyksIGUgfSBmdW5jdGlvbiBlRihlLCB0KSB7IDAgPT0gLS1lLl9ldmVudHNDb3VudCA/IGUuX2V2ZW50cyA9IG5ldyBlTCA6IGRlbGV0ZSBlLl9ldmVudHNbdF0gfSBmdW5jdGlvbiBlVSgpIHsgdGhpcy5fZXZlbnRzID0gbmV3IGVMLCB0aGlzLl9ldmVudHNDb3VudCA9IDAgfSBPYmplY3QuY3JlYXRlICYmIChlTC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKG51bGwpLCBuZXcgZUwoKS5fX3Byb3RvX18gfHwgKGVqID0gITEpKSwgZVUucHJvdG90eXBlLmV2ZW50TmFtZXMgPSBmdW5jdGlvbiAoKSB7IHZhciBlLCB0LCBuID0gW107IGlmICgwID09PSB0aGlzLl9ldmVudHNDb3VudCkgcmV0dXJuIG47IGZvciAodCBpbiBlID0gdGhpcy5fZXZlbnRzKSBlTy5jYWxsKGUsIHQpICYmIG4ucHVzaChlaiA/IHQuc2xpY2UoMSkgOiB0KTsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPyBuLmNvbmNhdChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpKSA6IG4gfSwgZVUucHJvdG90eXBlLmxpc3RlbmVycyA9IGZ1bmN0aW9uIChlKSB7IHZhciB0ID0gZWogPyBlaiArIGUgOiBlLCBuID0gdGhpcy5fZXZlbnRzW3RdOyBpZiAoIW4pIHJldHVybiBbXTsgaWYgKG4uZm4pIHJldHVybiBbbi5mbl07IGZvciAodmFyIHIgPSAwLCBpID0gbi5sZW5ndGgsIG8gPSBBcnJheShpKTsgciA8IGk7IHIrKylvW3JdID0gbltyXS5mbjsgcmV0dXJuIG8gfSwgZVUucHJvdG90eXBlLmxpc3RlbmVyQ291bnQgPSBmdW5jdGlvbiAoZSkgeyB2YXIgdCA9IGVqID8gZWogKyBlIDogZSwgbiA9IHRoaXMuX2V2ZW50c1t0XTsgcmV0dXJuIG4gPyBuLmZuID8gMSA6IG4ubGVuZ3RoIDogMCB9LCBlVS5wcm90b3R5cGUuZW1pdCA9IGZ1bmN0aW9uIChlLCB0LCBuLCByLCBpLCBvKSB7IHZhciBzID0gZWogPyBlaiArIGUgOiBlOyBpZiAoIXRoaXMuX2V2ZW50c1tzXSkgcmV0dXJuICExOyB2YXIgYSwgYywgbCA9IHRoaXMuX2V2ZW50c1tzXSwgcCA9IGFyZ3VtZW50cy5sZW5ndGg7IGlmIChsLmZuKSB7IHN3aXRjaCAobC5vbmNlICYmIHRoaXMucmVtb3ZlTGlzdGVuZXIoZSwgbC5mbiwgdm9pZCAwLCAhMCksIHApIHsgY2FzZSAxOiByZXR1cm4gbC5mbi5jYWxsKGwuY29udGV4dCksICEwOyBjYXNlIDI6IHJldHVybiBsLmZuLmNhbGwobC5jb250ZXh0LCB0KSwgITA7IGNhc2UgMzogcmV0dXJuIGwuZm4uY2FsbChsLmNvbnRleHQsIHQsIG4pLCAhMDsgY2FzZSA0OiByZXR1cm4gbC5mbi5jYWxsKGwuY29udGV4dCwgdCwgbiwgciksICEwOyBjYXNlIDU6IHJldHVybiBsLmZuLmNhbGwobC5jb250ZXh0LCB0LCBuLCByLCBpKSwgITA7IGNhc2UgNjogcmV0dXJuIGwuZm4uY2FsbChsLmNvbnRleHQsIHQsIG4sIHIsIGksIG8pLCAhMCB9Zm9yIChjID0gMSwgYSA9IEFycmF5KHAgLSAxKTsgYyA8IHA7IGMrKylhW2MgLSAxXSA9IGFyZ3VtZW50c1tjXTsgbC5mbi5hcHBseShsLmNvbnRleHQsIGEpIH0gZWxzZSB7IHZhciBkLCBoID0gbC5sZW5ndGg7IGZvciAoYyA9IDA7IGMgPCBoOyBjKyspc3dpdGNoIChsW2NdLm9uY2UgJiYgdGhpcy5yZW1vdmVMaXN0ZW5lcihlLCBsW2NdLmZuLCB2b2lkIDAsICEwKSwgcCkgeyBjYXNlIDE6IGxbY10uZm4uY2FsbChsW2NdLmNvbnRleHQpOyBicmVhazsgY2FzZSAyOiBsW2NdLmZuLmNhbGwobFtjXS5jb250ZXh0LCB0KTsgYnJlYWs7IGNhc2UgMzogbFtjXS5mbi5jYWxsKGxbY10uY29udGV4dCwgdCwgbik7IGJyZWFrOyBjYXNlIDQ6IGxbY10uZm4uY2FsbChsW2NdLmNvbnRleHQsIHQsIG4sIHIpOyBicmVhazsgZGVmYXVsdDogaWYgKCFhKSBmb3IgKGQgPSAxLCBhID0gQXJyYXkocCAtIDEpOyBkIDwgcDsgZCsrKWFbZCAtIDFdID0gYXJndW1lbnRzW2RdOyBsW2NdLmZuLmFwcGx5KGxbY10uY29udGV4dCwgYSkgfSB9IHJldHVybiAhMCB9LCBlVS5wcm90b3R5cGUub24gPSBmdW5jdGlvbiAoZSwgdCwgbikgeyByZXR1cm4gZUIodGhpcywgZSwgdCwgbiwgITEpIH0sIGVVLnByb3RvdHlwZS5vbmNlID0gZnVuY3Rpb24gKGUsIHQsIG4pIHsgcmV0dXJuIGVCKHRoaXMsIGUsIHQsIG4sICEwKSB9LCBlVS5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIgPSBmdW5jdGlvbiAoZSwgdCwgbiwgcikgeyB2YXIgaSA9IGVqID8gZWogKyBlIDogZTsgaWYgKCF0aGlzLl9ldmVudHNbaV0pIHJldHVybiB0aGlzOyBpZiAoIXQpIHJldHVybiBlRih0aGlzLCBpKSwgdGhpczsgdmFyIG8gPSB0aGlzLl9ldmVudHNbaV07IGlmIChvLmZuKSBvLmZuICE9PSB0IHx8IHIgJiYgIW8ub25jZSB8fCBuICYmIG8uY29udGV4dCAhPT0gbiB8fCBlRih0aGlzLCBpKTsgZWxzZSB7IGZvciAodmFyIHMgPSAwLCBhID0gW10sIGMgPSBvLmxlbmd0aDsgcyA8IGM7IHMrKykob1tzXS5mbiAhPT0gdCB8fCByICYmICFvW3NdLm9uY2UgfHwgbiAmJiBvW3NdLmNvbnRleHQgIT09IG4pICYmIGEucHVzaChvW3NdKTsgYS5sZW5ndGggPyB0aGlzLl9ldmVudHNbaV0gPSAxID09PSBhLmxlbmd0aCA/IGFbMF0gOiBhIDogZUYodGhpcywgaSkgfSByZXR1cm4gdGhpcyB9LCBlVS5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzID0gZnVuY3Rpb24gKGUpIHsgdmFyIHQ7IHJldHVybiBlID8gKHQgPSBlaiA/IGVqICsgZSA6IGUsIHRoaXMuX2V2ZW50c1t0XSAmJiBlRih0aGlzLCB0KSkgOiAodGhpcy5fZXZlbnRzID0gbmV3IGVMLCB0aGlzLl9ldmVudHNDb3VudCA9IDApLCB0aGlzIH0sIGVVLnByb3RvdHlwZS5vZmYgPSBlVS5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXIsIGVVLnByb3RvdHlwZS5hZGRMaXN0ZW5lciA9IGVVLnByb3RvdHlwZS5vbiwgZVUucHJlZml4ZWQgPSBlaiwgZVUuRXZlbnRFbWl0dGVyID0gZVUsIGVNID0gZVUsIChDID0gdyB8fCAodyA9IHt9KSkuRGF0YSA9ICJkYXRhIiwgQy5NZWRpYSA9ICJtZWRpYSIsIChiID0gRSB8fCAoRSA9IHt9KSkuQnJvd3NlckluY29tcGF0aWJsZSA9ICJicm93c2VyLWluY29tcGF0aWJsZSIsIGIuRGlzY29ubmVjdGVkID0gImRpc2Nvbm5lY3RlZCIsIGIuSW52YWxpZElEID0gImludmFsaWQtaWQiLCBiLkludmFsaWRLZXkgPSAiaW52YWxpZC1rZXkiLCBiLk5ldHdvcmsgPSAibmV0d29yayIsIGIuUGVlclVuYXZhaWxhYmxlID0gInBlZXItdW5hdmFpbGFibGUiLCBiLlNzbFVuYXZhaWxhYmxlID0gInNzbC11bmF2YWlsYWJsZSIsIGIuU2VydmVyRXJyb3IgPSAic2VydmVyLWVycm9yIiwgYi5Tb2NrZXRFcnJvciA9ICJzb2NrZXQtZXJyb3IiLCBiLlNvY2tldENsb3NlZCA9ICJzb2NrZXQtY2xvc2VkIiwgYi5VbmF2YWlsYWJsZUlEID0gInVuYXZhaWxhYmxlLWlkIiwgYi5XZWJSVEMgPSAid2VicnRjIiwgKHYgPSBEIHx8IChEID0ge30pKS5OZWdvdGlhdGlvbkZhaWxlZCA9ICJuZWdvdGlhdGlvbi1mYWlsZWQiLCB2LkNvbm5lY3Rpb25DbG9zZWQgPSAiY29ubmVjdGlvbi1jbG9zZWQiLCAoayA9IHggfHwgKHggPSB7fSkpLk5vdE9wZW5ZZXQgPSAibm90LW9wZW4teWV0Iiwgay5NZXNzYWdlVG9CaWcgPSAibWVzc2FnZS10b28tYmlnIiwgKFQgPSBJIHx8IChJID0ge30pKS5CaW5hcnkgPSAiYmluYXJ5IiwgVC5CaW5hcnlVVEY4ID0gImJpbmFyeS11dGY4IiwgVC5KU09OID0gImpzb24iLCBULk5vbmUgPSAicmF3IiwgKFMgPSBNIHx8IChNID0ge30pKS5NZXNzYWdlID0gIm1lc3NhZ2UiLCBTLkRpc2Nvbm5lY3RlZCA9ICJkaXNjb25uZWN0ZWQiLCBTLkVycm9yID0gImVycm9yIiwgUy5DbG9zZSA9ICJjbG9zZSIsIChSID0gTyB8fCAoTyA9IHt9KSkuSGVhcnRiZWF0ID0gIkhFQVJUQkVBVCIsIFIuQ2FuZGlkYXRlID0gIkNBTkRJREFURSIsIFIuT2ZmZXIgPSAiT0ZGRVIiLCBSLkFuc3dlciA9ICJBTlNXRVIiLCBSLk9wZW4gPSAiT1BFTiIsIFIuRXJyb3IgPSAiRVJST1IiLCBSLklkVGFrZW4gPSAiSUQtVEFLRU4iLCBSLkludmFsaWRLZXkgPSAiSU5WQUxJRC1LRVkiLCBSLkxlYXZlID0gIkxFQVZFIiwgUi5FeHBpcmUgPSAiRVhQSVJFIjsgdmFyIGV6ID0ge307IGV6ID0gSlNPTi5wYXJzZSgneyJuYW1lIjoicGVlcmpzIiwidmVyc2lvbiI6IjEuNS40Iiwia2V5d29yZHMiOlsicGVlcmpzIiwid2VicnRjIiwicDJwIiwicnRjIl0sImRlc2NyaXB0aW9uIjoiUGVlckpTIGNsaWVudCIsImhvbWVwYWdlIjoiaHR0cHM6Ly9wZWVyanMuY29tIiwiYnVncyI6eyJ1cmwiOiJodHRwczovL2dpdGh1Yi5jb20vcGVlcnMvcGVlcmpzL2lzc3VlcyJ9LCJyZXBvc2l0b3J5Ijp7InR5cGUiOiJnaXQiLCJ1cmwiOiJodHRwczovL2dpdGh1Yi5jb20vcGVlcnMvcGVlcmpzIn0sImxpY2Vuc2UiOiJNSVQiLCJjb250cmlidXRvcnMiOlsiTWljaGVsbGUgQnUgPG1pY2hlbGxlQG1pY2hlbGxlYnUuY29tPiIsImFmcm9raWNrIDxkZXZieXJ1QGdtYWlsLmNvbT4iLCJlcmljeiA8cmVhbGx5LmV6QGdtYWlsLmNvbT4iLCJKYWlybyA8a2lkYW5kY2F0QGdtYWlsLmNvbT4iLCJKb25hcyBHbG9uaW5nIDwzNDE5NDM3MCtqb25hc2dsb25pbmdAdXNlcnMubm9yZXBseS5naXRodWIuY29tPiIsIkphaXJvIENhcm8tQWNjaW5vIFZpY2lhbmEgPGphaXJvQGdhbGF4LmJlPiIsIkNhcmxvcyBDYWJhbGxlcm8gPGNhcmxvcy5jYWJhbGxlcm8uZ29uemFsZXpAZ21haWwuY29tPiIsImhjIDxoaGVlbm5ycnl5QGdtYWlsLmNvbT4iLCJNdWhhbW1hZCBBc2lmIDxjYXByaXBpb0BnbWFpbC5jb20+IiwiUHJhc2hvb25CIDxwcmFzaG9vbmJoYXR0YWNoYXJqZWVAZ21haWwuY29tPiIsIkhhcnNoIEJhcmRoYW4gTWlzaHJhIDw0NzM1MTAyNStIYXJzaENhc3BlckB1c2Vycy5ub3JlcGx5LmdpdGh1Yi5jb20+IiwiYWtvdHluc2tpIDxhbGVrc2FuZGVya290YnVyeUBnbWFpbC5jb20+IiwibG1iIDxpQGxtYi5pbz4iLCJKYWlyb29vIDxqYWlyb2Nhcm9AbXNuLmNvbT4iLCJNb3JpdHogU3TDvGNrbGVyIDxtb3JpdHouc3R1ZWNrbGVyQGdtYWlsLmNvbT4iLCJTaW1vbiA8Y3J5ZG90c25ha2VnaXRodWJAZ21haWwuY29tPiIsIkRlbmlzIEx1a292IDxkZW5pc21hc3N0ZXJzQGdtYWlsLmNvbT4iLCJQaGlsaXBwIEhhbmNrZSA8ZmlwcG9AYW5keWV0Lm5ldD4iLCJIYW5zIE9rc2VuZGFobCA8aGFuc29rc2VuZGFobEBnbWFpbC5jb20+IiwiSmVzcyA8amVzc2FjaGFuZGxlckBnbWFpbC5jb20+Iiwia2hhbmt1YW4gPGtoYW5rdWFuQGdtYWlsLmNvbT4iLCJEVU9EVksgPGt1cm1hbm92LndvcmtAZ21haWwuY29tPiIsIlhpWmhhbyA8a3dhbmcxaW1zYUBnbWFpbC5jb20+IiwiTWF0dGhpYXMgTG9ociA8bWF0dGhpYXNAbG9oci5tZT4iLCI9ZnJhbmsgdHJlZSA8PWZybmt0cmJAZ29vZ2xlbWFpbC5jb20+IiwiQW5kcmUgRWNrYXJkdCA8YWVja2FyZHRAb3V0bG9vay5jb20+IiwiQ2hyaXMgQ293YW4gPGFnZW50bWU0OUBnbWFpbC5jb20+IiwiQWxleCBDaHVldiA8YWxleEBjaHVldi5jb20+IiwiYWx4bnVsbCA8YWx4bnVsbEBlLm1haWwuZGU+IiwiWWVtZWwgSmFyZGkgPGFuZ2VsLmphcmRpQGdtYWlsLmNvbT4iLCJCZW4gUGFybmVsbCA8YmVuamFtaW5wYXJuZWxsLjk0QGdtYWlsLmNvbT4iLCJCZW5ueSBMaWNodG5lciA8YmVubmxpY2hAZ21haWwuY29tPiIsImZyZXNoZW5lZXN6IDxiaXRldHJ1ZHB1YmxpY0BnbWFpbC5jb20+IiwiYm9iLmJhcnN0ZWFkQGV4YXB0aXZlLmNvbSA8Ym9iLmJhcnN0ZWFkQGV4YXB0aXZlLmNvbT4iLCJjaGFuZGlrYSA8Y2hhbmRpa2FAZ21haWwuY29tPiIsImVtZXJzaW9uIDxjb250YWN0QGVtZXJzaW9uLmZyPiIsIkNocmlzdG9waGVyIFZhbiA8Y3ZhbkB1c2Vycy5ub3JlcGx5LmdpdGh1Yi5jb20+IiwiZWRkaWVoZXJtIDxlZGhlcm1vc29AZ21haWwuY29tPiIsIkVkdWFyZG8gUGluaG8gPGVuZXQ0bWlrZWVuZXRAZ21haWwuY29tPiIsIkV2YW5kcm8gWmFuYXR0YSA8ZXphbmF0dGFAdHJheS5uZXQuYnI+IiwiR2FyZG5lciBCaWNrZm9yZCA8Z2FyZG5lckB1c2Vycy5ub3JlcGx5LmdpdGh1Yi5jb20+IiwiR2lhbiBMdWNhIDxnaWFubHVjYS5jZWNjaGlAY3lubnkuY29tPiIsIlBhdHJpY2tKUyA8Z2l0aHViQGdkaTIyOTAuY29tPiIsImpvbm55ZiA8Z2l0aHViQGpvbmF0aGFuZm9zcy5jby51az4iLCJIaXpraWEgRmVsaXggPGhpemtpZndAZ21haWwuY29tPiIsIkhyaXN0byBPc2tvdiA8aHJpc3RvLm9za292QGdtYWlsLmNvbT4iLCJJc2FhYyBNYWR3ZWQgPGkubWFkd2VkQGdtYWlsLmNvbT4iLCJJbHlhIEtvbmFueWtoaW4gPGlseWEua29uYW55a2hpbkBnbWFpbC5jb20+IiwiamFzb25iYXJyeSA8amFzYmFycnlAbWUuY29tPiIsIkpvbmF0aGFuIEJ1cmtlIDxqb25hdGhhbi5idXJrZS4xMzExQGdvb2dsZW1haWwuY29tPiIsIkpvc2ggSGFtaXQgPGpvc2guaGFtaXRAZ21haWwuY29tPiIsIkpvcmRhbiBBdXN0aW4gPGpyYXg4NkBnbWFpbC5jb20+IiwiSm9lbCBXZXR6ZWxsIDxqd2V0emVsbEB5YWhvby5jb20+IiwieGl6aGFvIDxrZXZpbi53YW5nQGNsb3VkZXJhLmNvbT4iLCJBbGJlcnRvIFRvcnJlcyA8a3VuZ2Zvb2JhckBnbWFpbC5jb20+IiwiSm9uYXRoYW4gTWF5b2wgPG1heW9sam9uYXRoYW5AZ21haWwuY29tPiIsIkplZmZlcnNvbiBGZWxpeCA8bWVAanNmZWxpeC5kZXY+IiwiUm9sZiBFcmlrIExla2FuZyA8bWVAcm9sZmxla2FuZy5jb20+IiwiS2V2aW4gTWFpLUh1c2FuIENoaWEgPG1oY2hpYUB1c2Vycy5ub3JlcGx5LmdpdGh1Yi5jb20+IiwiUGVwaWpuIGRlIFZvcyA8cGVwaWpuZGV2b3NAZ21haWwuY29tPiIsIkpvb1lvdW5nIDxxa2RscWxAbmF2ZXIuY29tPiIsIlRvYmlhcyBTcGVpY2hlciA8cm9vdGNvbW1hbmRlckBnbWFpbC5jb20+IiwiU3RldmUgQmxhdXJvY2sgPHNibGF1cm9ja0BnbWFpbC5jb20+IiwiS3lyeWxvIFNoZWdlZGEgPHNoZWdlZGFAdWFsYmVydGEuY2E+IiwiRGl3YW5rIFNpbmdoIFRvbWVyIDxzaW5naEBkaXdhbmsubmFtZT4iLCJTb8yIcmVuIEJhbGtvIDxTb2VyZW4uQmFsa29AZ21haWwuY29tPiIsIkFycGl0IFNvbGFua2kgPHNvbGFua2lhcnBpdDE5OTdAZ21haWwuY29tPiIsIll1a2kgSXRvIDx5dWtpQGdubmsubmV0PiIsIkFydHVyIFpheWF0cyA8emFnMmFydEBnbWFpbC5jb20+Il0sImZ1bmRpbmciOnsidHlwZSI6Im9wZW5jb2xsZWN0aXZlIiwidXJsIjoiaHR0cHM6Ly9vcGVuY29sbGVjdGl2ZS5jb20vcGVlciJ9LCJjb2xsZWN0aXZlIjp7InR5cGUiOiJvcGVuY29sbGVjdGl2ZSIsInVybCI6Imh0dHBzOi8vb3BlbmNvbGxlY3RpdmUuY29tL3BlZXIifSwiZmlsZXMiOlsiZGlzdC8qIl0sInNpZGVFZmZlY3RzIjpbImxpYi9nbG9iYWwudHMiLCJsaWIvc3VwcG9ydHMudHMiXSwibWFpbiI6ImRpc3QvYnVuZGxlci5janMiLCJtb2R1bGUiOiJkaXN0L2J1bmRsZXIubWpzIiwiYnJvd3Nlci1taW5pZmllZCI6ImRpc3QvcGVlcmpzLm1pbi5qcyIsImJyb3dzZXItdW5taW5pZmllZCI6ImRpc3QvcGVlcmpzLmpzIiwiYnJvd3Nlci1taW5pZmllZC1tc2dwYWNrIjoiZGlzdC9zZXJpYWxpemVyLm1zZ3BhY2subWpzIiwidHlwZXMiOiJkaXN0L3R5cGVzLmQudHMiLCJlbmdpbmVzIjp7Im5vZGUiOiI+PSAxNCJ9LCJ0YXJnZXRzIjp7InR5cGVzIjp7InNvdXJjZSI6ImxpYi9leHBvcnRzLnRzIn0sIm1haW4iOnsic291cmNlIjoibGliL2V4cG9ydHMudHMiLCJzb3VyY2VNYXAiOnsiaW5saW5lU291cmNlcyI6dHJ1ZX19LCJtb2R1bGUiOnsic291cmNlIjoibGliL2V4cG9ydHMudHMiLCJpbmNsdWRlTm9kZU1vZHVsZXMiOlsiZXZlbnRlbWl0dGVyMyJdLCJzb3VyY2VNYXAiOnsiaW5saW5lU291cmNlcyI6dHJ1ZX19LCJicm93c2VyLW1pbmlmaWVkIjp7ImNvbnRleHQiOiJicm93c2VyIiwib3V0cHV0Rm9ybWF0IjoiZ2xvYmFsIiwib3B0aW1pemUiOnRydWUsImVuZ2luZXMiOnsiYnJvd3NlcnMiOiJjaHJvbWUgPj0gODMsIGVkZ2UgPj0gODMsIGZpcmVmb3ggPj0gODAsIHNhZmFyaSA+PSAxNSJ9LCJzb3VyY2UiOiJsaWIvZ2xvYmFsLnRzIn0sImJyb3dzZXItdW5taW5pZmllZCI6eyJjb250ZXh0IjoiYnJvd3NlciIsIm91dHB1dEZvcm1hdCI6Imdsb2JhbCIsIm9wdGltaXplIjpmYWxzZSwiZW5naW5lcyI6eyJicm93c2VycyI6ImNocm9tZSA+PSA4MywgZWRnZSA+PSA4MywgZmlyZWZveCA+PSA4MCwgc2FmYXJpID49IDE1In0sInNvdXJjZSI6ImxpYi9nbG9iYWwudHMifSwiYnJvd3Nlci1taW5pZmllZC1tc2dwYWNrIjp7ImNvbnRleHQiOiJicm93c2VyIiwib3V0cHV0Rm9ybWF0IjoiZXNtb2R1bGUiLCJpc0xpYnJhcnkiOnRydWUsIm9wdGltaXplIjp0cnVlLCJlbmdpbmVzIjp7ImJyb3dzZXJzIjoiY2hyb21lID49IDgzLCBlZGdlID49IDgzLCBmaXJlZm94ID49IDEwMiwgc2FmYXJpID49IDE1In0sInNvdXJjZSI6ImxpYi9kYXRhY29ubmVjdGlvbi9TdHJlYW1Db25uZWN0aW9uL01zZ1BhY2sudHMifX0sInNjcmlwdHMiOnsiY29udHJpYnV0b3JzIjoiZ2l0LWF1dGhvcnMtY2xpIC0tcHJpbnQ9ZmFsc2UgJiYgcHJldHRpZXIgLS13cml0ZSBwYWNrYWdlLmpzb24gJiYgZ2l0IGFkZCBwYWNrYWdlLmpzb24gcGFja2FnZS1sb2NrLmpzb24gJiYgZ2l0IGNvbW1pdCAtbSBcXCJjaG9yZShjb250cmlidXRvcnMpOiB1cGRhdGUgYW5kIHNvcnQgY29udHJpYnV0b3JzIGxpc3RcXCIiLCJjaGVjayI6InRzYyAtLW5vRW1pdCAmJiB0c2MgLXAgZTJlL3RzY29uZmlnLmpzb24gLS1ub0VtaXQiLCJ3YXRjaCI6InBhcmNlbCB3YXRjaCIsImJ1aWxkIjoicm0gLXJmIGRpc3QgJiYgcGFyY2VsIGJ1aWxkIiwicHJlcHVibGlzaE9ubHkiOiJucG0gcnVuIGJ1aWxkIiwidGVzdCI6Implc3QiLCJ0ZXN0OndhdGNoIjoiamVzdCAtLXdhdGNoIiwiY292ZXJhZ2UiOiJqZXN0IC0tY292ZXJhZ2UgLS1jb2xsZWN0Q292ZXJhZ2VGcm9tPVxcIi4vbGliLyoqXFwiIiwiZm9ybWF0IjoicHJldHRpZXIgLS13cml0ZSAuIiwiZm9ybWF0OmNoZWNrIjoicHJldHRpZXIgLS1jaGVjayAuIiwic2VtYW50aWMtcmVsZWFzZSI6InNlbWFudGljLXJlbGVhc2UiLCJlMmUiOiJ3ZGlvIHJ1biBlMmUvd2Rpby5sb2NhbC5jb25mLnRzIiwiZTJlOmJzdGFjayI6IndkaW8gcnVuIGUyZS93ZGlvLmJzdGFjay5jb25mLnRzIn0sImRldkRlcGVuZGVuY2llcyI6eyJAcGFyY2VsL2NvbmZpZy1kZWZhdWx0IjoiXjIuOS4zIiwiQHBhcmNlbC9wYWNrYWdlci10cyI6Il4yLjkuMyIsIkBwYXJjZWwvdHJhbnNmb3JtZXItdHlwZXNjcmlwdC10c2MiOiJeMi45LjMiLCJAcGFyY2VsL3RyYW5zZm9ybWVyLXR5cGVzY3JpcHQtdHlwZXMiOiJeMi45LjMiLCJAc2VtYW50aWMtcmVsZWFzZS9jaGFuZ2Vsb2ciOiJeNi4wLjEiLCJAc2VtYW50aWMtcmVsZWFzZS9naXQiOiJeMTAuMC4xIiwiQHN3Yy9jb3JlIjoiXjEuMy4yNyIsIkBzd2MvamVzdCI6Il4wLjIuMjQiLCJAdHlwZXMvamFzbWluZSI6Il40LjMuNCIsIkB3ZGlvL2Jyb3dzZXJzdGFjay1zZXJ2aWNlIjoiXjguMTEuMiIsIkB3ZGlvL2NsaSI6Il44LjExLjIiLCJAd2Rpby9nbG9iYWxzIjoiXjguMTEuMiIsIkB3ZGlvL2phc21pbmUtZnJhbWV3b3JrIjoiXjguMTEuMiIsIkB3ZGlvL2xvY2FsLXJ1bm5lciI6Il44LjExLjIiLCJAd2Rpby9zcGVjLXJlcG9ydGVyIjoiXjguMTEuMiIsIkB3ZGlvL3R5cGVzIjoiXjguMTAuNCIsImh0dHAtc2VydmVyIjoiXjE0LjEuMSIsImplc3QiOiJeMjkuMy4xIiwiamVzdC1lbnZpcm9ubWVudC1qc2RvbSI6Il4yOS4zLjEiLCJtb2NrLXNvY2tldCI6Il45LjAuMCIsInBhcmNlbCI6Il4yLjkuMyIsInByZXR0aWVyIjoiXjMuMC4wIiwic2VtYW50aWMtcmVsZWFzZSI6Il4yMS4wLjAiLCJ0cy1ub2RlIjoiXjEwLjkuMSIsInR5cGVzY3JpcHQiOiJeNS4wLjAiLCJ3ZGlvLWdlY2tvZHJpdmVyLXNlcnZpY2UiOiJeNS4wLjEifSwiZGVwZW5kZW5jaWVzIjp7IkBtc2dwYWNrL21zZ3BhY2siOiJeMi44LjAiLCJldmVudGVtaXR0ZXIzIjoiXjQuMC43IiwicGVlcmpzLWpzLWJpbmFyeXBhY2siOiJeMi4xLjAiLCJ3ZWJydGMtYWRhcHRlciI6Il45LjAuMCJ9LCJhbGlhcyI6eyJwcm9jZXNzIjpmYWxzZSwiYnVmZmVyIjpmYWxzZX19Jyk7IGNsYXNzIGVOIGV4dGVuZHMgZU0uRXZlbnRFbWl0dGVyIHsgc3RhcnQoZSwgdCkgeyB0aGlzLl9pZCA9IGU7IGxldCBuID0gYCR7dGhpcy5fYmFzZVVybH0maWQ9JHtlfSZ0b2tlbj0ke3R9YDsgIXRoaXMuX3NvY2tldCAmJiB0aGlzLl9kaXNjb25uZWN0ZWQgJiYgKHRoaXMuX3NvY2tldCA9IG5ldyBXZWJTb2NrZXQobiArICImdmVyc2lvbj0iICsgZXoudmVyc2lvbiksIHRoaXMuX2Rpc2Nvbm5lY3RlZCA9ICExLCB0aGlzLl9zb2NrZXQub25tZXNzYWdlID0gZSA9PiB7IGxldCB0OyB0cnkgeyB0ID0gSlNPTi5wYXJzZShlLmRhdGEpLCBlSS5sb2coIlNlcnZlciBtZXNzYWdlIHJlY2VpdmVkOiIsIHQpIH0gY2F0Y2ggKHQpIHsgZUkubG9nKCJJbnZhbGlkIHNlcnZlciBtZXNzYWdlIiwgZS5kYXRhKTsgcmV0dXJuIH0gdGhpcy5lbWl0KE0uTWVzc2FnZSwgdCkgfSwgdGhpcy5fc29ja2V0Lm9uY2xvc2UgPSBlID0+IHsgdGhpcy5fZGlzY29ubmVjdGVkIHx8IChlSS5sb2coIlNvY2tldCBjbG9zZWQuIiwgZSksIHRoaXMuX2NsZWFudXAoKSwgdGhpcy5fZGlzY29ubmVjdGVkID0gITAsIHRoaXMuZW1pdChNLkRpc2Nvbm5lY3RlZCkpIH0sIHRoaXMuX3NvY2tldC5vbm9wZW4gPSAoKSA9PiB7IHRoaXMuX2Rpc2Nvbm5lY3RlZCB8fCAodGhpcy5fc2VuZFF1ZXVlZE1lc3NhZ2VzKCksIGVJLmxvZygiU29ja2V0IG9wZW4iKSwgdGhpcy5fc2NoZWR1bGVIZWFydGJlYXQoKSkgfSkgfSBfc2NoZWR1bGVIZWFydGJlYXQoKSB7IHRoaXMuX3dzUGluZ1RpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7IHRoaXMuX3NlbmRIZWFydGJlYXQoKSB9LCB0aGlzLnBpbmdJbnRlcnZhbCkgfSBfc2VuZEhlYXJ0YmVhdCgpIHsgaWYgKCF0aGlzLl93c09wZW4oKSkgeyBlSS5sb2coIkNhbm5vdCBzZW5kIGhlYXJ0YmVhdCwgYmVjYXVzZSBzb2NrZXQgY2xvc2VkIik7IHJldHVybiB9IGxldCBlID0gSlNPTi5zdHJpbmdpZnkoeyB0eXBlOiBPLkhlYXJ0YmVhdCB9KTsgdGhpcy5fc29ja2V0LnNlbmQoZSksIHRoaXMuX3NjaGVkdWxlSGVhcnRiZWF0KCkgfSBfd3NPcGVuKCkgeyByZXR1cm4gISF0aGlzLl9zb2NrZXQgJiYgMSA9PT0gdGhpcy5fc29ja2V0LnJlYWR5U3RhdGUgfSBfc2VuZFF1ZXVlZE1lc3NhZ2VzKCkgeyBsZXQgZSA9IFsuLi50aGlzLl9tZXNzYWdlc1F1ZXVlXTsgZm9yIChsZXQgdCBvZiAodGhpcy5fbWVzc2FnZXNRdWV1ZSA9IFtdLCBlKSkgdGhpcy5zZW5kKHQpIH0gc2VuZChlKSB7IGlmICh0aGlzLl9kaXNjb25uZWN0ZWQpIHJldHVybjsgaWYgKCF0aGlzLl9pZCkgeyB0aGlzLl9tZXNzYWdlc1F1ZXVlLnB1c2goZSk7IHJldHVybiB9IGlmICghZS50eXBlKSB7IHRoaXMuZW1pdChNLkVycm9yLCAiSW52YWxpZCBtZXNzYWdlIik7IHJldHVybiB9IGlmICghdGhpcy5fd3NPcGVuKCkpIHJldHVybjsgbGV0IHQgPSBKU09OLnN0cmluZ2lmeShlKTsgdGhpcy5fc29ja2V0LnNlbmQodCkgfSBjbG9zZSgpIHsgdGhpcy5fZGlzY29ubmVjdGVkIHx8ICh0aGlzLl9jbGVhbnVwKCksIHRoaXMuX2Rpc2Nvbm5lY3RlZCA9ICEwKSB9IF9jbGVhbnVwKCkgeyB0aGlzLl9zb2NrZXQgJiYgKHRoaXMuX3NvY2tldC5vbm9wZW4gPSB0aGlzLl9zb2NrZXQub25tZXNzYWdlID0gdGhpcy5fc29ja2V0Lm9uY2xvc2UgPSBudWxsLCB0aGlzLl9zb2NrZXQuY2xvc2UoKSwgdGhpcy5fc29ja2V0ID0gdm9pZCAwKSwgY2xlYXJUaW1lb3V0KHRoaXMuX3dzUGluZ1RpbWVyKSB9IGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGksIG8gPSA1ZTMpIHsgc3VwZXIoKSwgdGhpcy5waW5nSW50ZXJ2YWwgPSBvLCB0aGlzLl9kaXNjb25uZWN0ZWQgPSAhMCwgdGhpcy5fbWVzc2FnZXNRdWV1ZSA9IFtdLCB0aGlzLl9iYXNlVXJsID0gKGUgPyAid3NzOi8vIiA6ICJ3czovLyIpICsgdCArICI6IiArIG4gKyByICsgInBlZXJqcz9rZXk9IiArIGkgfSB9IGNsYXNzIGUkIHsgc3RhcnRDb25uZWN0aW9uKGUpIHsgbGV0IHQgPSB0aGlzLl9zdGFydFBlZXJDb25uZWN0aW9uKCk7IGlmICh0aGlzLmNvbm5lY3Rpb24ucGVlckNvbm5lY3Rpb24gPSB0LCB0aGlzLmNvbm5lY3Rpb24udHlwZSA9PT0gdy5NZWRpYSAmJiBlLl9zdHJlYW0gJiYgdGhpcy5fYWRkVHJhY2tzVG9Db25uZWN0aW9uKGUuX3N0cmVhbSwgdCksIGUub3JpZ2luYXRvcikgeyBsZXQgbiA9IHRoaXMuY29ubmVjdGlvbiwgciA9IHsgb3JkZXJlZDogISFlLnJlbGlhYmxlIH0sIGkgPSB0LmNyZWF0ZURhdGFDaGFubmVsKG4ubGFiZWwsIHIpOyBuLl9pbml0aWFsaXplRGF0YUNoYW5uZWwoaSksIHRoaXMuX21ha2VPZmZlcigpIH0gZWxzZSB0aGlzLmhhbmRsZVNEUCgiT0ZGRVIiLCBlLnNkcCkgfSBfc3RhcnRQZWVyQ29ubmVjdGlvbigpIHsgZUkubG9nKCJDcmVhdGluZyBSVENQZWVyQ29ubmVjdGlvbi4iKTsgbGV0IGUgPSBuZXcgUlRDUGVlckNvbm5lY3Rpb24odGhpcy5jb25uZWN0aW9uLnByb3ZpZGVyLm9wdGlvbnMuY29uZmlnKTsgcmV0dXJuIHRoaXMuX3NldHVwTGlzdGVuZXJzKGUpLCBlIH0gX3NldHVwTGlzdGVuZXJzKGUpIHsgbGV0IHQgPSB0aGlzLmNvbm5lY3Rpb24ucGVlciwgbiA9IHRoaXMuY29ubmVjdGlvbi5jb25uZWN0aW9uSWQsIHIgPSB0aGlzLmNvbm5lY3Rpb24udHlwZSwgaSA9IHRoaXMuY29ubmVjdGlvbi5wcm92aWRlcjsgZUkubG9nKCJMaXN0ZW5pbmcgZm9yIElDRSBjYW5kaWRhdGVzLiIpLCBlLm9uaWNlY2FuZGlkYXRlID0gZSA9PiB7IGUuY2FuZGlkYXRlICYmIGUuY2FuZGlkYXRlLmNhbmRpZGF0ZSAmJiAoZUkubG9nKGBSZWNlaXZlZCBJQ0UgY2FuZGlkYXRlcyBmb3IgJHt0fTpgLCBlLmNhbmRpZGF0ZSksIGkuc29ja2V0LnNlbmQoeyB0eXBlOiBPLkNhbmRpZGF0ZSwgcGF5bG9hZDogeyBjYW5kaWRhdGU6IGUuY2FuZGlkYXRlLCB0eXBlOiByLCBjb25uZWN0aW9uSWQ6IG4gfSwgZHN0OiB0IH0pKSB9LCBlLm9uaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlID0gKCkgPT4geyBzd2l0Y2ggKGUuaWNlQ29ubmVjdGlvblN0YXRlKSB7IGNhc2UgImZhaWxlZCI6IGVJLmxvZygiaWNlQ29ubmVjdGlvblN0YXRlIGlzIGZhaWxlZCwgY2xvc2luZyBjb25uZWN0aW9ucyB0byAiICsgdCksIHRoaXMuY29ubmVjdGlvbi5lbWl0RXJyb3IoRC5OZWdvdGlhdGlvbkZhaWxlZCwgIk5lZ290aWF0aW9uIG9mIGNvbm5lY3Rpb24gdG8gIiArIHQgKyAiIGZhaWxlZC4iKSwgdGhpcy5jb25uZWN0aW9uLmNsb3NlKCk7IGJyZWFrOyBjYXNlICJjbG9zZWQiOiBlSS5sb2coImljZUNvbm5lY3Rpb25TdGF0ZSBpcyBjbG9zZWQsIGNsb3NpbmcgY29ubmVjdGlvbnMgdG8gIiArIHQpLCB0aGlzLmNvbm5lY3Rpb24uZW1pdEVycm9yKEQuQ29ubmVjdGlvbkNsb3NlZCwgIkNvbm5lY3Rpb24gdG8gIiArIHQgKyAiIGNsb3NlZC4iKSwgdGhpcy5jb25uZWN0aW9uLmNsb3NlKCk7IGJyZWFrOyBjYXNlICJkaXNjb25uZWN0ZWQiOiBlSS5sb2coImljZUNvbm5lY3Rpb25TdGF0ZSBjaGFuZ2VkIHRvIGRpc2Nvbm5lY3RlZCBvbiB0aGUgY29ubmVjdGlvbiB3aXRoICIgKyB0KTsgYnJlYWs7IGNhc2UgImNvbXBsZXRlZCI6IGUub25pY2VjYW5kaWRhdGUgPSAoKSA9PiB7IH0gfXRoaXMuY29ubmVjdGlvbi5lbWl0KCJpY2VTdGF0ZUNoYW5nZWQiLCBlLmljZUNvbm5lY3Rpb25TdGF0ZSkgfSwgZUkubG9nKCJMaXN0ZW5pbmcgZm9yIGRhdGEgY2hhbm5lbCIpLCBlLm9uZGF0YWNoYW5uZWwgPSBlID0+IHsgZUkubG9nKCJSZWNlaXZlZCBkYXRhIGNoYW5uZWwiKTsgbGV0IHIgPSBlLmNoYW5uZWw7IGkuZ2V0Q29ubmVjdGlvbih0LCBuKS5faW5pdGlhbGl6ZURhdGFDaGFubmVsKHIpIH0sIGVJLmxvZygiTGlzdGVuaW5nIGZvciByZW1vdGUgc3RyZWFtIiksIGUub250cmFjayA9IGUgPT4geyBlSS5sb2coIlJlY2VpdmVkIHJlbW90ZSBzdHJlYW0iKTsgbGV0IHIgPSBlLnN0cmVhbXNbMF0sIG8gPSBpLmdldENvbm5lY3Rpb24odCwgbik7IG8udHlwZSA9PT0gdy5NZWRpYSAmJiB0aGlzLl9hZGRTdHJlYW1Ub01lZGlhQ29ubmVjdGlvbihyLCBvKSB9IH0gY2xlYW51cCgpIHsgZUkubG9nKCJDbGVhbmluZyB1cCBQZWVyQ29ubmVjdGlvbiB0byAiICsgdGhpcy5jb25uZWN0aW9uLnBlZXIpOyBsZXQgZSA9IHRoaXMuY29ubmVjdGlvbi5wZWVyQ29ubmVjdGlvbjsgaWYgKCFlKSByZXR1cm47IHRoaXMuY29ubmVjdGlvbi5wZWVyQ29ubmVjdGlvbiA9IG51bGwsIGUub25pY2VjYW5kaWRhdGUgPSBlLm9uaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlID0gZS5vbmRhdGFjaGFubmVsID0gZS5vbnRyYWNrID0gKCkgPT4geyB9OyBsZXQgdCA9ICJjbG9zZWQiICE9PSBlLnNpZ25hbGluZ1N0YXRlLCBuID0gITEsIHIgPSB0aGlzLmNvbm5lY3Rpb24uZGF0YUNoYW5uZWw7IHIgJiYgKG4gPSAhIXIucmVhZHlTdGF0ZSAmJiAiY2xvc2VkIiAhPT0gci5yZWFkeVN0YXRlKSwgKHQgfHwgbikgJiYgZS5jbG9zZSgpIH0gYXN5bmMgX21ha2VPZmZlcigpIHsgbGV0IGUgPSB0aGlzLmNvbm5lY3Rpb24ucGVlckNvbm5lY3Rpb24sIHQgPSB0aGlzLmNvbm5lY3Rpb24ucHJvdmlkZXI7IHRyeSB7IGxldCBuID0gYXdhaXQgZS5jcmVhdGVPZmZlcih0aGlzLmNvbm5lY3Rpb24ub3B0aW9ucy5jb25zdHJhaW50cyk7IGVJLmxvZygiQ3JlYXRlZCBvZmZlci4iKSwgdGhpcy5jb25uZWN0aW9uLm9wdGlvbnMuc2RwVHJhbnNmb3JtICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIHRoaXMuY29ubmVjdGlvbi5vcHRpb25zLnNkcFRyYW5zZm9ybSAmJiAobi5zZHAgPSB0aGlzLmNvbm5lY3Rpb24ub3B0aW9ucy5zZHBUcmFuc2Zvcm0obi5zZHApIHx8IG4uc2RwKTsgdHJ5IHsgYXdhaXQgZS5zZXRMb2NhbERlc2NyaXB0aW9uKG4pLCBlSS5sb2coIlNldCBsb2NhbERlc2NyaXB0aW9uOiIsIG4sIGBmb3I6JHt0aGlzLmNvbm5lY3Rpb24ucGVlcn1gKTsgbGV0IHIgPSB7IHNkcDogbiwgdHlwZTogdGhpcy5jb25uZWN0aW9uLnR5cGUsIGNvbm5lY3Rpb25JZDogdGhpcy5jb25uZWN0aW9uLmNvbm5lY3Rpb25JZCwgbWV0YWRhdGE6IHRoaXMuY29ubmVjdGlvbi5tZXRhZGF0YSB9OyBpZiAodGhpcy5jb25uZWN0aW9uLnR5cGUgPT09IHcuRGF0YSkgeyBsZXQgZSA9IHRoaXMuY29ubmVjdGlvbjsgciA9IHsgLi4uciwgbGFiZWw6IGUubGFiZWwsIHJlbGlhYmxlOiBlLnJlbGlhYmxlLCBzZXJpYWxpemF0aW9uOiBlLnNlcmlhbGl6YXRpb24gfSB9IHQuc29ja2V0LnNlbmQoeyB0eXBlOiBPLk9mZmVyLCBwYXlsb2FkOiByLCBkc3Q6IHRoaXMuY29ubmVjdGlvbi5wZWVyIH0pIH0gY2F0Y2ggKGUpIHsgIk9wZXJhdGlvbkVycm9yOiBGYWlsZWQgdG8gc2V0IGxvY2FsIG9mZmVyIHNkcDogQ2FsbGVkIGluIHdyb25nIHN0YXRlOiBrSGF2ZVJlbW90ZU9mZmVyIiAhPSBlICYmICh0LmVtaXRFcnJvcihFLldlYlJUQywgZSksIGVJLmxvZygiRmFpbGVkIHRvIHNldExvY2FsRGVzY3JpcHRpb24sICIsIGUpKSB9IH0gY2F0Y2ggKGUpIHsgdC5lbWl0RXJyb3IoRS5XZWJSVEMsIGUpLCBlSS5sb2coIkZhaWxlZCB0byBjcmVhdGVPZmZlciwgIiwgZSkgfSB9IGFzeW5jIF9tYWtlQW5zd2VyKCkgeyBsZXQgZSA9IHRoaXMuY29ubmVjdGlvbi5wZWVyQ29ubmVjdGlvbiwgdCA9IHRoaXMuY29ubmVjdGlvbi5wcm92aWRlcjsgdHJ5IHsgbGV0IG4gPSBhd2FpdCBlLmNyZWF0ZUFuc3dlcigpOyBlSS5sb2coIkNyZWF0ZWQgYW5zd2VyLiIpLCB0aGlzLmNvbm5lY3Rpb24ub3B0aW9ucy5zZHBUcmFuc2Zvcm0gJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgdGhpcy5jb25uZWN0aW9uLm9wdGlvbnMuc2RwVHJhbnNmb3JtICYmIChuLnNkcCA9IHRoaXMuY29ubmVjdGlvbi5vcHRpb25zLnNkcFRyYW5zZm9ybShuLnNkcCkgfHwgbi5zZHApOyB0cnkgeyBhd2FpdCBlLnNldExvY2FsRGVzY3JpcHRpb24obiksIGVJLmxvZygiU2V0IGxvY2FsRGVzY3JpcHRpb246IiwgbiwgYGZvcjoke3RoaXMuY29ubmVjdGlvbi5wZWVyfWApLCB0LnNvY2tldC5zZW5kKHsgdHlwZTogTy5BbnN3ZXIsIHBheWxvYWQ6IHsgc2RwOiBuLCB0eXBlOiB0aGlzLmNvbm5lY3Rpb24udHlwZSwgY29ubmVjdGlvbklkOiB0aGlzLmNvbm5lY3Rpb24uY29ubmVjdGlvbklkIH0sIGRzdDogdGhpcy5jb25uZWN0aW9uLnBlZXIgfSkgfSBjYXRjaCAoZSkgeyB0LmVtaXRFcnJvcihFLldlYlJUQywgZSksIGVJLmxvZygiRmFpbGVkIHRvIHNldExvY2FsRGVzY3JpcHRpb24sICIsIGUpIH0gfSBjYXRjaCAoZSkgeyB0LmVtaXRFcnJvcihFLldlYlJUQywgZSksIGVJLmxvZygiRmFpbGVkIHRvIGNyZWF0ZSBhbnN3ZXIsICIsIGUpIH0gfSBhc3luYyBoYW5kbGVTRFAoZSwgdCkgeyB0ID0gbmV3IFJUQ1Nlc3Npb25EZXNjcmlwdGlvbih0KTsgbGV0IG4gPSB0aGlzLmNvbm5lY3Rpb24ucGVlckNvbm5lY3Rpb24sIHIgPSB0aGlzLmNvbm5lY3Rpb24ucHJvdmlkZXI7IGVJLmxvZygiU2V0dGluZyByZW1vdGUgZGVzY3JpcHRpb24iLCB0KTsgdHJ5IHsgYXdhaXQgbi5zZXRSZW1vdGVEZXNjcmlwdGlvbih0KSwgZUkubG9nKGBTZXQgcmVtb3RlRGVzY3JpcHRpb246JHtlfSBmb3I6JHt0aGlzLmNvbm5lY3Rpb24ucGVlcn1gKSwgIk9GRkVSIiA9PT0gZSAmJiBhd2FpdCB0aGlzLl9tYWtlQW5zd2VyKCkgfSBjYXRjaCAoZSkgeyByLmVtaXRFcnJvcihFLldlYlJUQywgZSksIGVJLmxvZygiRmFpbGVkIHRvIHNldFJlbW90ZURlc2NyaXB0aW9uLCAiLCBlKSB9IH0gYXN5bmMgaGFuZGxlQ2FuZGlkYXRlKGUpIHsgZUkubG9nKCJoYW5kbGVDYW5kaWRhdGU6IiwgZSk7IHRyeSB7IGF3YWl0IHRoaXMuY29ubmVjdGlvbi5wZWVyQ29ubmVjdGlvbi5hZGRJY2VDYW5kaWRhdGUoZSksIGVJLmxvZyhgQWRkZWQgSUNFIGNhbmRpZGF0ZSBmb3I6JHt0aGlzLmNvbm5lY3Rpb24ucGVlcn1gKSB9IGNhdGNoIChlKSB7IHRoaXMuY29ubmVjdGlvbi5wcm92aWRlci5lbWl0RXJyb3IoRS5XZWJSVEMsIGUpLCBlSS5sb2coIkZhaWxlZCB0byBoYW5kbGVDYW5kaWRhdGUsICIsIGUpIH0gfSBfYWRkVHJhY2tzVG9Db25uZWN0aW9uKGUsIHQpIHsgaWYgKGVJLmxvZyhgYWRkIHRyYWNrcyBmcm9tIHN0cmVhbSAke2UuaWR9IHRvIHBlZXIgY29ubmVjdGlvbmApLCAhdC5hZGRUcmFjaykgcmV0dXJuIGVJLmVycm9yKCJZb3VyIGJyb3dzZXIgZG9lcyd0IHN1cHBvcnQgUlRDUGVlckNvbm5lY3Rpb24jYWRkVHJhY2suIElnbm9yZWQuIik7IGUuZ2V0VHJhY2tzKCkuZm9yRWFjaChuID0+IHsgdC5hZGRUcmFjayhuLCBlKSB9KSB9IF9hZGRTdHJlYW1Ub01lZGlhQ29ubmVjdGlvbihlLCB0KSB7IGVJLmxvZyhgYWRkIHN0cmVhbSAke2UuaWR9IHRvIG1lZGlhIGNvbm5lY3Rpb24gJHt0LmNvbm5lY3Rpb25JZH1gKSwgdC5hZGRTdHJlYW0oZSkgfSBjb25zdHJ1Y3RvcihlKSB7IHRoaXMuY29ubmVjdGlvbiA9IGUgfSB9IGNsYXNzIGVKIGV4dGVuZHMgZU0uRXZlbnRFbWl0dGVyIHsgZW1pdEVycm9yKGUsIHQpIHsgZUkuZXJyb3IoIkVycm9yOiIsIHQpLCB0aGlzLmVtaXQoImVycm9yIiwgbmV3IGVWKGAke2V9YCwgdCkpIH0gfSBjbGFzcyBlViBleHRlbmRzIEVycm9yIHsgY29uc3RydWN0b3IoZSwgdCkgeyAic3RyaW5nIiA9PSB0eXBlb2YgdCA/IHN1cGVyKHQpIDogKHN1cGVyKCksIE9iamVjdC5hc3NpZ24odGhpcywgdCkpLCB0aGlzLnR5cGUgPSBlIH0gfSBjbGFzcyBlRyBleHRlbmRzIGVKIHsgZ2V0IG9wZW4oKSB7IHJldHVybiB0aGlzLl9vcGVuIH0gY29uc3RydWN0b3IoZSwgdCwgbikgeyBzdXBlcigpLCB0aGlzLnBlZXIgPSBlLCB0aGlzLnByb3ZpZGVyID0gdCwgdGhpcy5vcHRpb25zID0gbiwgdGhpcy5fb3BlbiA9ICExLCB0aGlzLm1ldGFkYXRhID0gbi5tZXRhZGF0YSB9IH0gY2xhc3MgZVcgZXh0ZW5kcyBlRyB7IGdldCB0eXBlKCkgeyByZXR1cm4gdy5NZWRpYSB9IGdldCBsb2NhbFN0cmVhbSgpIHsgcmV0dXJuIHRoaXMuX2xvY2FsU3RyZWFtIH0gZ2V0IHJlbW90ZVN0cmVhbSgpIHsgcmV0dXJuIHRoaXMuX3JlbW90ZVN0cmVhbSB9IF9pbml0aWFsaXplRGF0YUNoYW5uZWwoZSkgeyB0aGlzLmRhdGFDaGFubmVsID0gZSwgdGhpcy5kYXRhQ2hhbm5lbC5vbm9wZW4gPSAoKSA9PiB7IGVJLmxvZyhgREMjJHt0aGlzLmNvbm5lY3Rpb25JZH0gZGMgY29ubmVjdGlvbiBzdWNjZXNzYCksIHRoaXMuZW1pdCgid2lsbENsb3NlT25SZW1vdGUiKSB9LCB0aGlzLmRhdGFDaGFubmVsLm9uY2xvc2UgPSAoKSA9PiB7IGVJLmxvZyhgREMjJHt0aGlzLmNvbm5lY3Rpb25JZH0gZGMgY2xvc2VkIGZvcjpgLCB0aGlzLnBlZXIpLCB0aGlzLmNsb3NlKCkgfSB9IGFkZFN0cmVhbShlKSB7IGVJLmxvZygiUmVjZWl2aW5nIHN0cmVhbSIsIGUpLCB0aGlzLl9yZW1vdGVTdHJlYW0gPSBlLCBzdXBlci5lbWl0KCJzdHJlYW0iLCBlKSB9IGhhbmRsZU1lc3NhZ2UoZSkgeyBsZXQgdCA9IGUudHlwZSwgbiA9IGUucGF5bG9hZDsgc3dpdGNoIChlLnR5cGUpIHsgY2FzZSBPLkFuc3dlcjogdGhpcy5fbmVnb3RpYXRvci5oYW5kbGVTRFAodCwgbi5zZHApLCB0aGlzLl9vcGVuID0gITA7IGJyZWFrOyBjYXNlIE8uQ2FuZGlkYXRlOiB0aGlzLl9uZWdvdGlhdG9yLmhhbmRsZUNhbmRpZGF0ZShuLmNhbmRpZGF0ZSk7IGJyZWFrOyBkZWZhdWx0OiBlSS53YXJuKGBVbnJlY29nbml6ZWQgbWVzc2FnZSB0eXBlOiR7dH0gZnJvbSBwZWVyOiR7dGhpcy5wZWVyfWApIH0gfSBhbnN3ZXIoZSwgdCA9IHt9KSB7IGlmICh0aGlzLl9sb2NhbFN0cmVhbSkgeyBlSS53YXJuKCJMb2NhbCBzdHJlYW0gYWxyZWFkeSBleGlzdHMgb24gdGhpcyBNZWRpYUNvbm5lY3Rpb24uIEFyZSB5b3UgYW5zd2VyaW5nIGEgY2FsbCB0d2ljZT8iKTsgcmV0dXJuIH0gZm9yIChsZXQgbiBvZiAodGhpcy5fbG9jYWxTdHJlYW0gPSBlLCB0ICYmIHQuc2RwVHJhbnNmb3JtICYmICh0aGlzLm9wdGlvbnMuc2RwVHJhbnNmb3JtID0gdC5zZHBUcmFuc2Zvcm0pLCB0aGlzLl9uZWdvdGlhdG9yLnN0YXJ0Q29ubmVjdGlvbih7IC4uLnRoaXMub3B0aW9ucy5fcGF5bG9hZCwgX3N0cmVhbTogZSB9KSwgdGhpcy5wcm92aWRlci5fZ2V0TWVzc2FnZXModGhpcy5jb25uZWN0aW9uSWQpKSkgdGhpcy5oYW5kbGVNZXNzYWdlKG4pOyB0aGlzLl9vcGVuID0gITAgfSBjbG9zZSgpIHsgdGhpcy5fbmVnb3RpYXRvciAmJiAodGhpcy5fbmVnb3RpYXRvci5jbGVhbnVwKCksIHRoaXMuX25lZ290aWF0b3IgPSBudWxsKSwgdGhpcy5fbG9jYWxTdHJlYW0gPSBudWxsLCB0aGlzLl9yZW1vdGVTdHJlYW0gPSBudWxsLCB0aGlzLnByb3ZpZGVyICYmICh0aGlzLnByb3ZpZGVyLl9yZW1vdmVDb25uZWN0aW9uKHRoaXMpLCB0aGlzLnByb3ZpZGVyID0gbnVsbCksIHRoaXMub3B0aW9ucyAmJiB0aGlzLm9wdGlvbnMuX3N0cmVhbSAmJiAodGhpcy5vcHRpb25zLl9zdHJlYW0gPSBudWxsKSwgdGhpcy5vcGVuICYmICh0aGlzLl9vcGVuID0gITEsIHN1cGVyLmVtaXQoImNsb3NlIikpIH0gY29uc3RydWN0b3IoZSwgdCwgbikgeyBzdXBlcihlLCB0LCBuKSwgdGhpcy5fbG9jYWxTdHJlYW0gPSB0aGlzLm9wdGlvbnMuX3N0cmVhbSwgdGhpcy5jb25uZWN0aW9uSWQgPSB0aGlzLm9wdGlvbnMuY29ubmVjdGlvbklkIHx8IGVXLklEX1BSRUZJWCArIGV4LnJhbmRvbVRva2VuKCksIHRoaXMuX25lZ290aWF0b3IgPSBuZXcgZSQodGhpcyksIHRoaXMuX2xvY2FsU3RyZWFtICYmIHRoaXMuX25lZ290aWF0b3Iuc3RhcnRDb25uZWN0aW9uKHsgX3N0cmVhbTogdGhpcy5fbG9jYWxTdHJlYW0sIG9yaWdpbmF0b3I6ICEwIH0pIH0gfSBlVy5JRF9QUkVGSVggPSAibWNfIjsgY2xhc3MgZUggeyBfYnVpbGRSZXF1ZXN0KGUpIHsgbGV0IHQgPSB0aGlzLl9vcHRpb25zLnNlY3VyZSA/ICJodHRwcyIgOiAiaHR0cCIsIHsgaG9zdDogbiwgcG9ydDogciwgcGF0aDogaSwga2V5OiBvIH0gPSB0aGlzLl9vcHRpb25zLCBzID0gbmV3IFVSTChgJHt0fTovLyR7bn06JHtyfSR7aX0ke299LyR7ZX1gKTsgcmV0dXJuIHMuc2VhcmNoUGFyYW1zLnNldCgidHMiLCBgJHtEYXRlLm5vdygpfSR7TWF0aC5yYW5kb20oKX1gKSwgcy5zZWFyY2hQYXJhbXMuc2V0KCJ2ZXJzaW9uIiwgZXoudmVyc2lvbiksIGZldGNoKHMuaHJlZiwgeyByZWZlcnJlclBvbGljeTogdGhpcy5fb3B0aW9ucy5yZWZlcnJlclBvbGljeSB9KSB9IGFzeW5jIHJldHJpZXZlSWQoKSB7IHRyeSB7IGxldCBlID0gYXdhaXQgdGhpcy5fYnVpbGRSZXF1ZXN0KCJpZCIpOyBpZiAoMjAwICE9PSBlLnN0YXR1cykgdGhyb3cgRXJyb3IoYEVycm9yLiBTdGF0dXM6JHtlLnN0YXR1c31gKTsgcmV0dXJuIGUudGV4dCgpIH0gY2F0Y2ggKHQpIHsgZUkuZXJyb3IoIkVycm9yIHJldHJpZXZpbmcgSUQiLCB0KTsgbGV0IGUgPSAiIjsgdGhyb3cgIi8iID09PSB0aGlzLl9vcHRpb25zLnBhdGggJiYgdGhpcy5fb3B0aW9ucy5ob3N0ICE9PSBleC5DTE9VRF9IT1NUICYmIChlID0gIiBJZiB5b3UgcGFzc2VkIGluIGEgYHBhdGhgIHRvIHlvdXIgc2VsZi1ob3N0ZWQgUGVlclNlcnZlciwgeW91J2xsIGFsc28gbmVlZCB0byBwYXNzIGluIHRoYXQgc2FtZSBwYXRoIHdoZW4gY3JlYXRpbmcgYSBuZXcgUGVlci4iKSwgRXJyb3IoIkNvdWxkIG5vdCBnZXQgYW4gSUQgZnJvbSB0aGUgc2VydmVyLiIgKyBlKSB9IH0gYXN5bmMgbGlzdEFsbFBlZXJzKCkgeyB0cnkgeyBsZXQgZSA9IGF3YWl0IHRoaXMuX2J1aWxkUmVxdWVzdCgicGVlcnMiKTsgaWYgKDIwMCAhPT0gZS5zdGF0dXMpIHsgaWYgKDQwMSA9PT0gZS5zdGF0dXMpIHsgbGV0IGUgPSAiIjsgdGhyb3cgZSA9IHRoaXMuX29wdGlvbnMuaG9zdCA9PT0gZXguQ0xPVURfSE9TVCA/ICJJdCBsb29rcyBsaWtlIHlvdSdyZSB1c2luZyB0aGUgY2xvdWQgc2VydmVyLiBZb3UgY2FuIGVtYWlsIHRlYW1AcGVlcmpzLmNvbSB0byBlbmFibGUgcGVlciBsaXN0aW5nIGZvciB5b3VyIEFQSSBrZXkuIiA6ICJZb3UgbmVlZCB0byBlbmFibGUgYGFsbG93X2Rpc2NvdmVyeWAgb24geW91ciBzZWxmLWhvc3RlZCBQZWVyU2VydmVyIHRvIHVzZSB0aGlzIGZlYXR1cmUuIiwgRXJyb3IoIkl0IGRvZXNuJ3QgbG9vayBsaWtlIHlvdSBoYXZlIHBlcm1pc3Npb24gdG8gbGlzdCBwZWVycyBJRHMuICIgKyBlKSB9IHRocm93IEVycm9yKGBFcnJvci4gU3RhdHVzOiR7ZS5zdGF0dXN9YCkgfSByZXR1cm4gZS5qc29uKCkgfSBjYXRjaCAoZSkgeyB0aHJvdyBlSS5lcnJvcigiRXJyb3IgcmV0cmlldmluZyBsaXN0IHBlZXJzIiwgZSksIEVycm9yKCJDb3VsZCBub3QgZ2V0IGxpc3QgcGVlcnMgZnJvbSB0aGUgc2VydmVyLiIgKyBlKSB9IH0gY29uc3RydWN0b3IoZSkgeyB0aGlzLl9vcHRpb25zID0gZSB9IH0gY2xhc3MgZVkgZXh0ZW5kcyBlRyB7IGdldCB0eXBlKCkgeyByZXR1cm4gdy5EYXRhIH0gX2luaXRpYWxpemVEYXRhQ2hhbm5lbChlKSB7IHRoaXMuZGF0YUNoYW5uZWwgPSBlLCB0aGlzLmRhdGFDaGFubmVsLm9ub3BlbiA9ICgpID0+IHsgZUkubG9nKGBEQyMke3RoaXMuY29ubmVjdGlvbklkfSBkYyBjb25uZWN0aW9uIHN1Y2Nlc3NgKSwgdGhpcy5fb3BlbiA9ICEwLCB0aGlzLmVtaXQoIm9wZW4iKSB9LCB0aGlzLmRhdGFDaGFubmVsLm9ubWVzc2FnZSA9IGUgPT4geyBlSS5sb2coYERDIyR7dGhpcy5jb25uZWN0aW9uSWR9IGRjIG9ubWVzc2FnZTpgLCBlLmRhdGEpIH0sIHRoaXMuZGF0YUNoYW5uZWwub25jbG9zZSA9ICgpID0+IHsgZUkubG9nKGBEQyMke3RoaXMuY29ubmVjdGlvbklkfSBkYyBjbG9zZWQgZm9yOmAsIHRoaXMucGVlciksIHRoaXMuY2xvc2UoKSB9IH0gY2xvc2UoZSkgeyBpZiAoZT8uZmx1c2gpIHsgdGhpcy5zZW5kKHsgX19wZWVyRGF0YTogeyB0eXBlOiAiY2xvc2UiIH0gfSk7IHJldHVybiB9IHRoaXMuX25lZ290aWF0b3IgJiYgKHRoaXMuX25lZ290aWF0b3IuY2xlYW51cCgpLCB0aGlzLl9uZWdvdGlhdG9yID0gbnVsbCksIHRoaXMucHJvdmlkZXIgJiYgKHRoaXMucHJvdmlkZXIuX3JlbW92ZUNvbm5lY3Rpb24odGhpcyksIHRoaXMucHJvdmlkZXIgPSBudWxsKSwgdGhpcy5kYXRhQ2hhbm5lbCAmJiAodGhpcy5kYXRhQ2hhbm5lbC5vbm9wZW4gPSBudWxsLCB0aGlzLmRhdGFDaGFubmVsLm9ubWVzc2FnZSA9IG51bGwsIHRoaXMuZGF0YUNoYW5uZWwub25jbG9zZSA9IG51bGwsIHRoaXMuZGF0YUNoYW5uZWwgPSBudWxsKSwgdGhpcy5vcGVuICYmICh0aGlzLl9vcGVuID0gITEsIHN1cGVyLmVtaXQoImNsb3NlIikpIH0gc2VuZChlLCB0ID0gITEpIHsgaWYgKCF0aGlzLm9wZW4pIHsgdGhpcy5lbWl0RXJyb3IoeC5Ob3RPcGVuWWV0LCAiQ29ubmVjdGlvbiBpcyBub3Qgb3Blbi4gWW91IHNob3VsZCBsaXN0ZW4gZm9yIHRoZSBgb3BlbmAgZXZlbnQgYmVmb3JlIHNlbmRpbmcgbWVzc2FnZXMuIik7IHJldHVybiB9IHJldHVybiB0aGlzLl9zZW5kKGUsIHQpIH0gYXN5bmMgaGFuZGxlTWVzc2FnZShlKSB7IGxldCB0ID0gZS5wYXlsb2FkOyBzd2l0Y2ggKGUudHlwZSkgeyBjYXNlIE8uQW5zd2VyOiBhd2FpdCB0aGlzLl9uZWdvdGlhdG9yLmhhbmRsZVNEUChlLnR5cGUsIHQuc2RwKTsgYnJlYWs7IGNhc2UgTy5DYW5kaWRhdGU6IGF3YWl0IHRoaXMuX25lZ290aWF0b3IuaGFuZGxlQ2FuZGlkYXRlKHQuY2FuZGlkYXRlKTsgYnJlYWs7IGRlZmF1bHQ6IGVJLndhcm4oIlVucmVjb2duaXplZCBtZXNzYWdlIHR5cGU6IiwgZS50eXBlLCAiZnJvbSBwZWVyOiIsIHRoaXMucGVlcikgfSB9IGNvbnN0cnVjdG9yKGUsIHQsIG4pIHsgc3VwZXIoZSwgdCwgbiksIHRoaXMuY29ubmVjdGlvbklkID0gdGhpcy5vcHRpb25zLmNvbm5lY3Rpb25JZCB8fCBlWS5JRF9QUkVGSVggKyBlRSgpLCB0aGlzLmxhYmVsID0gdGhpcy5vcHRpb25zLmxhYmVsIHx8IHRoaXMuY29ubmVjdGlvbklkLCB0aGlzLnJlbGlhYmxlID0gISF0aGlzLm9wdGlvbnMucmVsaWFibGUsIHRoaXMuX25lZ290aWF0b3IgPSBuZXcgZSQodGhpcyksIHRoaXMuX25lZ290aWF0b3Iuc3RhcnRDb25uZWN0aW9uKHRoaXMub3B0aW9ucy5fcGF5bG9hZCB8fCB7IG9yaWdpbmF0b3I6ICEwLCByZWxpYWJsZTogdGhpcy5yZWxpYWJsZSB9KSB9IH0gZVkuSURfUFJFRklYID0gImRjXyIsIGVZLk1BWF9CVUZGRVJFRF9BTU9VTlQgPSA4Mzg4NjA4OyBjbGFzcyBlSyBleHRlbmRzIGVZIHsgZ2V0IGJ1ZmZlclNpemUoKSB7IHJldHVybiB0aGlzLl9idWZmZXJTaXplIH0gX2luaXRpYWxpemVEYXRhQ2hhbm5lbChlKSB7IHN1cGVyLl9pbml0aWFsaXplRGF0YUNoYW5uZWwoZSksIHRoaXMuZGF0YUNoYW5uZWwuYmluYXJ5VHlwZSA9ICJhcnJheWJ1ZmZlciIsIHRoaXMuZGF0YUNoYW5uZWwuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIGUgPT4gdGhpcy5faGFuZGxlRGF0YU1lc3NhZ2UoZSkpIH0gX2J1ZmZlcmVkU2VuZChlKSB7ICh0aGlzLl9idWZmZXJpbmcgfHwgIXRoaXMuX3RyeVNlbmQoZSkpICYmICh0aGlzLl9idWZmZXIucHVzaChlKSwgdGhpcy5fYnVmZmVyU2l6ZSA9IHRoaXMuX2J1ZmZlci5sZW5ndGgpIH0gX3RyeVNlbmQoZSkgeyBpZiAoIXRoaXMub3BlbikgcmV0dXJuICExOyBpZiAodGhpcy5kYXRhQ2hhbm5lbC5idWZmZXJlZEFtb3VudCA+IGVZLk1BWF9CVUZGRVJFRF9BTU9VTlQpIHJldHVybiB0aGlzLl9idWZmZXJpbmcgPSAhMCwgc2V0VGltZW91dCgoKSA9PiB7IHRoaXMuX2J1ZmZlcmluZyA9ICExLCB0aGlzLl90cnlCdWZmZXIoKSB9LCA1MCksICExOyB0cnkgeyB0aGlzLmRhdGFDaGFubmVsLnNlbmQoZSkgfSBjYXRjaCAoZSkgeyByZXR1cm4gZUkuZXJyb3IoYERDIzoke3RoaXMuY29ubmVjdGlvbklkfSBFcnJvciB3aGVuIHNlbmRpbmc6YCwgZSksIHRoaXMuX2J1ZmZlcmluZyA9ICEwLCB0aGlzLmNsb3NlKCksICExIH0gcmV0dXJuICEwIH0gX3RyeUJ1ZmZlcigpIHsgaWYgKCF0aGlzLm9wZW4gfHwgMCA9PT0gdGhpcy5fYnVmZmVyLmxlbmd0aCkgcmV0dXJuOyBsZXQgZSA9IHRoaXMuX2J1ZmZlclswXTsgdGhpcy5fdHJ5U2VuZChlKSAmJiAodGhpcy5fYnVmZmVyLnNoaWZ0KCksIHRoaXMuX2J1ZmZlclNpemUgPSB0aGlzLl9idWZmZXIubGVuZ3RoLCB0aGlzLl90cnlCdWZmZXIoKSkgfSBjbG9zZShlKSB7IGlmIChlPy5mbHVzaCkgeyB0aGlzLnNlbmQoeyBfX3BlZXJEYXRhOiB7IHR5cGU6ICJjbG9zZSIgfSB9KTsgcmV0dXJuIH0gdGhpcy5fYnVmZmVyID0gW10sIHRoaXMuX2J1ZmZlclNpemUgPSAwLCBzdXBlci5jbG9zZSgpIH0gY29uc3RydWN0b3IoLi4uZSkgeyBzdXBlciguLi5lKSwgdGhpcy5fYnVmZmVyID0gW10sIHRoaXMuX2J1ZmZlclNpemUgPSAwLCB0aGlzLl9idWZmZXJpbmcgPSAhMSB9IH0gY2xhc3MgZVggZXh0ZW5kcyBlSyB7IGNsb3NlKGUpIHsgc3VwZXIuY2xvc2UoZSksIHRoaXMuX2NodW5rZWREYXRhID0ge30gfSBfaGFuZGxlRGF0YU1lc3NhZ2UoeyBkYXRhOiBlIH0pIHsgbGV0IHQgPSBpKGUpLCBuID0gdC5fX3BlZXJEYXRhOyBpZiAobikgeyBpZiAoImNsb3NlIiA9PT0gbi50eXBlKSB7IHRoaXMuY2xvc2UoKTsgcmV0dXJuIH0gdGhpcy5faGFuZGxlQ2h1bmsodCk7IHJldHVybiB9IHRoaXMuZW1pdCgiZGF0YSIsIHQpIH0gX2hhbmRsZUNodW5rKGUpIHsgbGV0IHQgPSBlLl9fcGVlckRhdGEsIG4gPSB0aGlzLl9jaHVua2VkRGF0YVt0XSB8fCB7IGRhdGE6IFtdLCBjb3VudDogMCwgdG90YWw6IGUudG90YWwgfTsgaWYgKG4uZGF0YVtlLm5dID0gbmV3IFVpbnQ4QXJyYXkoZS5kYXRhKSwgbi5jb3VudCsrLCB0aGlzLl9jaHVua2VkRGF0YVt0XSA9IG4sIG4udG90YWwgPT09IG4uY291bnQpIHsgZGVsZXRlIHRoaXMuX2NodW5rZWREYXRhW3RdOyBsZXQgZSA9IGZ1bmN0aW9uIChlKSB7IGxldCB0ID0gMDsgZm9yIChsZXQgbiBvZiBlKSB0ICs9IG4uYnl0ZUxlbmd0aDsgbGV0IG4gPSBuZXcgVWludDhBcnJheSh0KSwgciA9IDA7IGZvciAobGV0IHQgb2YgZSkgbi5zZXQodCwgciksIHIgKz0gdC5ieXRlTGVuZ3RoOyByZXR1cm4gbiB9KG4uZGF0YSk7IHRoaXMuX2hhbmRsZURhdGFNZXNzYWdlKHsgZGF0YTogZSB9KSB9IH0gX3NlbmQoZSwgdCkgeyBsZXQgbiA9IG8oZSk7IGlmIChuIGluc3RhbmNlb2YgUHJvbWlzZSkgcmV0dXJuIHRoaXMuX3NlbmRfYmxvYihuKTsgaWYgKCF0ICYmIG4uYnl0ZUxlbmd0aCA+IHRoaXMuY2h1bmtlci5jaHVua2VkTVRVKSB7IHRoaXMuX3NlbmRDaHVua3Mobik7IHJldHVybiB9IHRoaXMuX2J1ZmZlcmVkU2VuZChuKSB9IGFzeW5jIF9zZW5kX2Jsb2IoZSkgeyBsZXQgdCA9IGF3YWl0IGU7IGlmICh0LmJ5dGVMZW5ndGggPiB0aGlzLmNodW5rZXIuY2h1bmtlZE1UVSkgeyB0aGlzLl9zZW5kQ2h1bmtzKHQpOyByZXR1cm4gfSB0aGlzLl9idWZmZXJlZFNlbmQodCkgfSBfc2VuZENodW5rcyhlKSB7IGxldCB0ID0gdGhpcy5jaHVua2VyLmNodW5rKGUpOyBmb3IgKGxldCBlIG9mIChlSS5sb2coYERDIyR7dGhpcy5jb25uZWN0aW9uSWR9IFRyeSB0byBzZW5kICR7dC5sZW5ndGh9IGNodW5rcy4uLmApLCB0KSkgdGhpcy5zZW5kKGUsICEwKSB9IGNvbnN0cnVjdG9yKGUsIHQsIHIpIHsgc3VwZXIoZSwgdCwgciksIHRoaXMuY2h1bmtlciA9IG5ldyBuLCB0aGlzLnNlcmlhbGl6YXRpb24gPSBJLkJpbmFyeSwgdGhpcy5fY2h1bmtlZERhdGEgPSB7fSB9IH0gY2xhc3MgZXEgZXh0ZW5kcyBlSyB7IF9oYW5kbGVEYXRhTWVzc2FnZSh7IGRhdGE6IGUgfSkgeyBzdXBlci5lbWl0KCJkYXRhIiwgZSkgfSBfc2VuZChlLCB0KSB7IHRoaXMuX2J1ZmZlcmVkU2VuZChlKSB9IGNvbnN0cnVjdG9yKC4uLmUpIHsgc3VwZXIoLi4uZSksIHRoaXMuc2VyaWFsaXphdGlvbiA9IEkuTm9uZSB9IH0gY2xhc3MgZVEgZXh0ZW5kcyBlSyB7IF9oYW5kbGVEYXRhTWVzc2FnZSh7IGRhdGE6IGUgfSkgeyBsZXQgdCA9IHRoaXMucGFyc2UodGhpcy5kZWNvZGVyLmRlY29kZShlKSksIG4gPSB0Ll9fcGVlckRhdGE7IGlmIChuICYmICJjbG9zZSIgPT09IG4udHlwZSkgeyB0aGlzLmNsb3NlKCk7IHJldHVybiB9IHRoaXMuZW1pdCgiZGF0YSIsIHQpIH0gX3NlbmQoZSwgdCkgeyBsZXQgbiA9IHRoaXMuZW5jb2Rlci5lbmNvZGUodGhpcy5zdHJpbmdpZnkoZSkpOyBpZiAobi5ieXRlTGVuZ3RoID49IGV4LmNodW5rZWRNVFUpIHsgdGhpcy5lbWl0RXJyb3IoeC5NZXNzYWdlVG9CaWcsICJNZXNzYWdlIHRvbyBiaWcgZm9yIEpTT04gY2hhbm5lbCIpOyByZXR1cm4gfSB0aGlzLl9idWZmZXJlZFNlbmQobikgfSBjb25zdHJ1Y3RvciguLi5lKSB7IHN1cGVyKC4uLmUpLCB0aGlzLnNlcmlhbGl6YXRpb24gPSBJLkpTT04sIHRoaXMuZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlciwgdGhpcy5kZWNvZGVyID0gbmV3IFRleHREZWNvZGVyLCB0aGlzLnN0cmluZ2lmeSA9IEpTT04uc3RyaW5naWZ5LCB0aGlzLnBhcnNlID0gSlNPTi5wYXJzZSB9IH0gY2xhc3MgZVogZXh0ZW5kcyBlSiB7IGdldCBpZCgpIHsgcmV0dXJuIHRoaXMuX2lkIH0gZ2V0IG9wdGlvbnMoKSB7IHJldHVybiB0aGlzLl9vcHRpb25zIH0gZ2V0IG9wZW4oKSB7IHJldHVybiB0aGlzLl9vcGVuIH0gZ2V0IHNvY2tldCgpIHsgcmV0dXJuIHRoaXMuX3NvY2tldCB9IGdldCBjb25uZWN0aW9ucygpIHsgbGV0IGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOyBmb3IgKGxldCBbdCwgbl0gb2YgdGhpcy5fY29ubmVjdGlvbnMpIGVbdF0gPSBuOyByZXR1cm4gZSB9IGdldCBkZXN0cm95ZWQoKSB7IHJldHVybiB0aGlzLl9kZXN0cm95ZWQgfSBnZXQgZGlzY29ubmVjdGVkKCkgeyByZXR1cm4gdGhpcy5fZGlzY29ubmVjdGVkIH0gX2NyZWF0ZVNlcnZlckNvbm5lY3Rpb24oKSB7IGxldCBlID0gbmV3IGVOKHRoaXMuX29wdGlvbnMuc2VjdXJlLCB0aGlzLl9vcHRpb25zLmhvc3QsIHRoaXMuX29wdGlvbnMucG9ydCwgdGhpcy5fb3B0aW9ucy5wYXRoLCB0aGlzLl9vcHRpb25zLmtleSwgdGhpcy5fb3B0aW9ucy5waW5nSW50ZXJ2YWwpOyByZXR1cm4gZS5vbihNLk1lc3NhZ2UsIGUgPT4geyB0aGlzLl9oYW5kbGVNZXNzYWdlKGUpIH0pLCBlLm9uKE0uRXJyb3IsIGUgPT4geyB0aGlzLl9hYm9ydChFLlNvY2tldEVycm9yLCBlKSB9KSwgZS5vbihNLkRpc2Nvbm5lY3RlZCwgKCkgPT4geyB0aGlzLmRpc2Nvbm5lY3RlZCB8fCAodGhpcy5lbWl0RXJyb3IoRS5OZXR3b3JrLCAiTG9zdCBjb25uZWN0aW9uIHRvIHNlcnZlci4iKSwgdGhpcy5kaXNjb25uZWN0KCkpIH0pLCBlLm9uKE0uQ2xvc2UsICgpID0+IHsgdGhpcy5kaXNjb25uZWN0ZWQgfHwgdGhpcy5fYWJvcnQoRS5Tb2NrZXRDbG9zZWQsICJVbmRlcmx5aW5nIHNvY2tldCBpcyBhbHJlYWR5IGNsb3NlZC4iKSB9KSwgZSB9IF9pbml0aWFsaXplKGUpIHsgdGhpcy5faWQgPSBlLCB0aGlzLnNvY2tldC5zdGFydChlLCB0aGlzLl9vcHRpb25zLnRva2VuKSB9IF9oYW5kbGVNZXNzYWdlKGUpIHsgbGV0IHQgPSBlLnR5cGUsIG4gPSBlLnBheWxvYWQsIHIgPSBlLnNyYzsgc3dpdGNoICh0KSB7IGNhc2UgTy5PcGVuOiB0aGlzLl9sYXN0U2VydmVySWQgPSB0aGlzLmlkLCB0aGlzLl9vcGVuID0gITAsIHRoaXMuZW1pdCgib3BlbiIsIHRoaXMuaWQpOyBicmVhazsgY2FzZSBPLkVycm9yOiB0aGlzLl9hYm9ydChFLlNlcnZlckVycm9yLCBuLm1zZyk7IGJyZWFrOyBjYXNlIE8uSWRUYWtlbjogdGhpcy5fYWJvcnQoRS5VbmF2YWlsYWJsZUlELCBgSUQgIiR7dGhpcy5pZH0iIGlzIHRha2VuYCk7IGJyZWFrOyBjYXNlIE8uSW52YWxpZEtleTogdGhpcy5fYWJvcnQoRS5JbnZhbGlkS2V5LCBgQVBJIEtFWSAiJHt0aGlzLl9vcHRpb25zLmtleX0iIGlzIGludmFsaWRgKTsgYnJlYWs7IGNhc2UgTy5MZWF2ZTogZUkubG9nKGBSZWNlaXZlZCBsZWF2ZSBtZXNzYWdlIGZyb20gJHtyfWApLCB0aGlzLl9jbGVhbnVwUGVlcihyKSwgdGhpcy5fY29ubmVjdGlvbnMuZGVsZXRlKHIpOyBicmVhazsgY2FzZSBPLkV4cGlyZTogdGhpcy5lbWl0RXJyb3IoRS5QZWVyVW5hdmFpbGFibGUsIGBDb3VsZCBub3QgY29ubmVjdCB0byBwZWVyICR7cn1gKTsgYnJlYWs7IGNhc2UgTy5PZmZlcjogeyBsZXQgZSA9IG4uY29ubmVjdGlvbklkLCB0ID0gdGhpcy5nZXRDb25uZWN0aW9uKHIsIGUpOyBpZiAodCAmJiAodC5jbG9zZSgpLCBlSS53YXJuKGBPZmZlciByZWNlaXZlZCBmb3IgZXhpc3RpbmcgQ29ubmVjdGlvbiBJRDoke2V9YCkpLCBuLnR5cGUgPT09IHcuTWVkaWEpIHsgbGV0IGkgPSBuZXcgZVcociwgdGhpcywgeyBjb25uZWN0aW9uSWQ6IGUsIF9wYXlsb2FkOiBuLCBtZXRhZGF0YTogbi5tZXRhZGF0YSB9KTsgdCA9IGksIHRoaXMuX2FkZENvbm5lY3Rpb24ociwgdCksIHRoaXMuZW1pdCgiY2FsbCIsIGkpIH0gZWxzZSBpZiAobi50eXBlID09PSB3LkRhdGEpIHsgbGV0IGkgPSBuZXcgdGhpcy5fc2VyaWFsaXplcnNbbi5zZXJpYWxpemF0aW9uXShyLCB0aGlzLCB7IGNvbm5lY3Rpb25JZDogZSwgX3BheWxvYWQ6IG4sIG1ldGFkYXRhOiBuLm1ldGFkYXRhLCBsYWJlbDogbi5sYWJlbCwgc2VyaWFsaXphdGlvbjogbi5zZXJpYWxpemF0aW9uLCByZWxpYWJsZTogbi5yZWxpYWJsZSB9KTsgdCA9IGksIHRoaXMuX2FkZENvbm5lY3Rpb24ociwgdCksIHRoaXMuZW1pdCgiY29ubmVjdGlvbiIsIGkpIH0gZWxzZSB7IGVJLndhcm4oYFJlY2VpdmVkIG1hbGZvcm1lZCBjb25uZWN0aW9uIHR5cGU6JHtuLnR5cGV9YCk7IHJldHVybiB9IGZvciAobGV0IG4gb2YgdGhpcy5fZ2V0TWVzc2FnZXMoZSkpIHQuaGFuZGxlTWVzc2FnZShuKTsgYnJlYWsgfSBkZWZhdWx0OiB7IGlmICghbikgeyBlSS53YXJuKGBZb3UgcmVjZWl2ZWQgYSBtYWxmb3JtZWQgbWVzc2FnZSBmcm9tICR7cn0gb2YgdHlwZSAke3R9YCk7IHJldHVybiB9IGxldCBpID0gbi5jb25uZWN0aW9uSWQsIG8gPSB0aGlzLmdldENvbm5lY3Rpb24ociwgaSk7IG8gJiYgby5wZWVyQ29ubmVjdGlvbiA/IG8uaGFuZGxlTWVzc2FnZShlKSA6IGkgPyB0aGlzLl9zdG9yZU1lc3NhZ2UoaSwgZSkgOiBlSS53YXJuKCJZb3UgcmVjZWl2ZWQgYW4gdW5yZWNvZ25pemVkIG1lc3NhZ2U6IiwgZSkgfSB9IH0gX3N0b3JlTWVzc2FnZShlLCB0KSB7IHRoaXMuX2xvc3RNZXNzYWdlcy5oYXMoZSkgfHwgdGhpcy5fbG9zdE1lc3NhZ2VzLnNldChlLCBbXSksIHRoaXMuX2xvc3RNZXNzYWdlcy5nZXQoZSkucHVzaCh0KSB9IF9nZXRNZXNzYWdlcyhlKSB7IGxldCB0ID0gdGhpcy5fbG9zdE1lc3NhZ2VzLmdldChlKTsgcmV0dXJuIHQgPyAodGhpcy5fbG9zdE1lc3NhZ2VzLmRlbGV0ZShlKSwgdCkgOiBbXSB9IGNvbm5lY3QoZSwgdCA9IHt9KSB7IGlmICh0ID0geyBzZXJpYWxpemF0aW9uOiAiZGVmYXVsdCIsIC4uLnQgfSwgdGhpcy5kaXNjb25uZWN0ZWQpIHsgZUkud2FybigiWW91IGNhbm5vdCBjb25uZWN0IHRvIGEgbmV3IFBlZXIgYmVjYXVzZSB5b3UgY2FsbGVkIC5kaXNjb25uZWN0KCkgb24gdGhpcyBQZWVyIGFuZCBlbmRlZCB5b3VyIGNvbm5lY3Rpb24gd2l0aCB0aGUgc2VydmVyLiBZb3UgY2FuIGNyZWF0ZSBhIG5ldyBQZWVyIHRvIHJlY29ubmVjdCwgb3IgY2FsbCByZWNvbm5lY3Qgb24gdGhpcyBwZWVyIGlmIHlvdSBiZWxpZXZlIGl0cyBJRCB0byBzdGlsbCBiZSBhdmFpbGFibGUuIiksIHRoaXMuZW1pdEVycm9yKEUuRGlzY29ubmVjdGVkLCAiQ2Fubm90IGNvbm5lY3QgdG8gbmV3IFBlZXIgYWZ0ZXIgZGlzY29ubmVjdGluZyBmcm9tIHNlcnZlci4iKTsgcmV0dXJuIH0gbGV0IG4gPSBuZXcgdGhpcy5fc2VyaWFsaXplcnNbdC5zZXJpYWxpemF0aW9uXShlLCB0aGlzLCB0KTsgcmV0dXJuIHRoaXMuX2FkZENvbm5lY3Rpb24oZSwgbiksIG4gfSBjYWxsKGUsIHQsIG4gPSB7fSkgeyBpZiAodGhpcy5kaXNjb25uZWN0ZWQpIHsgZUkud2FybigiWW91IGNhbm5vdCBjb25uZWN0IHRvIGEgbmV3IFBlZXIgYmVjYXVzZSB5b3UgY2FsbGVkIC5kaXNjb25uZWN0KCkgb24gdGhpcyBQZWVyIGFuZCBlbmRlZCB5b3VyIGNvbm5lY3Rpb24gd2l0aCB0aGUgc2VydmVyLiBZb3UgY2FuIGNyZWF0ZSBhIG5ldyBQZWVyIHRvIHJlY29ubmVjdC4iKSwgdGhpcy5lbWl0RXJyb3IoRS5EaXNjb25uZWN0ZWQsICJDYW5ub3QgY29ubmVjdCB0byBuZXcgUGVlciBhZnRlciBkaXNjb25uZWN0aW5nIGZyb20gc2VydmVyLiIpOyByZXR1cm4gfSBpZiAoIXQpIHsgZUkuZXJyb3IoIlRvIGNhbGwgYSBwZWVyLCB5b3UgbXVzdCBwcm92aWRlIGEgc3RyZWFtIGZyb20geW91ciBicm93c2VyJ3MgYGdldFVzZXJNZWRpYWAuIik7IHJldHVybiB9IGxldCByID0gbmV3IGVXKGUsIHRoaXMsIHsgLi4ubiwgX3N0cmVhbTogdCB9KTsgcmV0dXJuIHRoaXMuX2FkZENvbm5lY3Rpb24oZSwgciksIHIgfSBfYWRkQ29ubmVjdGlvbihlLCB0KSB7IGVJLmxvZyhgYWRkIGNvbm5lY3Rpb24gJHt0LnR5cGV9OiR7dC5jb25uZWN0aW9uSWR9IHRvIHBlZXJJZDoke2V9YCksIHRoaXMuX2Nvbm5lY3Rpb25zLmhhcyhlKSB8fCB0aGlzLl9jb25uZWN0aW9ucy5zZXQoZSwgW10pLCB0aGlzLl9jb25uZWN0aW9ucy5nZXQoZSkucHVzaCh0KSB9IF9yZW1vdmVDb25uZWN0aW9uKGUpIHsgbGV0IHQgPSB0aGlzLl9jb25uZWN0aW9ucy5nZXQoZS5wZWVyKTsgaWYgKHQpIHsgbGV0IG4gPSB0LmluZGV4T2YoZSk7IC0xICE9PSBuICYmIHQuc3BsaWNlKG4sIDEpIH0gdGhpcy5fbG9zdE1lc3NhZ2VzLmRlbGV0ZShlLmNvbm5lY3Rpb25JZCkgfSBnZXRDb25uZWN0aW9uKGUsIHQpIHsgbGV0IG4gPSB0aGlzLl9jb25uZWN0aW9ucy5nZXQoZSk7IGlmICghbikgcmV0dXJuIG51bGw7IGZvciAobGV0IGUgb2YgbikgaWYgKGUuY29ubmVjdGlvbklkID09PSB0KSByZXR1cm4gZTsgcmV0dXJuIG51bGwgfSBfZGVsYXllZEFib3J0KGUsIHQpIHsgc2V0VGltZW91dCgoKSA9PiB7IHRoaXMuX2Fib3J0KGUsIHQpIH0sIDApIH0gX2Fib3J0KGUsIHQpIHsgZUkuZXJyb3IoIkFib3J0aW5nISIpLCB0aGlzLmVtaXRFcnJvcihlLCB0KSwgdGhpcy5fbGFzdFNlcnZlcklkID8gdGhpcy5kaXNjb25uZWN0KCkgOiB0aGlzLmRlc3Ryb3koKSB9IGRlc3Ryb3koKSB7IHRoaXMuZGVzdHJveWVkIHx8IChlSS5sb2coYERlc3Ryb3kgcGVlciB3aXRoIElEOiR7dGhpcy5pZH1gKSwgdGhpcy5kaXNjb25uZWN0KCksIHRoaXMuX2NsZWFudXAoKSwgdGhpcy5fZGVzdHJveWVkID0gITAsIHRoaXMuZW1pdCgiY2xvc2UiKSkgfSBfY2xlYW51cCgpIHsgZm9yIChsZXQgZSBvZiB0aGlzLl9jb25uZWN0aW9ucy5rZXlzKCkpIHRoaXMuX2NsZWFudXBQZWVyKGUpLCB0aGlzLl9jb25uZWN0aW9ucy5kZWxldGUoZSk7IHRoaXMuc29ja2V0LnJlbW92ZUFsbExpc3RlbmVycygpIH0gX2NsZWFudXBQZWVyKGUpIHsgbGV0IHQgPSB0aGlzLl9jb25uZWN0aW9ucy5nZXQoZSk7IGlmICh0KSBmb3IgKGxldCBlIG9mIHQpIGUuY2xvc2UoKSB9IGRpc2Nvbm5lY3QoKSB7IGlmICh0aGlzLmRpc2Nvbm5lY3RlZCkgcmV0dXJuOyBsZXQgZSA9IHRoaXMuaWQ7IGVJLmxvZyhgRGlzY29ubmVjdCBwZWVyIHdpdGggSUQ6JHtlfWApLCB0aGlzLl9kaXNjb25uZWN0ZWQgPSAhMCwgdGhpcy5fb3BlbiA9ICExLCB0aGlzLnNvY2tldC5jbG9zZSgpLCB0aGlzLl9sYXN0U2VydmVySWQgPSBlLCB0aGlzLl9pZCA9IG51bGwsIHRoaXMuZW1pdCgiZGlzY29ubmVjdGVkIiwgZSkgfSByZWNvbm5lY3QoKSB7IGlmICh0aGlzLmRpc2Nvbm5lY3RlZCAmJiAhdGhpcy5kZXN0cm95ZWQpIGVJLmxvZyhgQXR0ZW1wdGluZyByZWNvbm5lY3Rpb24gdG8gc2VydmVyIHdpdGggSUQgJHt0aGlzLl9sYXN0U2VydmVySWR9YCksIHRoaXMuX2Rpc2Nvbm5lY3RlZCA9ICExLCB0aGlzLl9pbml0aWFsaXplKHRoaXMuX2xhc3RTZXJ2ZXJJZCk7IGVsc2UgaWYgKHRoaXMuZGVzdHJveWVkKSB0aHJvdyBFcnJvcigiVGhpcyBwZWVyIGNhbm5vdCByZWNvbm5lY3QgdG8gdGhlIHNlcnZlci4gSXQgaGFzIGFscmVhZHkgYmVlbiBkZXN0cm95ZWQuIik7IGVsc2UgaWYgKHRoaXMuZGlzY29ubmVjdGVkIHx8IHRoaXMub3BlbikgdGhyb3cgRXJyb3IoYFBlZXIgJHt0aGlzLmlkfSBjYW5ub3QgcmVjb25uZWN0IGJlY2F1c2UgaXQgaXMgbm90IGRpc2Nvbm5lY3RlZCBmcm9tIHRoZSBzZXJ2ZXIhYCk7IGVsc2UgZUkuZXJyb3IoIkluIGEgaHVycnk/IFdlJ3JlIHN0aWxsIHRyeWluZyB0byBtYWtlIHRoZSBpbml0aWFsIGNvbm5lY3Rpb24hIikgfSBsaXN0QWxsUGVlcnMoZSA9IGUgPT4geyB9KSB7IHRoaXMuX2FwaS5saXN0QWxsUGVlcnMoKS50aGVuKHQgPT4gZSh0KSkuY2F0Y2goZSA9PiB0aGlzLl9hYm9ydChFLlNlcnZlckVycm9yLCBlKSkgfSBjb25zdHJ1Y3RvcihlLCB0KSB7IGxldCBuOyBpZiAoc3VwZXIoKSwgdGhpcy5fc2VyaWFsaXplcnMgPSB7IHJhdzogZXEsIGpzb246IGVRLCBiaW5hcnk6IGVYLCAiYmluYXJ5LXV0ZjgiOiBlWCwgZGVmYXVsdDogZVggfSwgdGhpcy5faWQgPSBudWxsLCB0aGlzLl9sYXN0U2VydmVySWQgPSBudWxsLCB0aGlzLl9kZXN0cm95ZWQgPSAhMSwgdGhpcy5fZGlzY29ubmVjdGVkID0gITEsIHRoaXMuX29wZW4gPSAhMSwgdGhpcy5fY29ubmVjdGlvbnMgPSBuZXcgTWFwLCB0aGlzLl9sb3N0TWVzc2FnZXMgPSBuZXcgTWFwLCBlICYmIGUuY29uc3RydWN0b3IgPT0gT2JqZWN0ID8gdCA9IGUgOiBlICYmIChuID0gZS50b1N0cmluZygpKSwgdCA9IHsgZGVidWc6IDAsIGhvc3Q6IGV4LkNMT1VEX0hPU1QsIHBvcnQ6IGV4LkNMT1VEX1BPUlQsIHBhdGg6ICIvIiwga2V5OiBlWi5ERUZBVUxUX0tFWSwgdG9rZW46IGV4LnJhbmRvbVRva2VuKCksIGNvbmZpZzogZXguZGVmYXVsdENvbmZpZywgcmVmZXJyZXJQb2xpY3k6ICJzdHJpY3Qtb3JpZ2luLXdoZW4tY3Jvc3Mtb3JpZ2luIiwgc2VyaWFsaXplcnM6IHt9LCAuLi50IH0sIHRoaXMuX29wdGlvbnMgPSB0LCB0aGlzLl9zZXJpYWxpemVycyA9IHsgLi4udGhpcy5fc2VyaWFsaXplcnMsIC4uLnRoaXMub3B0aW9ucy5zZXJpYWxpemVycyB9LCAiLyIgPT09IHRoaXMuX29wdGlvbnMuaG9zdCAmJiAodGhpcy5fb3B0aW9ucy5ob3N0ID0gd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lKSwgdGhpcy5fb3B0aW9ucy5wYXRoICYmICgiLyIgIT09IHRoaXMuX29wdGlvbnMucGF0aFswXSAmJiAodGhpcy5fb3B0aW9ucy5wYXRoID0gIi8iICsgdGhpcy5fb3B0aW9ucy5wYXRoKSwgIi8iICE9PSB0aGlzLl9vcHRpb25zLnBhdGhbdGhpcy5fb3B0aW9ucy5wYXRoLmxlbmd0aCAtIDFdICYmICh0aGlzLl9vcHRpb25zLnBhdGggKz0gIi8iKSksIHZvaWQgMCA9PT0gdGhpcy5fb3B0aW9ucy5zZWN1cmUgJiYgdGhpcy5fb3B0aW9ucy5ob3N0ICE9PSBleC5DTE9VRF9IT1NUID8gdGhpcy5fb3B0aW9ucy5zZWN1cmUgPSBleC5pc1NlY3VyZSgpIDogdGhpcy5fb3B0aW9ucy5ob3N0ID09IGV4LkNMT1VEX0hPU1QgJiYgKHRoaXMuX29wdGlvbnMuc2VjdXJlID0gITApLCB0aGlzLl9vcHRpb25zLmxvZ0Z1bmN0aW9uICYmIGVJLnNldExvZ0Z1bmN0aW9uKHRoaXMuX29wdGlvbnMubG9nRnVuY3Rpb24pLCBlSS5sb2dMZXZlbCA9IHRoaXMuX29wdGlvbnMuZGVidWcgfHwgMCwgdGhpcy5fYXBpID0gbmV3IGVIKHQpLCB0aGlzLl9zb2NrZXQgPSB0aGlzLl9jcmVhdGVTZXJ2ZXJDb25uZWN0aW9uKCksICFleC5zdXBwb3J0cy5hdWRpb1ZpZGVvICYmICFleC5zdXBwb3J0cy5kYXRhKSB7IHRoaXMuX2RlbGF5ZWRBYm9ydChFLkJyb3dzZXJJbmNvbXBhdGlibGUsICJUaGUgY3VycmVudCBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgV2ViUlRDIik7IHJldHVybiB9IGlmIChuICYmICFleC52YWxpZGF0ZUlkKG4pKSB7IHRoaXMuX2RlbGF5ZWRBYm9ydChFLkludmFsaWRJRCwgYElEICIke259IiBpcyBpbnZhbGlkYCk7IHJldHVybiB9IG4gPyB0aGlzLl9pbml0aWFsaXplKG4pIDogdGhpcy5fYXBpLnJldHJpZXZlSWQoKS50aGVuKGUgPT4gdGhpcy5faW5pdGlhbGl6ZShlKSkuY2F0Y2goZSA9PiB0aGlzLl9hYm9ydChFLlNlcnZlckVycm9yLCBlKSkgfSB9IGVaLkRFRkFVTFRfS0VZID0gInBlZXJqcyIsIHdpbmRvdy5wZWVyanMgPSB7IFBlZXI6IGVaLCB1dGlsOiBleCB9LCB3aW5kb3cuUGVlciA9IGVaCiAgfSkoKTsKICAvLyMgc291cmNlTWFwcGluZ1VSTD1wZWVyanMubWluLmpzLm1hcAoKICBjbGFzcyByb3R1clZvaWNlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnBlZXIgPSBudWxsOwogICAgICB0aGlzLmNhbGwgPSBudWxsOwogICAgICB0aGlzLmF1ZGlvU3RyZWFtID0gbnVsbDsKICAgICAgdGhpcy5yZW1vdGVTdHJlYW0gPSBudWxsOwogICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMgPSAnZGlzY29ubmVjdGVkJzsKICAgICAgdGhpcy5jYWxsU3RhdHVzID0gJ2lkbGUnOwogICAgICB0aGlzLnBlZXJDb25uZWN0aW9ucyA9IG5ldyBTZXQoKTsKICAgICAgdGhpcy5vbkNhbGxDaGFuZ2VDYWxsYmFjayA9IG51bGw7CiAgICAgIHRoaXMuY2FsbFBhcnRuZXIgPSAnJzsKICAgICAgdGhpcy5pbmNvbWluZ0NhbGwgPSBudWxsOwogICAgICAKICAgICAgLy8gQ2hlY2sgV2ViUlRDIHN1cHBvcnQKICAgICAgdGhpcy5pc1dlYlJUQ1N1cHBvcnRlZCA9IHRoaXMuX2NoZWNrV2ViUlRDU3VwcG9ydCgpOwogICAgICBpZiAoIXRoaXMuaXNXZWJSVENTdXBwb3J0ZWQpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1dlYlJUQyBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3Nlci4gVm9pY2UgY2FsbHMgd2lsbCBub3Qgd29yay4nKTsKICAgICAgfQogICAgfQogICAgCiAgICBfY2hlY2tXZWJSVENTdXBwb3J0KCkgewogICAgICByZXR1cm4gQm9vbGVhbigKICAgICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzICYmCiAgICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEgJiYKICAgICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24KICAgICAgKTsKICAgIH0KCiAgICBnZXRJbmZvKCkgewogICAgICByZXR1cm4gewogICAgICAgIGlkOiAncm90dXJDYWxsJywKICAgICAgICBuYW1lOiAnUm90dXIgVm9pY2UnLAogICAgICAgIGNvbG9yMTogJyNkYjc2YzAnLAogICAgICAgIGNvbG9yMjogJyNhMzU1OGUnLAogICAgICAgIGJsb2NrczogWwogICAgICAgICAgLyogewogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkJVVFRPTiwKICAgICAgICAgICAgdGV4dDogJ0V4YW1wbGUgUHJvamVjdCcsCiAgICAgICAgICAgIGZ1bmM6ICJnZXRFeGFtcGxlUHJvamVjdCIKICAgICAgICAgIH0sICovCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogJ2V4dEtlZXBBbGl2ZScsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogJ2tlZXAgdGhpcyBleHRlbnNpb24gaW4gbXkgcHJvamVjdCcKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogJ2Nvbm5lY3QnLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICdjb25uZWN0IGFzIFtOQU1FXScsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIE5BTUU6IHsKICAgICAgICAgICAgICAgIHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogJ3VzZXInICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogJ2VuYWJsZUF1ZGlvJywKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAnW21pY10gbWljcm9waG9uZScsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIG1pYzogewogICAgICAgICAgICAgICAgbWVudTogJ21pYycsCiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICdlbmFibGUnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICdjYWxsUGVlcicsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogJ2NhbGwgW05BTUVdIGFuZCBbV0FJVF0nLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBOQU1FOiB7CiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICdmcmllbmQnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBXQUlUOiB7CiAgICAgICAgICAgICAgICB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsCiAgICAgICAgICAgICAgICBtZW51OiAnd2FpdCcsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6ICd3YWl0JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAnYW5zd2VyQ2FsbCcsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogJ2Fuc3dlciBpbmNvbWluZyBjYWxsJwogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAnaGFuZ3VwJywKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAnaGFuZyB1cCBjYWxsJwogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAnZGlzY29ubmVjdFBlZXInLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICdkaXNjb25uZWN0IGZyb20gc2VydmVyJwogICAgICAgICAgfSwKICAgICAgICAgICctLS0nLAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICdpc0Nvbm5lY3RlZCcsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQk9PTEVBTiwKICAgICAgICAgICAgdGV4dDogJ2FtIEkgY29ubmVjdGVkPycKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogJ29uQ2FsbCcsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQk9PTEVBTiwKICAgICAgICAgICAgdGV4dDogJ2FtIEkgb24gYSBjYWxsPycKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogJ2lzQ2FsbEluY29taW5nJywKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5CT09MRUFOLAogICAgICAgICAgICB0ZXh0OiAnaXMgY2FsbCBpbmNvbWluZz8nCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICdoYXNBdWRpbycsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQk9PTEVBTiwKICAgICAgICAgICAgdGV4dDogJ2lzIG1pY3JvcGhvbmUgZW5hYmxlZD8nCiAgICAgICAgICB9LAogICAgICAgICAgJy0tLScsCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogJ2dldFN0YXR1cycsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICdjb25uZWN0aW9uIHN0YXR1cycKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIG9wY29kZTogJ2dldENhbGxTdGF0dXMnLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAnY2FsbCBzdGF0dXMnCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICdnZXROYW1lJywKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5SRVBPUlRFUiwKICAgICAgICAgICAgdGV4dDogJ215IG5hbWUnCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICdnZXRDYWxsUGFydG5lcicsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuUkVQT1JURVIsCiAgICAgICAgICAgIHRleHQ6ICdjYWxsIHBhcnRuZXIgbmFtZScKICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgIG1lbnVzOiB7CiAgICAgICAgICBtaWM6IHsKICAgICAgICAgICAgYWNjZXB0UmVwb3J0ZXJzOiB0cnVlLAogICAgICAgICAgICBpdGVtczogWwogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHRleHQ6ICdlbmFibGUnLAogICAgICAgICAgICAgICAgdmFsdWU6ICdlbmFibGUnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnZGlzYWJsZScsCiAgICAgICAgICAgICAgICB2YWx1ZTogJ2Rpc2FibGUnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICBdCiAgICAgICAgICB9LAogICAgICAgICAgd2FpdDogewogICAgICAgICAgICBhY2NlcHRSZXBvcnRlcnM6IHRydWUsCiAgICAgICAgICAgIGl0ZW1zOiBbCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgdGV4dDogJ3dhaXQgZm9yIGFuc3dlcicsCiAgICAgICAgICAgICAgICB2YWx1ZTogJ3dhaXQnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0ZXh0OiAnZG8gbm90IHdhaXQgZm9yIGFuc3dlcicsCiAgICAgICAgICAgICAgICB2YWx1ZTogJ25vd2FpdCcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICB9OwogICAgfQoKICAgIGdldEV4YW1wbGVQcm9qZWN0KCkgewogICAgICB3aW5kb3cub3BlbigiaHR0cHM6Ly90dXJib3dhcnAub3JnL2VkaXRvcj9wcm9qZWN0X3VybD1odHRwczovL2V4dGVuc2lvbnMubWlzdGl1bS5jb20vZXhhbXBsZXMvcm90dXJWb2ljZS5zYjMiKTsKICAgIH0KCiAgICBleHRLZWVwQWxpdmUoKSB7CiAgICAgIGFsZXJ0KCJEcmFnIHRoaXMgYmxvY2sgaW50byB5b3VyIHByb2plY3QgdG8ga2VlcCB0aGUgZXh0ZW5zaW9uIGxvYWRlZC4iKTsKICAgIH0KCiAgICBhc3luYyBjb25uZWN0KGFyZ3MpIHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAodGhpcy5wZWVyKSB7CiAgICAgICAgICB0aGlzLnBlZXIuZGVzdHJveSgpOwogICAgICAgICAgdGhpcy5wZWVyID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IG5hbWUgPSBTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5OQU1FKS50cmltKCkgfHwgJ3VzZXInICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMCk7CiAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzID0gJ2Nvbm5lY3RpbmcnOwoKICAgICAgICB0aGlzLnBlZXIgPSBuZXcgUGVlcihuYW1lLCB7CiAgICAgICAgICBob3N0OiAnMC5wZWVyanMuY29tJywKICAgICAgICAgIHBvcnQ6IDQ0MywKICAgICAgICAgIHNlY3VyZTogdHJ1ZSwKICAgICAgICAgIGRlYnVnOiAxCiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgdGhpcy5wZWVyLm9uKCdvcGVuJywgKGlkKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDb25uZWN0ZWQgd2l0aCBJRDonLCBpZCk7CiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyA9ICdjb25uZWN0ZWQnOwogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICB0aGlzLnBlZXIub24oJ2Vycm9yJywgKGVycikgPT4gewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdQZWVyIGNvbm5lY3Rpb24gZXJyb3I6JywgZXJyKTsKICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzID0gJ2Vycm9yOiAnICsgKGVyci50eXBlIHx8ICd1bmtub3duJyk7CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIHRoaXMucGVlci5vbignY2xvc2UnLCAoKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdQZWVyIGNvbm5lY3Rpb24gY2xvc2VkJyk7CiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyA9ICdkaXNjb25uZWN0ZWQnOwogICAgICAgICAgfSk7CgogICAgICAgICAgdGhpcy5wZWVyLm9uKCdjYWxsJywgKGluY29taW5nQ2FsbCkgPT4gewogICAgICAgICAgICB0aGlzLmluY29taW5nQ2FsbCA9IGluY29taW5nQ2FsbDsKICAgICAgICAgICAgdGhpcy5jYWxsU3RhdHVzID0gJ2luY29taW5nJzsKICAgICAgICAgICAgY29uc29sZS5sb2coJ0luY29taW5nIGNhbGwgZnJvbTonLCBpbmNvbWluZ0NhbGwucGVlcik7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdGlvblN0YXR1cyA9PT0gJ2Nvbm5lY3RpbmcnKSB7CiAgICAgICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzID0gJ3RpbWVvdXQnOwogICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgMTUwMDApOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNvbm5lY3Rpbmc6JywgZXJyb3IpOwogICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cyA9ICdlcnJvcjogJyArIChlcnJvci5tZXNzYWdlIHx8ICd1bmtub3duJyk7CiAgICAgIH0KICAgIH0KCiAgICBhc3luYyBlbmFibGVBdWRpbyh7IG1pYyB9KSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKG1pYyA9PT0gJ2Rpc2FibGUnKSB7CiAgICAgICAgICBpZiAodGhpcy5hdWRpb1N0cmVhbSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHRoaXMuYXVkaW9TdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaCh0cmFjayA9PiB0cmFjay5zdG9wKCkpOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc3RvcHBpbmcgYXVkaW8gdHJhY2tzOicsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuYXVkaW9TdHJlYW0gPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5hdWRpb1N0cmVhbSkgcmV0dXJuIHRydWU7CgogICAgICAgIHRoaXMuYXVkaW9TdHJlYW0gPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7CiAgICAgICAgICBhdWRpbzogdHJ1ZSwKICAgICAgICAgIHZpZGVvOiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIGNvbnNvbGUubG9nKCdBdWRpbyBzdHJlYW0gYWNxdWlyZWQnKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIGF1ZGlvIHN0cmVhbTonLCBlcnJvcik7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CgogICAgYW5zd2VyQ2FsbCgpIHsKICAgICAgaWYgKCF0aGlzLmluY29taW5nQ2FsbCkgewogICAgICAgIGNvbnNvbGUubG9nKCdObyBpbmNvbWluZyBjYWxsIHRvIGFuc3dlcicpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCF0aGlzLmF1ZGlvU3RyZWFtKSB7CiAgICAgICAgdGhpcy5lbmFibGVBdWRpbyh7IG1pYzogJ2VuYWJsZScgfSkudGhlbigoKSA9PiB7CiAgICAgICAgICBpZiAodGhpcy5hdWRpb1N0cmVhbSkgewogICAgICAgICAgICB0aGlzLl9jb21wbGV0ZUFuc3dlckNhbGwoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0NvdWxkIG5vdCBlbmFibGUgYXVkaW8gdG8gYW5zd2VyIGNhbGwnKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9jb21wbGV0ZUFuc3dlckNhbGwoKTsKICAgICAgfQogICAgfQoKICAgIF9jb21wbGV0ZUFuc3dlckNhbGwoKSB7CiAgICAgIGlmICghdGhpcy5pbmNvbWluZ0NhbGwpIHJldHVybjsKCiAgICAgIHRoaXMuY2FsbCA9IHRoaXMuaW5jb21pbmdDYWxsOwogICAgICB0aGlzLmNhbGxQYXJ0bmVyID0gdGhpcy5jYWxsLnBlZXIgfHwgJyc7CiAgICAgIHRoaXMuY2FsbFN0YXR1cyA9ICdjb25uZWN0aW5nJzsKCiAgICAgIHRoaXMuY2FsbC5hbnN3ZXIodGhpcy5hdWRpb1N0cmVhbSk7CiAgICAgIHRoaXMuX3NldHVwQ2FsbEV2ZW50cygpOwogICAgICB0aGlzLmluY29taW5nQ2FsbCA9IG51bGw7CiAgICB9CgogICAgY2FsbFBlZXIoYXJncykgewogICAgICBjb25zdCBjYWxsX3Byb21pc2UgPSBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSkgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICAvLyBDaGVjayBjb25uZWN0aW9uIHN0YXR1cyBtb3JlIHRob3JvdWdobHkKICAgICAgICAgIGlmICghdGhpcy5wZWVyKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ05vdCBjb25uZWN0ZWQgdG8gc2VydmVyIC0gcGVlciBvYmplY3QgbWlzc2luZycpOwogICAgICAgICAgICB0aGlzLmNhbGxTdGF0dXMgPSAnZXJyb3I6IG5vIHBlZXIgY29ubmVjdGlvbic7CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3Rpb25TdGF0dXMgIT09ICdjb25uZWN0ZWQnKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYENhbm5vdCBjYWxsIC0gY29ubmVjdGlvbiBzdGF0dXMgaXMgJHt0aGlzLmNvbm5lY3Rpb25TdGF0dXN9YCk7CiAgICAgICAgICAgIHRoaXMuY2FsbFN0YXR1cyA9ICdlcnJvcjogbm90IGNvbm5lY3RlZCc7CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBoYXZlIGF1ZGlvCiAgICAgICAgICBpZiAoIXRoaXMuYXVkaW9TdHJlYW0pIHsKICAgICAgICAgICAgY29uc3QgYXVkaW9FbmFibGVkID0gYXdhaXQgdGhpcy5lbmFibGVBdWRpbyh7IG1pYzogJ2VuYWJsZScgfSk7CiAgICAgICAgICAgIGlmICghYXVkaW9FbmFibGVkIHx8ICF0aGlzLmF1ZGlvU3RyZWFtKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQ291bGQgbm90IGVuYWJsZSBhdWRpbyBmb3IgY2FsbCcpOwogICAgICAgICAgICAgIHRoaXMuY2FsbFN0YXR1cyA9ICdlcnJvcjogbm8gYXVkaW8nOwogICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBuYW1lID0gU2NyYXRjaC5DYXN0LnRvU3RyaW5nKGFyZ3MuTkFNRSkudHJpbSgpOwogICAgICAgICAgaWYgKCFuYW1lKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgbmFtZSB0byBjYWxsJyk7CiAgICAgICAgICAgIHRoaXMuY2FsbFN0YXR1cyA9ICdlcnJvcjogaW52YWxpZCBuYW1lJzsKICAgICAgICAgICAgdGhpcy5jYWxsUGFydG5lciA9ICcnOwogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmNhbGxTdGF0dXMgPSAnY29ubmVjdGluZyc7CiAgICAgICAgICB0aGlzLmNhbGxQYXJ0bmVyID0gbmFtZTsKCiAgICAgICAgICBjb25zb2xlLmxvZyhgQXR0ZW1wdGluZyB0byBjYWxsICR7bmFtZX0uLi5gKTsKCiAgICAgICAgICBjb25zdCBjYWxsVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBpZiAodGhpcy5jYWxsU3RhdHVzID09PSAnY29ubmVjdGluZycpIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDYWxsIGNvbm5lY3Rpb24gdGltZWQgb3V0Jyk7CiAgICAgICAgICAgICAgdGhpcy5jYWxsU3RhdHVzID0gJ3RpbWVvdXQnOwogICAgICAgICAgICAgIGlmICh0aGlzLmNhbGwpIHsKICAgICAgICAgICAgICAgIHRoaXMuY2FsbC5jbG9zZSgpOwogICAgICAgICAgICAgICAgdGhpcy5jYWxsID0gbnVsbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5jYWxsUGFydG5lciA9ICcnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH0sIDMwMDAwKTsKCiAgICAgICAgICB0aGlzLmNhbGwgPSB0aGlzLnBlZXIuY2FsbChuYW1lLCB0aGlzLmF1ZGlvU3RyZWFtKTsKCiAgICAgICAgICBpZiAoIXRoaXMuY2FsbCkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQoY2FsbFRpbWVvdXQpOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gaW5pdGlhdGUgY2FsbCAtIGNhbGwgb2JqZWN0IG5vdCBjcmVhdGVkJyk7CiAgICAgICAgICAgIHRoaXMuY2FsbFN0YXR1cyA9ICdmYWlsZWQnOwogICAgICAgICAgICB0aGlzLmNhbGxQYXJ0bmVyID0gJyc7CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnNvbGUubG9nKCdDYWxsIG9iamVjdCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScpOwogICAgICAgICAgdGhpcy5fc2V0dXBDYWxsRXZlbnRzKGNhbGxUaW1lb3V0KTsKCiAgICAgICAgICB0aGlzLmNhbGwub24oJ3N0cmVhbScsICgpID0+IHsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmNhbGwub24oJ2Nsb3NlJywgKCkgPT4gewogICAgICAgICAgICBpZiAodGhpcy5jYWxsU3RhdHVzICE9PSAnY29ubmVjdGVkJykgewogICAgICAgICAgICAgIHRoaXMuY2FsbFBhcnRuZXIgPSAnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuY2FsbC5vbignZXJyb3InLCAoKSA9PiB7CiAgICAgICAgICAgIGlmICh0aGlzLmNhbGxTdGF0dXMgIT09ICdjb25uZWN0ZWQnKSB7CiAgICAgICAgICAgICAgdGhpcy5jYWxsUGFydG5lciA9ICcnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH0pOwoKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbWFraW5nIGNhbGw6JywgZXJyb3IpOwogICAgICAgICAgdGhpcy5jYWxsU3RhdHVzID0gJ2Vycm9yOiAnICsgKGVycm9yLm1lc3NhZ2UgfHwgJ3Vua25vd24nKTsKICAgICAgICAgIHRoaXMuY2FsbFBhcnRuZXIgPSAnJzsKICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgaWYgKGFyZ3MuV0FJVCA9PT0gJ3dhaXQnKSB7CiAgICAgICAgcmV0dXJuIGNhbGxfcHJvbWlzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KICAgIH0KCiAgICBfc2V0dXBDYWxsRXZlbnRzKGNhbGxUaW1lb3V0KSB7CiAgICAgIGlmICghdGhpcy5jYWxsKSByZXR1cm47CgogICAgICB0aGlzLmNhbGwub24oJ3N0cmVhbScsIChyZW1vdGVTdHJlYW0pID0+IHsKICAgICAgICBpZiAoY2FsbFRpbWVvdXQpIGNsZWFyVGltZW91dChjYWxsVGltZW91dCk7CiAgICAgICAgY29uc29sZS5sb2coJ1JlY2VpdmVkIHJlbW90ZSBzdHJlYW0nKTsKICAgICAgICB0aGlzLnJlbW90ZVN0cmVhbSA9IHJlbW90ZVN0cmVhbTsKICAgICAgICB0aGlzLmNhbGxTdGF0dXMgPSAnY29ubmVjdGVkJzsKICAgICAgICB0aGlzLl90cmlnZ2VyQ2FsbENoYW5nZUV2ZW50KCk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCBhdWRpb0VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhdWRpbycpOwogICAgICAgICAgYXVkaW9FbGVtZW50LmlkID0gJ3JvdHVyQ2FsbEF1ZGlvJzsKICAgICAgICAgIGF1ZGlvRWxlbWVudC5zcmNPYmplY3QgPSByZW1vdGVTdHJlYW07CiAgICAgICAgICBhdWRpb0VsZW1lbnQuYXV0b3BsYXkgPSB0cnVlOwoKICAgICAgICAgIGNvbnN0IGV4aXN0aW5nQXVkaW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm90dXJDYWxsQXVkaW8nKTsKICAgICAgICAgIGlmIChleGlzdGluZ0F1ZGlvKSB7CiAgICAgICAgICAgIGV4aXN0aW5nQXVkaW8ucmVtb3ZlKCk7CiAgICAgICAgICB9CgogICAgICAgICAgYXVkaW9FbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGF1ZGlvRWxlbWVudCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc2V0dGluZyB1cCBhdWRpbyBlbGVtZW50OicsIGUpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICB0aGlzLmNhbGwub24oJ2Nsb3NlJywgKCkgPT4gewogICAgICAgIGlmIChjYWxsVGltZW91dCkgY2xlYXJUaW1lb3V0KGNhbGxUaW1lb3V0KTsKICAgICAgICBjb25zb2xlLmxvZygnQ2FsbCBjbG9zZWQnKTsKICAgICAgICBpZiAodGhpcy5yZW1vdGVTdHJlYW0pIHsKICAgICAgICAgIHRoaXMucmVtb3RlU3RyZWFtID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgdGhpcy5jYWxsU3RhdHVzID0gJ2lkbGUnOwogICAgICAgIHRoaXMuX3RyaWdnZXJDYWxsQ2hhbmdlRXZlbnQoKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IGF1ZGlvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyb3R1ckNhbGxBdWRpbycpOwogICAgICAgICAgaWYgKGF1ZGlvRWxlbWVudCkgewogICAgICAgICAgICBhdWRpb0VsZW1lbnQucmVtb3ZlKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVtb3ZpbmcgYXVkaW8gZWxlbWVudDonLCBlKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgdGhpcy5jYWxsLm9uKCdlcnJvcicsIChlcnIpID0+IHsKICAgICAgICBpZiAoY2FsbFRpbWVvdXQpIGNsZWFyVGltZW91dChjYWxsVGltZW91dCk7CiAgICAgICAgY29uc29sZS5lcnJvcignQ2FsbCBlcnJvcjonLCBlcnIpOwogICAgICAgIHRoaXMuY2FsbFN0YXR1cyA9ICdlcnJvcjogJyArIChlcnIgfHwgJ3Vua25vd24nKTsKICAgICAgICB0aGlzLl90cmlnZ2VyQ2FsbENoYW5nZUV2ZW50KCk7CiAgICAgIH0pOwogICAgfQoKICAgIF90cmlnZ2VyQ2FsbENoYW5nZUV2ZW50KCkgewogICAgICBpZiAodGhpcy5vbkNhbGxDaGFuZ2VDYWxsYmFjaykgewogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLm9uQ2FsbENoYW5nZUNhbGxiYWNrKHRoaXMuY2FsbFN0YXR1cyk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gY2FsbCBjaGFuZ2UgY2FsbGJhY2s6JywgZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGFuZ3VwKCkgewogICAgICBpZiAodGhpcy5jYWxsKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMuY2FsbC5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNsb3NpbmcgY2FsbDonLCBlKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5jYWxsID0gbnVsbDsKICAgICAgICB0aGlzLmNhbGxQYXJ0bmVyID0gJyc7CiAgICAgICAgdGhpcy5jYWxsU3RhdHVzID0gJ2lkbGUnOwogICAgICAgIGNvbnNvbGUubG9nKCdDYWxsIGVuZGVkJyk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCBhdWRpb0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncm90dXJDYWxsQXVkaW8nKTsKICAgICAgICAgIGlmIChhdWRpb0VsZW1lbnQpIHsKICAgICAgICAgICAgYXVkaW9FbGVtZW50LnJlbW92ZSgpOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlbW92aW5nIGF1ZGlvIGVsZW1lbnQ6JywgZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5pbmNvbWluZ0NhbGwpIHsKICAgICAgICB0aGlzLmluY29taW5nQ2FsbCA9IG51bGw7CiAgICAgICAgdGhpcy5jYWxsU3RhdHVzID0gJ2lkbGUnOwogICAgICB9CgogICAgICAvLyBTdG9wIGFuZCBjbGVhciB0aGUgbWljcm9waG9uZSBzdHJlYW0gd2hlbiBoYW5naW5nIHVwCiAgICAgIGlmICh0aGlzLmF1ZGlvU3RyZWFtKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMuYXVkaW9TdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaCh0cmFjayA9PiB0cmFjay5zdG9wKCkpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN0b3BwaW5nIGF1ZGlvIHRyYWNrczonLCBlKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5hdWRpb1N0cmVhbSA9IG51bGw7CiAgICAgIH0KICAgIH0KCiAgICBkaXNjb25uZWN0UGVlcigpIHsKICAgICAgaWYgKHRoaXMuY2FsbCkgewogICAgICAgIHRoaXMuaGFuZ3VwKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmF1ZGlvU3RyZWFtKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHRoaXMuYXVkaW9TdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaCh0cmFjayA9PiB0cmFjay5zdG9wKCkpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN0b3BwaW5nIGF1ZGlvIHRyYWNrczonLCBlKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5hdWRpb1N0cmVhbSA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnBlZXIpIHsKICAgICAgICB0cnkgewogICAgICAgICAgdGhpcy5wZWVyLmRlc3Ryb3koKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkZXN0cm95aW5nIHBlZXI6JywgZSk7CiAgICAgICAgfQogICAgICAgIHRoaXMucGVlciA9IG51bGw7CiAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzID0gJ2Rpc2Nvbm5lY3RlZCc7CiAgICAgIH0KICAgIH0KCiAgICBpc0Nvbm5lY3RlZCgpIHsKICAgICAgcmV0dXJuIEJvb2xlYW4odGhpcy5wZWVyICYmIHRoaXMuY29ubmVjdGlvblN0YXR1cyA9PT0gJ2Nvbm5lY3RlZCcpOwogICAgfQoKICAgIG9uQ2FsbCgpIHsKICAgICAgcmV0dXJuIEJvb2xlYW4odGhpcy5jYWxsICYmIHRoaXMuY2FsbFN0YXR1cyA9PT0gJ2Nvbm5lY3RlZCcpOwogICAgfQoKICAgIGlzQ2FsbEluY29taW5nKCkgewogICAgICByZXR1cm4gQm9vbGVhbih0aGlzLmNhbGxTdGF0dXMgPT09ICdpbmNvbWluZycpOwogICAgfQoKICAgIGhhc0F1ZGlvKCkgewogICAgICByZXR1cm4gQm9vbGVhbih0aGlzLmF1ZGlvU3RyZWFtKTsKICAgIH0KCiAgICBnZXRTdGF0dXMoKSB7CiAgICAgIHJldHVybiBTdHJpbmcodGhpcy5jb25uZWN0aW9uU3RhdHVzIHx8ICd1bmtub3duJyk7CiAgICB9CgogICAgZ2V0Q2FsbFN0YXR1cygpIHsKICAgICAgcmV0dXJuIFN0cmluZyh0aGlzLmNhbGxTdGF0dXMgfHwgJ3Vua25vd24nKTsKICAgIH0KCiAgICBnZXROYW1lKCkgewogICAgICByZXR1cm4gU3RyaW5nKHRoaXMucGVlciA/IHRoaXMucGVlci5pZCA6ICdOb3QgY29ubmVjdGVkJyk7CiAgICB9CgogICAgZ2V0Q2FsbFBhcnRuZXIoKSB7CiAgICAgIHJldHVybiBTdHJpbmcodGhpcy5jYWxsUGFydG5lciB8fCAnJyk7CiAgICB9CiAgfQoKICBTY3JhdGNoLmV4dGVuc2lvbnMucmVnaXN0ZXIodm0ucnVudGltZS5leHRfcm90dXJWb2ljZSA9IG5ldyByb3R1clZvaWNlKCkpOwp9KShTY3JhdGNoKQ=="},"meta":{"semver":"3.0.0","platform":{"name":"TurboWarp","url":"https://turbowarp.org/"}}}